<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,EnableResultTypes" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="823">
         <a:s>library CQMCommon version '1.0.000'</a:s>
      </a:s>
   </annotation>
   <identifier id="CQMCommon" version="1.0.000"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="3:1-3:28" localIdentifier="QICore" uri="http://hl7.org/fhir">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>using </a:s>
               <a:s>
                  <a:s>QICore</a:s>
               </a:s>
               <a:s> version '4.1.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="5:1-5:56" localIdentifier="FHIRHelpers" path="FHIRHelpers" version="4.1.000">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.1.000' called FHIRHelpers</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="3" locator="6:1-6:58" localIdentifier="QICoreCommon" path="QICoreCommon" version="1.2.000">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>include </a:s>
               <a:s>
                  <a:s>QICoreCommon</a:s>
               </a:s>
               <a:s> version '1.2.000' called QICoreCommon</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="15" locator="15:1-16:66" name="Measurement Period" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="15">
               <a:s>parameter &quot;Measurement Period&quot; </a:s>
               <a:s r="14">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="13">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>
  default </a:s>
               <a:s r="12">
                  <a:s r="10">Interval[@2022-01-01T00:00:00.0, @2023-01-01T00:00:00.0)</a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <default localId="12" locator="16:11-16:66" lowClosed="true" highClosed="false" xsi:type="Interval">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <low localId="10" locator="16:20-16:41" resultTypeName="t:DateTime" xsi:type="DateTime">
               <year valueType="t:Integer" value="2022" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="1" xsi:type="Literal"/>
               <hour valueType="t:Integer" value="0" xsi:type="Literal"/>
               <minute valueType="t:Integer" value="0" xsi:type="Literal"/>
               <second valueType="t:Integer" value="0" xsi:type="Literal"/>
               <millisecond valueType="t:Integer" value="0" xsi:type="Literal"/>
            </low>
            <high localId="11" locator="16:44-16:65" resultTypeName="t:DateTime" xsi:type="DateTime">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="1" xsi:type="Literal"/>
               <hour valueType="t:Integer" value="0" xsi:type="Literal"/>
               <minute valueType="t:Integer" value="0" xsi:type="Literal"/>
               <second valueType="t:Integer" value="0" xsi:type="Literal"/>
               <millisecond valueType="t:Integer" value="0" xsi:type="Literal"/>
            </high>
         </default>
         <parameterTypeSpecifier localId="14" locator="15:32-15:49" xsi:type="IntervalTypeSpecifier">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <pointType localId="13" locator="15:41-15:48" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </parameterTypeSpecifier>
      </def>
   </parameters>
   <valueSets>
      <def localId="4" locator="8:1-8:111" resultTypeName="t:ValueSet" name="Emergency Department Visit" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.117.1.7.1.292" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>valueset &quot;Emergency Department Visit&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.117.1.7.1.292'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="5" locator="9:1-9:100" resultTypeName="t:ValueSet" name="Encounter Inpatient" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="5">
               <a:s>valueset &quot;Encounter Inpatient&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="6" locator="10:1-10:101" resultTypeName="t:ValueSet" name="Intensive Care Unit" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1029.206" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="6">
               <a:s>valueset &quot;Intensive Care Unit&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1029.206'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="7" locator="11:1-11:102" resultTypeName="t:ValueSet" name="Observation Services" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1111.143" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="7">
               <a:s>valueset &quot;Observation Services&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1111.143'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="8" locator="12:1-12:107" resultTypeName="t:ValueSet" name="Outpatient Surgery Service" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1110.38" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="8">
               <a:s>valueset &quot;Outpatient Surgery Service&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1110.38'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="9" locator="13:1-13:129" resultTypeName="t:ValueSet" name="Present on Admission or Clinically Undetermined" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1147.197" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="9">
               <a:s>valueset &quot;Present on Admission or Clinically Undetermined&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1147.197'</a:s>
            </a:s>
         </annotation>
      </def>
   </valueSets>
   <contexts>
      <def locator="18:1-18:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="18:1-18:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="18:1-18:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="31" locator="39:1-40:60" resultTypeName="t:Integer" name="LengthInDays" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="31">
               <a:s>/*
Calculates the difference in calendar days between the start and end of the given interval.
*/
define function &quot;LengthInDays&quot;(Value </a:s>
               <a:s r="25">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="24">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="30">
                  <a:s r="30">
                     <a:s>difference in days between </a:s>
                     <a:s r="27">
                        <a:s>start of </a:s>
                        <a:s r="26">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                     <a:s> and </a:s>
                     <a:s r="29">
                        <a:s>end of </a:s>
                        <a:s r="28">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="30" locator="40:3-40:60" resultTypeName="t:Integer" precision="Day" xsi:type="DifferenceBetween">
            <operand localId="27" locator="40:30-40:43" resultTypeName="t:DateTime" xsi:type="Start">
               <operand localId="26" locator="40:39-40:43" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
            <operand localId="29" locator="40:49-40:60" resultTypeName="t:DateTime" xsi:type="End">
               <operand localId="28" locator="40:56-40:60" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
         </expression>
         <operand name="Value">
            <operandTypeSpecifier localId="25" locator="39:38-39:55" xsi:type="IntervalTypeSpecifier">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <pointType localId="24" locator="39:47-39:54" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="42" locator="20:1-24:72" name="Inpatient Encounter" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="42">
               <a:s>define &quot;Inpatient Encounter&quot;:
  </a:s>
               <a:s r="41">
                  <a:s>
                     <a:s r="17">
                        <a:s r="16">
                           <a:s r="16">
                              <a:s>[Encounter: </a:s>
                              <a:s>
                                 <a:s>&quot;Encounter Inpatient&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> EncounterInpatient</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
      </a:s>
                  <a:s r="40">
                     <a:s>where </a:s>
                     <a:s r="40">
                        <a:s r="35">
                           <a:s r="21">
                              <a:s r="19">
                                 <a:s r="18">
                                    <a:s>EncounterInpatient</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="19">
                                    <a:s>status</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="20">
                                 <a:s>'finished'</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
       and </a:s>
                           <a:s r="34">
                              <a:s r="32">
                                 <a:s>&quot;LengthInDays&quot;(</a:s>
                                 <a:s r="23">
                                    <a:s r="22">
                                       <a:s>EncounterInpatient</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="23">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s r="33"> &lt;= 120</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
         and </a:s>
                        <a:s r="39">
                           <a:s r="37">
                              <a:s r="36">
                                 <a:s>EncounterInpatient</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="37">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="39"> ends during day of </a:s>
                           <a:s r="38">
                              <a:s>&quot;Measurement Period&quot;</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="41" locator="21:3-24:72" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="17" locator="21:3-21:55" alias="EncounterInpatient">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="16" locator="21:3-21:36" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <codes locator="21:15-21:35" resultTypeName="t:ValueSet" name="Encounter Inpatient" preserve="true" xsi:type="ValueSetRef"/>
               </expression>
            </source>
            <where localId="40" locator="22:3-24:72" resultTypeName="t:Boolean" xsi:type="And">
               <operand localId="35" locator="22:9-23:57" resultTypeName="t:Boolean" xsi:type="And">
                  <operand localId="21" locator="22:9-22:46" resultTypeName="t:Boolean" xsi:type="Equal">
                     <operand localId="19" locator="22:9-22:33" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                        <source path="status" scope="EncounterInpatient" xsi:type="Property"/>
                     </operand>
                     <operand localId="20" locator="22:37-22:46" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                  </operand>
                  <operand localId="34" locator="23:10-23:57" resultTypeName="t:Boolean" xsi:type="LessOrEqual">
                     <operand localId="32" locator="23:10-23:50" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
                        <operand localId="23" locator="23:25-23:49" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" scope="EncounterInpatient" xsi:type="Property"/>
                        </operand>
                     </operand>
                     <operand localId="33" locator="23:55-23:57" resultTypeName="t:Integer" valueType="t:Integer" value="120" xsi:type="Literal"/>
                  </operand>
               </operand>
               <operand localId="39" locator="24:8-24:72" resultTypeName="t:Boolean" precision="Day" xsi:type="In">
                  <operand locator="24:34-24:37" xsi:type="End">
                     <operand localId="37" locator="24:8-24:32" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="EncounterInpatient" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="38" locator="24:53-24:72" name="Measurement Period" xsi:type="ParameterRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="52" locator="33:1-34:62" name="ToDateInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:t name="description" value="Returns an interval of date values extracted from the input interval of date-time values"/>
            <a:t name="comment" value="This function returns an interval constructed using the `date from` extractor on the start&#xa;and end values of the input date-time interval. Note that using a precision specifier such as `day of`&#xa;as part of a timing phrase is preferred to communicate intent to perform day-level comparison, as well&#xa;as for general readability."/>
            <a:s r="52">
               <a:s>/*
@description: Returns an interval of date values extracted from the input interval of date-time values
@comment: This function returns an interval constructed using the `date from` extractor on the start
and end values of the input date-time interval. Note that using a precision specifier such as `day of`
as part of a timing phrase is preferred to communicate intent to perform day-level comparison, as well
as for general readability.
*/
define function &quot;ToDateInterval&quot;(period </a:s>
               <a:s r="44">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="43">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="51">
                  <a:s r="51">
                     <a:s>Interval[</a:s>
                     <a:s r="47">
                        <a:s>date from </a:s>
                        <a:s r="46">
                           <a:s>start of </a:s>
                           <a:s r="45">
                              <a:s>period</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>, </a:s>
                     <a:s r="50">
                        <a:s>date from </a:s>
                        <a:s r="49">
                           <a:s>end of </a:s>
                           <a:s r="48">
                              <a:s>period</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>]</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:Date" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="51" locator="34:3-34:62" lowClosed="true" highClosed="true" xsi:type="Interval">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:Date" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <low localId="47" locator="34:12-34:36" resultTypeName="t:Date" xsi:type="DateFrom">
               <operand localId="46" locator="34:22-34:36" resultTypeName="t:DateTime" xsi:type="Start">
                  <operand localId="45" locator="34:31-34:36" name="period" xsi:type="OperandRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </operand>
            </low>
            <high localId="50" locator="34:39-34:61" resultTypeName="t:Date" xsi:type="DateFrom">
               <operand localId="49" locator="34:49-34:61" resultTypeName="t:DateTime" xsi:type="End">
                  <operand localId="48" locator="34:56-34:61" name="period" xsi:type="OperandRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </operand>
            </high>
         </expression>
         <operand name="period">
            <operandTypeSpecifier localId="44" locator="33:41-33:58" xsi:type="IntervalTypeSpecifier">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <pointType localId="43" locator="33:50-33:57" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="63" locator="45:1-46:60" resultTypeName="t:Integer" name="lengthInDays" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="63">
               <a:s>/*
Calculates the difference in calendar days between the start and end of the given interval.
*/
define fluent function lengthInDays(Value </a:s>
               <a:s r="57">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="56">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="62">
                  <a:s r="62">
                     <a:s>difference in days between </a:s>
                     <a:s r="59">
                        <a:s>start of </a:s>
                        <a:s r="58">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                     <a:s> and </a:s>
                     <a:s r="61">
                        <a:s>end of </a:s>
                        <a:s r="60">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="62" locator="46:3-46:60" resultTypeName="t:Integer" precision="Day" xsi:type="DifferenceBetween">
            <operand localId="59" locator="46:30-46:43" resultTypeName="t:DateTime" xsi:type="Start">
               <operand localId="58" locator="46:39-46:43" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
            <operand localId="61" locator="46:49-46:60" resultTypeName="t:DateTime" xsi:type="End">
               <operand localId="60" locator="46:56-46:60" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
         </expression>
         <operand name="Value">
            <operandTypeSpecifier localId="57" locator="45:43-45:60" xsi:type="IntervalTypeSpecifier">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <pointType localId="56" locator="45:52-45:59" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="85" locator="51:1-57:5" resultTypeName="fhir:Encounter" name="ED Visit" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="85">
               <a:s>/*
Returns the most recent emergency department visit, if any, that occurs 1 hour or less prior to the given encounter.
*/
define function &quot;ED Visit&quot;(TheEncounter </a:s>
               <a:s r="64">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="84">
                  <a:s r="84">
                     <a:s>Last(
    </a:s>
                     <a:s r="83">
                        <a:s>
                           <a:s r="66">
                              <a:s r="65">
                                 <a:s r="65">
                                    <a:s>[Encounter: </a:s>
                                    <a:s>
                                       <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                    </a:s>
                                    <a:s>]</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> EDVisit</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="78">
                           <a:s>where </a:s>
                           <a:s r="78">
                              <a:s r="70">
                                 <a:s r="68">
                                    <a:s r="67">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="68">
                                       <a:s>status</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="69">
                                    <a:s>'finished'</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        and </a:s>
                              <a:s r="77">
                                 <a:s r="72">
                                    <a:s r="71">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="72">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="77">
                                    <a:s>ends </a:s>
                                    <a:s r="76">
                                       <a:s>1 hour</a:s>
                                    </a:s>
                                    <a:s> or less on or before</a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="75">
                                    <a:s>start of </a:s>
                                    <a:s r="74">
                                       <a:s r="73">
                                          <a:s>TheEncounter</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="74">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="82">
                           <a:s>sort by </a:s>
                           <a:s r="81">
                              <a:s r="80">
                                 <a:s>end of </a:s>
                                 <a:s r="79">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="84" locator="52:3-57:5" resultTypeName="fhir:Encounter" xsi:type="Last">
            <source localId="83" locator="53:5-56:27" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="66" locator="53:5-53:53" alias="EDVisit">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="65" locator="53:5-53:45" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <codes locator="53:17-53:44" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                  </expression>
               </source>
               <where localId="78" locator="54:7-55:88" resultTypeName="t:Boolean" xsi:type="And">
                  <operand localId="70" locator="54:13-54:39" resultTypeName="t:Boolean" xsi:type="Equal">
                     <operand localId="68" locator="54:13-54:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                        <source path="status" scope="EDVisit" xsi:type="Property"/>
                     </operand>
                     <operand localId="69" locator="54:30-54:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                  </operand>
                  <operand localId="77" locator="55:13-55:88" resultTypeName="t:Boolean" xsi:type="And">
                     <operand locator="55:33-55:46" xsi:type="In">
                        <operand locator="55:28-55:31" xsi:type="End">
                           <operand localId="72" locator="55:13-55:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand path="period" scope="EDVisit" xsi:type="Property"/>
                           </operand>
                        </operand>
                        <operand locator="55:33-55:46" lowClosed="true" highClosed="true" xsi:type="Interval">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <low locator="55:61-55:88" xsi:type="Subtract">
                              <operand localId="75" locator="55:61-55:88" resultTypeName="t:DateTime" xsi:type="Start">
                                 <operand localId="74" locator="55:70-55:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" xsi:type="Property">
                                       <source localId="73" locator="55:70-55:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                              <operand localId="76" locator="55:33-55:38" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                           </low>
                           <high localId="75" locator="55:61-55:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <operand localId="74" locator="55:70-55:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="73" locator="55:70-55:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </high>
                        </operand>
                     </operand>
                     <operand locator="55:33-55:46" xsi:type="Not">
                        <operand locator="55:33-55:46" xsi:type="IsNull">
                           <operand localId="75" locator="55:61-55:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <operand localId="74" locator="55:70-55:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="73" locator="55:70-55:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="82" locator="56:7-56:27">
                  <by localId="81" locator="56:15-56:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="80" locator="56:15-56:27" resultTypeName="t:DateTime" xsi:type="End">
                        <operand localId="79" locator="56:22-56:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="64" locator="51:41-51:49" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="107" locator="62:1-68:5" resultTypeName="fhir:Encounter" name="edVisit" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="107">
               <a:s>/*
Returns the most recent emergency department visit, if any, that occurs 1 hour or less prior to the given encounter.
*/
define fluent function edVisit(TheEncounter </a:s>
               <a:s r="86">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="106">
                  <a:s r="106">
                     <a:s>Last(
    </a:s>
                     <a:s r="105">
                        <a:s>
                           <a:s r="88">
                              <a:s r="87">
                                 <a:s r="87">
                                    <a:s>[Encounter: </a:s>
                                    <a:s>
                                       <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                    </a:s>
                                    <a:s>]</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> EDVisit</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="100">
                           <a:s>where </a:s>
                           <a:s r="100">
                              <a:s r="92">
                                 <a:s r="90">
                                    <a:s r="89">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="90">
                                       <a:s>status</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="91">
                                    <a:s>'finished'</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        and </a:s>
                              <a:s r="99">
                                 <a:s r="94">
                                    <a:s r="93">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="94">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="99">
                                    <a:s>ends </a:s>
                                    <a:s r="98">
                                       <a:s>1 hour</a:s>
                                    </a:s>
                                    <a:s> or less on or before</a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="97">
                                    <a:s>start of </a:s>
                                    <a:s r="96">
                                       <a:s r="95">
                                          <a:s>TheEncounter</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="96">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="104">
                           <a:s>sort by </a:s>
                           <a:s r="103">
                              <a:s r="102">
                                 <a:s>end of </a:s>
                                 <a:s r="101">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="106" locator="63:3-68:5" resultTypeName="fhir:Encounter" xsi:type="Last">
            <source localId="105" locator="64:5-67:27" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="88" locator="64:5-64:53" alias="EDVisit">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="87" locator="64:5-64:45" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <codes locator="64:17-64:44" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                  </expression>
               </source>
               <where localId="100" locator="65:7-66:88" resultTypeName="t:Boolean" xsi:type="And">
                  <operand localId="92" locator="65:13-65:39" resultTypeName="t:Boolean" xsi:type="Equal">
                     <operand localId="90" locator="65:13-65:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                        <source path="status" scope="EDVisit" xsi:type="Property"/>
                     </operand>
                     <operand localId="91" locator="65:30-65:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                  </operand>
                  <operand localId="99" locator="66:13-66:88" resultTypeName="t:Boolean" xsi:type="And">
                     <operand locator="66:33-66:46" xsi:type="In">
                        <operand locator="66:28-66:31" xsi:type="End">
                           <operand localId="94" locator="66:13-66:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand path="period" scope="EDVisit" xsi:type="Property"/>
                           </operand>
                        </operand>
                        <operand locator="66:33-66:46" lowClosed="true" highClosed="true" xsi:type="Interval">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <low locator="66:61-66:88" xsi:type="Subtract">
                              <operand localId="97" locator="66:61-66:88" resultTypeName="t:DateTime" xsi:type="Start">
                                 <operand localId="96" locator="66:70-66:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" xsi:type="Property">
                                       <source localId="95" locator="66:70-66:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                              <operand localId="98" locator="66:33-66:38" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                           </low>
                           <high localId="97" locator="66:61-66:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <operand localId="96" locator="66:70-66:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="95" locator="66:70-66:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </high>
                        </operand>
                     </operand>
                     <operand locator="66:33-66:46" xsi:type="Not">
                        <operand locator="66:33-66:46" xsi:type="IsNull">
                           <operand localId="97" locator="66:61-66:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <operand localId="96" locator="66:70-66:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="95" locator="66:70-66:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="104" locator="67:7-67:27">
                  <by localId="103" locator="67:15-67:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="102" locator="67:15-67:27" resultTypeName="t:DateTime" xsi:type="End">
                        <operand localId="101" locator="67:22-67:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="86" locator="62:45-62:53" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="126" locator="73:1-77:68" name="Hospitalization" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="126">
               <a:s>/*
Hospitalization returns the total interval for admission to discharge for the given encounter, or for the admission of any immediately prior emergency department visit to the discharge of the given encounter.
*/
define function &quot;Hospitalization&quot;(TheEncounter </a:s>
               <a:s r="108">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="125">
                  <a:s r="125">
                     <a:s>
                        <a:s r="111">
                           <a:s r="110">
                              <a:s>( </a:s>
                              <a:s r="110">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="109">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> X</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="124">
                        <a:s>return
        </a:s>
                        <a:s r="123">
                           <a:s>if </a:s>
                           <a:s r="113">
                              <a:s r="112">
                                 <a:s>X</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="115">
                              <a:s r="114">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="115">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="122">
                              <a:s>Interval[</a:s>
                              <a:s r="118">
                                 <a:s>start of </a:s>
                                 <a:s r="117">
                                    <a:s r="116">
                                       <a:s>X</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="117">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="121">
                                 <a:s>end of </a:s>
                                 <a:s r="120">
                                    <a:s r="119">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="120">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="125" locator="74:3-77:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="111" locator="74:3-74:32" resultTypeName="fhir:Encounter" alias="X">
               <expression localId="110" locator="74:3-74:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <operand localId="109" locator="74:16-74:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="124" locator="75:5-77:68">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="123" locator="76:9-77:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="113" locator="76:12-76:20" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <operand localId="112" locator="76:12" resultTypeName="fhir:Encounter" name="X" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="115" locator="76:27-76:45" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <operand path="period" xsi:type="Property">
                        <source localId="114" locator="76:27-76:38" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                     </operand>
                  </then>
                  <else localId="122" locator="77:14-77:68" lowClosed="true" highClosed="false" xsi:type="Interval">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <low localId="118" locator="77:23-77:39" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="117" locator="77:32-77:39" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" scope="X" xsi:type="Property"/>
                        </operand>
                     </low>
                     <high localId="121" locator="77:42-77:67" resultTypeName="t:DateTime" xsi:type="End">
                        <operand localId="120" locator="77:49-77:67" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="119" locator="77:49-77:60" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </high>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="108" locator="73:48-73:56" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="145" locator="82:1-86:68" name="hospitalization" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="145">
               <a:s>/*
Hospitalization returns the total interval for admission to discharge for the given encounter, or for the admission of any immediately prior emergency department visit to the discharge of the given encounter.
*/
define fluent function hospitalization(TheEncounter </a:s>
               <a:s r="127">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="144">
                  <a:s r="144">
                     <a:s>
                        <a:s r="130">
                           <a:s r="129">
                              <a:s>( </a:s>
                              <a:s r="129">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="128">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> X</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="143">
                        <a:s>return
        </a:s>
                        <a:s r="142">
                           <a:s>if </a:s>
                           <a:s r="132">
                              <a:s r="131">
                                 <a:s>X</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="134">
                              <a:s r="133">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="134">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="141">
                              <a:s>Interval[</a:s>
                              <a:s r="137">
                                 <a:s>start of </a:s>
                                 <a:s r="136">
                                    <a:s r="135">
                                       <a:s>X</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="136">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="140">
                                 <a:s>end of </a:s>
                                 <a:s r="139">
                                    <a:s r="138">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="139">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="144" locator="83:3-86:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="130" locator="83:3-83:32" resultTypeName="fhir:Encounter" alias="X">
               <expression localId="129" locator="83:3-83:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <operand localId="128" locator="83:16-83:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="143" locator="84:5-86:68">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="142" locator="85:9-86:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="132" locator="85:12-85:20" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <operand localId="131" locator="85:12" resultTypeName="fhir:Encounter" name="X" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="134" locator="85:27-85:45" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <operand path="period" xsi:type="Property">
                        <source localId="133" locator="85:27-85:38" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                     </operand>
                  </then>
                  <else localId="141" locator="86:14-86:68" lowClosed="true" highClosed="true" xsi:type="Interval">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <low localId="137" locator="86:23-86:39" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="136" locator="86:32-86:39" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" scope="X" xsi:type="Property"/>
                        </operand>
                     </low>
                     <high localId="140" locator="86:42-86:67" resultTypeName="t:DateTime" xsi:type="End">
                        <operand localId="139" locator="86:49-86:67" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="138" locator="86:49-86:60" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </high>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="127" locator="82:53-82:61" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="163" locator="91:1-95:68" name="Hospitalization Locations" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="163">
               <a:s>/*
Returns list of all locations within an encounter, including locations for immediately prior ED visit.
*/
define function &quot;Hospitalization Locations&quot;(TheEncounter </a:s>
               <a:s r="146">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="162">
                  <a:s r="162">
                     <a:s>
                        <a:s r="149">
                           <a:s r="148">
                              <a:s>( </a:s>
                              <a:s r="148">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="147">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> EDEncounter</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="161">
                        <a:s>return
        </a:s>
                        <a:s r="160">
                           <a:s>if </a:s>
                           <a:s r="151">
                              <a:s r="150">
                                 <a:s>EDEncounter</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="153">
                              <a:s r="152">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="153">
                                 <a:s>location</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="159">
                              <a:s>flatten </a:s>
                              <a:s r="158">
                                 <a:s>{ </a:s>
                                 <a:s r="155">
                                    <a:s r="154">
                                       <a:s>EDEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="155">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="157">
                                    <a:s r="156">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="157">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="162" locator="92:3-95:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="149" locator="92:3-92:42" resultTypeName="fhir:Encounter" alias="EDEncounter">
               <expression localId="148" locator="92:3-92:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <operand localId="147" locator="92:16-92:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="161" locator="93:5-95:68">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="160" locator="94:9-95:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="151" locator="94:12-94:30" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <operand localId="150" locator="94:12-94:22" resultTypeName="fhir:Encounter" name="EDEncounter" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="153" locator="94:37-94:57" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="152" locator="94:37-94:48" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                  </then>
                  <else localId="159" locator="95:14-95:68" xsi:type="Flatten">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <operand localId="158" locator="95:22-95:68" xsi:type="List">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                        <element localId="155" locator="95:24-95:43" path="location" scope="EDEncounter" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </element>
                        <element localId="157" locator="95:46-95:66" path="location" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="156" locator="95:46-95:57" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                        </element>
                     </operand>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="146" locator="91:58-91:66" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="181" locator="100:1-104:68" name="hospitalizationLocations" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="181">
               <a:s>/*
Returns list of all locations within an encounter, including locations for immediately prior ED visit.
*/
define fluent function hospitalizationLocations(TheEncounter </a:s>
               <a:s r="164">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="180">
                  <a:s r="180">
                     <a:s>
                        <a:s r="167">
                           <a:s r="166">
                              <a:s>( </a:s>
                              <a:s r="166">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="165">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> EDEncounter</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="179">
                        <a:s>return
        </a:s>
                        <a:s r="178">
                           <a:s>if </a:s>
                           <a:s r="169">
                              <a:s r="168">
                                 <a:s>EDEncounter</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="171">
                              <a:s r="170">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="171">
                                 <a:s>location</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="177">
                              <a:s>flatten </a:s>
                              <a:s r="176">
                                 <a:s>{ </a:s>
                                 <a:s r="173">
                                    <a:s r="172">
                                       <a:s>EDEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="173">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="175">
                                    <a:s r="174">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="175">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="180" locator="101:3-104:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="167" locator="101:3-101:42" resultTypeName="fhir:Encounter" alias="EDEncounter">
               <expression localId="166" locator="101:3-101:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <operand localId="165" locator="101:16-101:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="179" locator="102:5-104:68">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="178" locator="103:9-104:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="169" locator="103:12-103:30" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <operand localId="168" locator="103:12-103:22" resultTypeName="fhir:Encounter" name="EDEncounter" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="171" locator="103:37-103:57" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="170" locator="103:37-103:48" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                  </then>
                  <else localId="177" locator="104:14-104:68" xsi:type="Flatten">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <operand localId="176" locator="104:22-104:68" xsi:type="List">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                        <element localId="173" locator="104:24-104:43" path="location" scope="EDEncounter" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </element>
                        <element localId="175" locator="104:46-104:66" path="location" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="174" locator="104:46-104:57" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                        </element>
                     </operand>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="164" locator="100:62-100:70" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="186" locator="109:1-110:47" resultTypeName="t:Integer" name="Hospitalization Length of Stay" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="186">
               <a:s>/*
Returns the length of stay in days (i.e. the number of days between admission and discharge) for the given encounter, or from the admission of any immediately prior emergency department visit to the discharge of the encounter
*/
define function &quot;Hospitalization Length of Stay&quot;(TheEncounter </a:s>
               <a:s r="182">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="185">
                  <a:s r="185">
                     <a:s>LengthInDays(</a:s>
                     <a:s r="184">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="183">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="185" locator="110:3-110:47" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <operand localId="184" locator="110:16-110:46" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand localId="183" locator="110:34-110:45" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="182" locator="109:63-109:71" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="191" locator="115:1-116:47" resultTypeName="t:Integer" name="hospitalizationLengthOfStay" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="191">
               <a:s>/*
Returns the length of stay in days (i.e. the number of days between admission and discharge) for the given encounter, or from the admission of any immediately prior emergency department visit to the discharge of the encounter
*/
define fluent function hospitalizationLengthOfStay(TheEncounter </a:s>
               <a:s r="187">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="190">
                  <a:s r="190">
                     <a:s>LengthInDays(</a:s>
                     <a:s r="189">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="188">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="190" locator="116:3-116:47" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <operand localId="189" locator="116:16-116:46" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand localId="188" locator="116:34-116:45" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="187" locator="115:65-115:73" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="196" locator="121:1-122:42" resultTypeName="t:DateTime" name="Hospital Admission Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="196">
               <a:s>/*
Returns admission time for an encounter or for immediately prior emergency department visit.
*/
define function &quot;Hospital Admission Time&quot;(TheEncounter </a:s>
               <a:s r="192">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="195">
                  <a:s r="195">
                     <a:s>start of </a:s>
                     <a:s r="194">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="193">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="195" locator="122:3-122:42" resultTypeName="t:DateTime" xsi:type="Start">
            <operand localId="194" locator="122:12-122:42" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand localId="193" locator="122:30-122:41" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="192" locator="121:56-121:64" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="201" locator="127:1-128:42" resultTypeName="t:DateTime" name="hospitalAdmissionTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="201">
               <a:s>/*
Returns admission time for an encounter or for immediately prior emergency department visit.
*/
define fluent function hospitalAdmissionTime(TheEncounter </a:s>
               <a:s r="197">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="200">
                  <a:s r="200">
                     <a:s>start of </a:s>
                     <a:s r="199">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="198">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="200" locator="128:3-128:42" resultTypeName="t:DateTime" xsi:type="Start">
            <operand localId="199" locator="128:12-128:42" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand localId="198" locator="128:30-128:41" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="197" locator="127:59-127:67" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="206" locator="133:1-134:28" resultTypeName="t:DateTime" name="Hospital Discharge Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="206">
               <a:s>/*
Hospital Discharge Time returns the discharge time for an encounter
*/
define function &quot;Hospital Discharge Time&quot;(TheEncounter </a:s>
               <a:s r="202">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="205">
                  <a:s r="205">
                     <a:s>end of </a:s>
                     <a:s r="204">
                        <a:s r="203">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="204">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="205" locator="134:3-134:28" resultTypeName="t:DateTime" xsi:type="End">
            <operand localId="204" locator="134:10-134:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="203" locator="134:10-134:21" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="202" locator="133:56-133:64" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="211" locator="139:1-140:28" resultTypeName="t:DateTime" name="hospitalDischargeTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="211">
               <a:s>/*
Hospital Discharge Time returns the discharge time for an encounter
*/
define fluent function hospitalDischargeTime(TheEncounter </a:s>
               <a:s r="207">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="210">
                  <a:s r="210">
                     <a:s>end of </a:s>
                     <a:s r="209">
                        <a:s r="208">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="209">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="210" locator="140:3-140:28" resultTypeName="t:DateTime" xsi:type="End">
            <operand localId="209" locator="140:10-140:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="208" locator="140:10-140:21" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="207" locator="139:59-139:67" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="224" locator="145:1-149:11" resultTypeName="t:DateTime" name="Hospital Arrival Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="224">
               <a:s>/*
Returns earliest arrival time for an encounter including any prior ED visit.
*/
define function &quot;Hospital Arrival Time&quot;(TheEncounter </a:s>
               <a:s r="212">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="223">
                  <a:s r="223">
                     <a:s>start of </a:s>
                     <a:s r="222">
                        <a:s r="221">
                           <a:s>First(
       </a:s>
                           <a:s r="220">
                              <a:s>
                                 <a:s r="215">
                                    <a:s r="214">
                                       <a:s>( </a:s>
                                       <a:s r="214">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="213">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         </a:s>
                              <a:s r="219">
                                 <a:s>sort by </a:s>
                                 <a:s r="218">
                                    <a:s r="217">
                                       <a:s>start of </a:s>
                                       <a:s r="216">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
   )</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="222">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="223" locator="146:3-149:11" resultTypeName="t:DateTime" xsi:type="Start">
            <operand localId="222" locator="146:12-149:11" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="221" locator="146:12-149:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
                     <source localId="220" locator="147:8-148:28" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="215" locator="147:8-147:69" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="214" locator="147:8-147:52" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand localId="213" locator="147:38-147:49" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="219" locator="148:6-148:28">
                           <by localId="218" locator="148:14-148:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="217" locator="148:14-148:28" resultTypeName="t:DateTime" xsi:type="Start">
                                 <operand localId="216" locator="148:23-148:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="212" locator="145:54-145:62" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="237" locator="154:1-158:11" resultTypeName="t:DateTime" name="hospitalArrivalTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="237">
               <a:s>/*
Returns earliest arrival time for an encounter including any prior ED visit.
*/
define fluent function hospitalArrivalTime(TheEncounter </a:s>
               <a:s r="225">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="236">
                  <a:s r="236">
                     <a:s>start of </a:s>
                     <a:s r="235">
                        <a:s r="234">
                           <a:s>First(
       </a:s>
                           <a:s r="233">
                              <a:s>
                                 <a:s r="228">
                                    <a:s r="227">
                                       <a:s>( </a:s>
                                       <a:s r="227">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="226">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         </a:s>
                              <a:s r="232">
                                 <a:s>sort by </a:s>
                                 <a:s r="231">
                                    <a:s r="230">
                                       <a:s>start of </a:s>
                                       <a:s r="229">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
   )</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="235">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="236" locator="155:3-158:11" resultTypeName="t:DateTime" xsi:type="Start">
            <operand localId="235" locator="155:12-158:11" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="234" locator="155:12-158:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
                     <source localId="233" locator="156:8-157:28" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="228" locator="156:8-156:69" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="227" locator="156:8-156:52" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand localId="226" locator="156:38-156:49" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="232" locator="157:6-157:28">
                           <by localId="231" locator="157:14-157:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="230" locator="157:14-157:28" resultTypeName="t:DateTime" xsi:type="Start">
                                 <operand localId="229" locator="157:23-157:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="225" locator="154:57-154:65" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="250" locator="163:1-167:9" resultTypeName="t:DateTime" name="Hospital Departure Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="250">
               <a:s>/*
Returns the latest departure time for encounter including any prior ED visit. 
*/
define function &quot;Hospital Departure Time&quot;(TheEncounter </a:s>
               <a:s r="238">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
   </a:s>
               <a:s r="249">
                  <a:s r="249">
                     <a:s>end of </a:s>
                     <a:s r="248">
                        <a:s r="247">
                           <a:s>Last(
       </a:s>
                           <a:s r="246">
                              <a:s>
                                 <a:s r="241">
                                    <a:s r="240">
                                       <a:s>( </a:s>
                                       <a:s r="240">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="239">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         </a:s>
                              <a:s r="245">
                                 <a:s>sort by </a:s>
                                 <a:s r="244">
                                    <a:s r="243">
                                       <a:s>start of </a:s>
                                       <a:s r="242">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
   )</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="248">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="249" locator="164:2-167:9" resultTypeName="t:DateTime" xsi:type="End">
            <operand localId="248" locator="164:9-167:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="247" locator="164:9-167:2" resultTypeName="fhir:Encounter.Location" xsi:type="Last">
                     <source localId="246" locator="165:6-166:26" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="241" locator="165:6-165:67" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="240" locator="165:6-165:50" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand localId="239" locator="165:36-165:47" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="245" locator="166:4-166:26">
                           <by localId="244" locator="166:12-166:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="243" locator="166:12-166:26" resultTypeName="t:DateTime" xsi:type="Start">
                                 <operand localId="242" locator="166:21-166:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="238" locator="163:56-163:64" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="263" locator="172:1-176:9" resultTypeName="t:DateTime" name="hospitalDepartureTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="263">
               <a:s>/*
Returns the latest departure time for encounter including any prior ED visit. 
*/
define fluent function hospitalDepartureTime(TheEncounter </a:s>
               <a:s r="251">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
   </a:s>
               <a:s r="262">
                  <a:s r="262">
                     <a:s>end of </a:s>
                     <a:s r="261">
                        <a:s r="260">
                           <a:s>Last(
       </a:s>
                           <a:s r="259">
                              <a:s>
                                 <a:s r="254">
                                    <a:s r="253">
                                       <a:s>( </a:s>
                                       <a:s r="253">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="252">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         </a:s>
                              <a:s r="258">
                                 <a:s>sort by </a:s>
                                 <a:s r="257">
                                    <a:s r="256">
                                       <a:s>start of </a:s>
                                       <a:s r="255">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
   )</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="261">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="262" locator="173:2-176:9" resultTypeName="t:DateTime" xsi:type="End">
            <operand localId="261" locator="173:9-176:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="260" locator="173:9-176:2" resultTypeName="fhir:Encounter.Location" xsi:type="Last">
                     <source localId="259" locator="174:6-175:26" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="254" locator="174:6-174:67" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="253" locator="174:6-174:50" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand localId="252" locator="174:36-174:47" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="258" locator="175:4-175:26">
                           <by localId="257" locator="175:12-175:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="256" locator="175:12-175:26" resultTypeName="t:DateTime" xsi:type="Start">
                                 <operand localId="255" locator="175:21-175:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="251" locator="172:59-172:67" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="281" locator="354:1-357:3" resultTypeName="fhir:Location" name="GetLocation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="281">
               <a:s>/*
Returns the Location resource specified by the given reference
*/
define function &quot;GetLocation&quot;(reference </a:s>
               <a:s r="270">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="280">
                  <a:s r="280">
                     <a:s>singleton from </a:s>
                     <a:s r="279">
                        <a:s>(
    </a:s>
                        <a:s r="279">
                           <a:s>
                              <a:s r="272">
                                 <a:s r="271">
                                    <a:s r="271">
                                       <a:s>[Location]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> L</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="278">
                              <a:s>where </a:s>
                              <a:s r="278">
                                 <a:s r="274">
                                    <a:s r="273">
                                       <a:s>L</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="274">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="277">
                                    <a:s r="276">
                                       <a:s r="275">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="276">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="277">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="280" locator="355:3-357:3" resultTypeName="fhir:Location" xsi:type="SingletonFrom">
            <operand localId="279" locator="355:18-357:3" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="272" locator="356:5-356:16" alias="L">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="271" locator="356:5-356:14" dataType="fhir:Location" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-location" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="278" locator="356:18-356:57" resultTypeName="t:Boolean" xsi:type="Equal">
                  <operand localId="274" locator="356:24-356:27" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="L" xsi:type="Property"/>
                  </operand>
                  <operand localId="277" locator="356:31-356:57" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <operand localId="276" locator="356:31-356:49" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="275" locator="356:31-356:39" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="270" locator="354:41-354:49" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="290" locator="178:1-184:9" resultTypeName="t:DateTime" name="Emergency Department Arrival Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="290">
               <a:s>define function &quot;Emergency Department Arrival Time&quot;(TheEncounter </a:s>
               <a:s r="264">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
   </a:s>
               <a:s r="289">
                  <a:s r="289">
                     <a:s>start of </a:s>
                     <a:s r="288">
                        <a:s r="287">
                           <a:s>(
       </a:s>
                           <a:s r="287">
                              <a:s>singleton from </a:s>
                              <a:s r="286">
                                 <a:s>(
           </a:s>
                                 <a:s r="286">
                                    <a:s>
                                       <a:s r="267">
                                          <a:s r="266">
                                             <a:s>( </a:s>
                                             <a:s r="266">
                                                <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                                <a:s r="265">
                                                   <a:s>TheEncounter</a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s> )</a:s>
                                          </a:s>
                                          <a:s> HospitalLocation</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
            </a:s>
                                    <a:s r="285">
                                       <a:s>where </a:s>
                                       <a:s r="285">
                                          <a:s r="283">
                                             <a:s r="282">
                                                <a:s>GetLocation(</a:s>
                                                <a:s r="269">
                                                   <a:s r="268">
                                                      <a:s>HospitalLocation</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="269">
                                                      <a:s>location</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="283">
                                                <a:s>type</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s r="284">
                                             <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
      )</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
   )</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="288">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="289" locator="179:2-184:9" resultTypeName="t:DateTime" xsi:type="Start">
            <operand localId="288" locator="179:11-184:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="287" locator="179:11-184:2" resultTypeName="fhir:Encounter.Location" xsi:type="SingletonFrom">
                     <operand localId="286" locator="180:21-183:3" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="267" locator="181:10-181:71" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="266" locator="181:10-181:54" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand localId="265" locator="181:40-181:51" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <where localId="285" locator="182:5-182:85" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                           <codes localId="283" locator="182:11-182:53" xsi:type="Query">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <source alias="$this">
                                 <expression path="type" xsi:type="Property">
                                    <source localId="282" locator="182:11-182:48" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                       <operand localId="269" locator="182:23-182:47" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                                    </source>
                                 </expression>
                              </source>
                              <return distinct="false">
                                 <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <operand name="$this" xsi:type="AliasRef"/>
                                 </expression>
                              </return>
                           </codes>
                           <valueset localId="284" locator="182:58-182:85" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true"/>
                        </where>
                     </operand>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="264" locator="178:66-178:74" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="305" locator="186:1-192:9" resultTypeName="t:DateTime" name="emergencyDepartmentArrivalTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="305">
               <a:s>define fluent function emergencyDepartmentArrivalTime(TheEncounter </a:s>
               <a:s r="291">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
   </a:s>
               <a:s r="304">
                  <a:s r="304">
                     <a:s>start of </a:s>
                     <a:s r="303">
                        <a:s r="302">
                           <a:s>(
       </a:s>
                           <a:s r="302">
                              <a:s>singleton from </a:s>
                              <a:s r="301">
                                 <a:s>(
           </a:s>
                                 <a:s r="301">
                                    <a:s>
                                       <a:s r="294">
                                          <a:s r="293">
                                             <a:s>( </a:s>
                                             <a:s r="293">
                                                <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                                <a:s r="292">
                                                   <a:s>TheEncounter</a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s> )</a:s>
                                          </a:s>
                                          <a:s> HospitalLocation</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
            </a:s>
                                    <a:s r="300">
                                       <a:s>where </a:s>
                                       <a:s r="300">
                                          <a:s r="298">
                                             <a:s r="297">
                                                <a:s>GetLocation(</a:s>
                                                <a:s r="296">
                                                   <a:s r="295">
                                                      <a:s>HospitalLocation</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="296">
                                                      <a:s>location</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="298">
                                                <a:s>type</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s r="299">
                                             <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
      )</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
   )</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="303">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="304" locator="187:2-192:9" resultTypeName="t:DateTime" xsi:type="Start">
            <operand localId="303" locator="187:11-192:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="302" locator="187:11-192:2" resultTypeName="fhir:Encounter.Location" xsi:type="SingletonFrom">
                     <operand localId="301" locator="188:21-191:3" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="294" locator="189:10-189:71" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="293" locator="189:10-189:54" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand localId="292" locator="189:40-189:51" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <where localId="300" locator="190:5-190:85" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                           <codes localId="298" locator="190:11-190:53" xsi:type="Query">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <source alias="$this">
                                 <expression path="type" xsi:type="Property">
                                    <source localId="297" locator="190:11-190:48" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                       <operand localId="296" locator="190:23-190:47" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                                    </source>
                                 </expression>
                              </source>
                              <return distinct="false">
                                 <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <operand name="$this" xsi:type="AliasRef"/>
                                 </expression>
                              </return>
                           </codes>
                           <valueset localId="299" locator="190:58-190:85" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true"/>
                        </where>
                     </operand>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="291" locator="186:68-186:76" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="388" locator="197:1-215:107" name="HospitalizationWithObservationAndOutpatientSurgeryService" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="388">
               <a:s>/*
Hospitalization with Observation and Outpatient Surgery Service returns the total interval from the start of any immediately prior emergency department visit, outpatient surgery visit or observation visit to the discharge of the given encounter.
*/
define function &quot;HospitalizationWithObservationAndOutpatientSurgeryService&quot;(TheEncounter </a:s>
               <a:s r="306">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="387">
                  <a:s r="387">
                     <a:s>
                        <a:s r="308">
                           <a:s r="307">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
     </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="329">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="328">
                              <a:s>Last(</a:s>
                              <a:s r="327">
                                 <a:s>
                                    <a:s r="310">
                                       <a:s r="309">
                                          <a:s r="309">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
         </a:s>
                                 <a:s r="322">
                                    <a:s>where </a:s>
                                    <a:s r="322">
                                       <a:s r="314">
                                          <a:s r="312">
                                             <a:s r="311">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="312">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="313">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="321">
                                          <a:s r="316">
                                             <a:s r="315">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="316">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="321">
                                             <a:s>ends </a:s>
                                             <a:s r="320">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="319">
                                             <a:s>start of </a:s>
                                             <a:s r="318">
                                                <a:s r="317">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="318">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="326">
                                    <a:s>sort by   </a:s>
                                    <a:s r="325">
                                       <a:s r="324">
                                          <a:s>end of </a:s>
                                          <a:s r="323">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
      )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="337">
                           <a:s>VisitStart: </a:s>
                           <a:s r="336">
                              <a:s>Coalesce(</a:s>
                              <a:s r="332">
                                 <a:s>start of </a:s>
                                 <a:s r="331">
                                    <a:s r="330">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="331">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="335">
                                 <a:s>start of </a:s>
                                 <a:s r="334">
                                    <a:s r="333">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="334">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="356">
                           <a:s>EDVisit: </a:s>
                           <a:s r="355">
                              <a:s>Last(</a:s>
                              <a:s r="354">
                                 <a:s>
                                    <a:s r="339">
                                       <a:s r="338">
                                          <a:s r="338">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="349">
                                    <a:s>where </a:s>
                                    <a:s r="349">
                                       <a:s r="343">
                                          <a:s r="341">
                                             <a:s r="340">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="341">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="342">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="348">
                                          <a:s r="345">
                                             <a:s r="344">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="345">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="348">
                                             <a:s>ends </a:s>
                                             <a:s r="347">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="346">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="353">
                                    <a:s>sort by   </a:s>
                                    <a:s r="352">
                                       <a:s r="351">
                                          <a:s>end of </a:s>
                                          <a:s r="350">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
      )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="362">
                           <a:s>VisitStartWithED: </a:s>
                           <a:s r="361">
                              <a:s>Coalesce(</a:s>
                              <a:s r="359">
                                 <a:s>start of </a:s>
                                 <a:s r="358">
                                    <a:s r="357">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="358">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="360">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="376">
                           <a:s>OutpatientSurgeryVisit: </a:s>
                           <a:s r="375">
                              <a:s>Last(</a:s>
                              <a:s r="374">
                                 <a:s>
                                    <a:s r="364">
                                       <a:s r="363">
                                          <a:s r="363">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Outpatient Surgery Service&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastSurgeryOP</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="369">
                                    <a:s>where </a:s>
                                    <a:s r="369">
                                       <a:s r="366">
                                          <a:s r="365">
                                             <a:s>LastSurgeryOP</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="366">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="369">
                                          <a:s>ends </a:s>
                                          <a:s r="368">
                                             <a:s>1 hour</a:s>
                                          </a:s>
                                          <a:s> or less on or before</a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="367">
                                          <a:s>VisitStartWithED</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="373">
                                    <a:s>sort by   </a:s>
                                    <a:s r="372">
                                       <a:s r="371">
                                          <a:s>end of </a:s>
                                          <a:s r="370">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
      )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
   </a:s>
                     <a:s r="386">
                        <a:s>return </a:s>
                        <a:s r="385">
                           <a:s>Interval[</a:s>
                           <a:s r="381">
                              <a:s>Coalesce(</a:s>
                              <a:s r="379">
                                 <a:s>start of </a:s>
                                 <a:s r="378">
                                    <a:s r="377">
                                       <a:s>OutpatientSurgeryVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="378">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="380">
                                 <a:s>VisitStartWithED</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="384">
                              <a:s>end of </a:s>
                              <a:s r="383">
                                 <a:s r="382">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="383">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="387" locator="198:3-215:107" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="308" locator="198:3-198:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="307" locator="198:3-198:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="329" locator="199:8-203:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="328" locator="199:18-203:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="327" locator="199:23-202:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="310" locator="199:23-199:65" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="309" locator="199:23-199:57" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="199:35-199:56" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="322" locator="200:6-201:83" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="314" locator="200:12-200:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="312" locator="200:12-200:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="313" locator="200:29-200:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="321" locator="201:15-201:83" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="201:35-201:48" xsi:type="In">
                              <operand locator="201:30-201:33" xsi:type="End">
                                 <operand localId="316" locator="201:15-201:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="201:35-201:48" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="201:63-201:83" xsi:type="Subtract">
                                    <operand localId="319" locator="201:63-201:83" resultTypeName="t:DateTime" xsi:type="Start">
                                       <operand localId="318" locator="201:72-201:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="320" locator="201:35-201:40" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="319" locator="201:63-201:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="318" locator="201:72-201:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="201:35-201:48" xsi:type="Not">
                              <operand locator="201:35-201:48" xsi:type="IsNull">
                                 <operand localId="319" locator="201:63-201:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="318" locator="201:72-201:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="326" locator="202:6-202:26">
                        <by localId="325" locator="202:14-202:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="324" locator="202:14-202:26" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="323" locator="202:21-202:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="337" locator="204:6-204:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="336" locator="204:18-204:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <operand localId="332" locator="204:27-204:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="331" locator="204:36-204:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="330" locator="204:36-204:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="335" locator="204:53-204:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="334" locator="204:62-204:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="356" locator="205:6-209:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="355" locator="205:15-209:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="354" locator="205:20-208:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="339" locator="205:20-205:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="338" locator="205:20-205:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="205:32-205:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="349" locator="206:6-207:71" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="343" locator="206:12-206:37" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="341" locator="206:12-206:24" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="342" locator="206:28-206:37" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="348" locator="207:15-207:71" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="207:34-207:47" xsi:type="In">
                              <operand locator="207:29-207:32" xsi:type="End">
                                 <operand localId="345" locator="207:15-207:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="207:34-207:47" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="207:62-207:71" xsi:type="Subtract">
                                    <operand localId="346" locator="207:62-207:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="347" locator="207:34-207:39" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="346" locator="207:62-207:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="207:34-207:47" xsi:type="Not">
                              <operand locator="207:34-207:47" xsi:type="IsNull">
                                 <operand localId="346" locator="207:62-207:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="353" locator="208:6-208:26">
                        <by localId="352" locator="208:14-208:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="351" locator="208:14-208:26" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="350" locator="208:21-208:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="362" locator="210:6-210:68" resultTypeName="t:DateTime" identifier="VisitStartWithED">
               <expression localId="361" locator="210:24-210:68" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <operand localId="359" locator="210:33-210:55" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="358" locator="210:42-210:55" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="357" locator="210:42-210:48" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="360" locator="210:58-210:67" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="376" locator="211:6-214:6" resultTypeName="fhir:Encounter" identifier="OutpatientSurgeryVisit">
               <expression localId="375" locator="211:30-214:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="374" locator="211:35-213:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="364" locator="211:35-211:89" alias="LastSurgeryOP">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="363" locator="211:35-211:75" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="211:47-211:74" resultTypeName="t:ValueSet" name="Outpatient Surgery Service" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="369" locator="212:6-212:81" resultTypeName="t:Boolean" xsi:type="And">
                        <operand locator="212:38-212:51" xsi:type="In">
                           <operand locator="212:33-212:36" xsi:type="End">
                              <operand localId="366" locator="212:12-212:31" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" scope="LastSurgeryOP" xsi:type="Property"/>
                              </operand>
                           </operand>
                           <operand locator="212:38-212:51" lowClosed="true" highClosed="true" xsi:type="Interval">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <low locator="212:66-212:81" xsi:type="Subtract">
                                 <operand localId="367" locator="212:66-212:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                                 <operand localId="368" locator="212:38-212:43" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                              </low>
                              <high localId="367" locator="212:66-212:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                        <operand locator="212:38-212:51" xsi:type="Not">
                           <operand locator="212:38-212:51" xsi:type="IsNull">
                              <operand localId="367" locator="212:66-212:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="373" locator="213:6-213:26">
                        <by localId="372" locator="213:14-213:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="371" locator="213:14-213:26" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="370" locator="213:21-213:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="386" locator="215:4-215:107">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="385" locator="215:11-215:107" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="381" locator="215:20-215:85" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <operand localId="379" locator="215:29-215:66" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="378" locator="215:38-215:66" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="377" locator="215:38-215:59" resultTypeName="fhir:Encounter" name="OutpatientSurgeryVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="380" locator="215:69-215:84" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="384" locator="215:88-215:106" resultTypeName="t:DateTime" xsi:type="End">
                     <operand localId="383" locator="215:95-215:106" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="306" locator="197:90-197:100" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="471" locator="220:1-238:107" name="hospitalizationWithObservationAndOutpatientSurgeryService" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="471">
               <a:s>/*
Hospitalization with Observation and Outpatient Surgery Service returns the total interval from the start of any immediately prior emergency department visit, outpatient surgery visit or observation visit to the discharge of the given encounter.
*/
define fluent function hospitalizationWithObservationAndOutpatientSurgeryService(TheEncounter </a:s>
               <a:s r="389">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="470">
                  <a:s r="470">
                     <a:s>
                        <a:s r="391">
                           <a:s r="390">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
     </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="412">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="411">
                              <a:s>Last(</a:s>
                              <a:s r="410">
                                 <a:s>
                                    <a:s r="393">
                                       <a:s r="392">
                                          <a:s r="392">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
         </a:s>
                                 <a:s r="405">
                                    <a:s>where </a:s>
                                    <a:s r="405">
                                       <a:s r="397">
                                          <a:s r="395">
                                             <a:s r="394">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="395">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="396">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="404">
                                          <a:s r="399">
                                             <a:s r="398">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="399">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="404">
                                             <a:s>ends </a:s>
                                             <a:s r="403">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="402">
                                             <a:s>start of </a:s>
                                             <a:s r="401">
                                                <a:s r="400">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="401">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="409">
                                    <a:s>sort by   </a:s>
                                    <a:s r="408">
                                       <a:s r="407">
                                          <a:s>end of </a:s>
                                          <a:s r="406">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
      )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="420">
                           <a:s>VisitStart: </a:s>
                           <a:s r="419">
                              <a:s>Coalesce(</a:s>
                              <a:s r="415">
                                 <a:s>start of </a:s>
                                 <a:s r="414">
                                    <a:s r="413">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="414">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="418">
                                 <a:s>start of </a:s>
                                 <a:s r="417">
                                    <a:s r="416">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="417">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="439">
                           <a:s>EDVisit: </a:s>
                           <a:s r="438">
                              <a:s>Last(</a:s>
                              <a:s r="437">
                                 <a:s>
                                    <a:s r="422">
                                       <a:s r="421">
                                          <a:s r="421">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="432">
                                    <a:s>where </a:s>
                                    <a:s r="432">
                                       <a:s r="426">
                                          <a:s r="424">
                                             <a:s r="423">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="424">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="425">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="431">
                                          <a:s r="428">
                                             <a:s r="427">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="428">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="431">
                                             <a:s>ends </a:s>
                                             <a:s r="430">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="429">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="436">
                                    <a:s>sort by   </a:s>
                                    <a:s r="435">
                                       <a:s r="434">
                                          <a:s>end of </a:s>
                                          <a:s r="433">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
      )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="445">
                           <a:s>VisitStartWithED: </a:s>
                           <a:s r="444">
                              <a:s>Coalesce(</a:s>
                              <a:s r="442">
                                 <a:s>start of </a:s>
                                 <a:s r="441">
                                    <a:s r="440">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="441">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="443">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="459">
                           <a:s>OutpatientSurgeryVisit: </a:s>
                           <a:s r="458">
                              <a:s>Last(</a:s>
                              <a:s r="457">
                                 <a:s>
                                    <a:s r="447">
                                       <a:s r="446">
                                          <a:s r="446">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Outpatient Surgery Service&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastSurgeryOP</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="452">
                                    <a:s>where </a:s>
                                    <a:s r="452">
                                       <a:s r="449">
                                          <a:s r="448">
                                             <a:s>LastSurgeryOP</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="449">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="452">
                                          <a:s>ends </a:s>
                                          <a:s r="451">
                                             <a:s>1 hour</a:s>
                                          </a:s>
                                          <a:s> or less on or before</a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="450">
                                          <a:s>VisitStartWithED</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
           </a:s>
                                 <a:s r="456">
                                    <a:s>sort by   </a:s>
                                    <a:s r="455">
                                       <a:s r="454">
                                          <a:s>end of </a:s>
                                          <a:s r="453">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
      )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
   </a:s>
                     <a:s r="469">
                        <a:s>return </a:s>
                        <a:s r="468">
                           <a:s>Interval[</a:s>
                           <a:s r="464">
                              <a:s>Coalesce(</a:s>
                              <a:s r="462">
                                 <a:s>start of </a:s>
                                 <a:s r="461">
                                    <a:s r="460">
                                       <a:s>OutpatientSurgeryVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="461">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="463">
                                 <a:s>VisitStartWithED</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="467">
                              <a:s>end of </a:s>
                              <a:s r="466">
                                 <a:s r="465">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="466">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="470" locator="221:3-238:107" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="391" locator="221:3-221:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="390" locator="221:3-221:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="412" locator="222:8-226:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="411" locator="222:18-226:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="410" locator="222:23-225:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="393" locator="222:23-222:65" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="392" locator="222:23-222:57" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="222:35-222:56" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="405" locator="223:6-224:83" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="397" locator="223:12-223:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="395" locator="223:12-223:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="396" locator="223:29-223:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="404" locator="224:15-224:83" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="224:35-224:48" xsi:type="In">
                              <operand locator="224:30-224:33" xsi:type="End">
                                 <operand localId="399" locator="224:15-224:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="224:35-224:48" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="224:63-224:83" xsi:type="Subtract">
                                    <operand localId="402" locator="224:63-224:83" resultTypeName="t:DateTime" xsi:type="Start">
                                       <operand localId="401" locator="224:72-224:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="403" locator="224:35-224:40" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="402" locator="224:63-224:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="401" locator="224:72-224:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="224:35-224:48" xsi:type="Not">
                              <operand locator="224:35-224:48" xsi:type="IsNull">
                                 <operand localId="402" locator="224:63-224:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="401" locator="224:72-224:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="409" locator="225:6-225:26">
                        <by localId="408" locator="225:14-225:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="407" locator="225:14-225:26" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="406" locator="225:21-225:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="420" locator="227:6-227:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="419" locator="227:18-227:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <operand localId="415" locator="227:27-227:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="414" locator="227:36-227:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="413" locator="227:36-227:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="418" locator="227:53-227:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="417" locator="227:62-227:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="439" locator="228:6-232:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="438" locator="228:15-232:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="437" locator="228:20-231:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="422" locator="228:20-228:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="421" locator="228:20-228:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="228:32-228:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="432" locator="229:6-230:71" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="426" locator="229:12-229:37" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="424" locator="229:12-229:24" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="425" locator="229:28-229:37" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="431" locator="230:15-230:71" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="230:34-230:47" xsi:type="In">
                              <operand locator="230:29-230:32" xsi:type="End">
                                 <operand localId="428" locator="230:15-230:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="230:34-230:47" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="230:62-230:71" xsi:type="Subtract">
                                    <operand localId="429" locator="230:62-230:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="430" locator="230:34-230:39" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="429" locator="230:62-230:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="230:34-230:47" xsi:type="Not">
                              <operand locator="230:34-230:47" xsi:type="IsNull">
                                 <operand localId="429" locator="230:62-230:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="436" locator="231:6-231:26">
                        <by localId="435" locator="231:14-231:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="434" locator="231:14-231:26" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="433" locator="231:21-231:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="445" locator="233:6-233:68" resultTypeName="t:DateTime" identifier="VisitStartWithED">
               <expression localId="444" locator="233:24-233:68" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <operand localId="442" locator="233:33-233:55" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="441" locator="233:42-233:55" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="440" locator="233:42-233:48" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="443" locator="233:58-233:67" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="459" locator="234:6-237:6" resultTypeName="fhir:Encounter" identifier="OutpatientSurgeryVisit">
               <expression localId="458" locator="234:30-237:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="457" locator="234:35-236:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="447" locator="234:35-234:89" alias="LastSurgeryOP">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="446" locator="234:35-234:75" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="234:47-234:74" resultTypeName="t:ValueSet" name="Outpatient Surgery Service" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="452" locator="235:6-235:81" resultTypeName="t:Boolean" xsi:type="And">
                        <operand locator="235:38-235:51" xsi:type="In">
                           <operand locator="235:33-235:36" xsi:type="End">
                              <operand localId="449" locator="235:12-235:31" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" scope="LastSurgeryOP" xsi:type="Property"/>
                              </operand>
                           </operand>
                           <operand locator="235:38-235:51" lowClosed="true" highClosed="true" xsi:type="Interval">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <low locator="235:66-235:81" xsi:type="Subtract">
                                 <operand localId="450" locator="235:66-235:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                                 <operand localId="451" locator="235:38-235:43" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                              </low>
                              <high localId="450" locator="235:66-235:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                        <operand locator="235:38-235:51" xsi:type="Not">
                           <operand locator="235:38-235:51" xsi:type="IsNull">
                              <operand localId="450" locator="235:66-235:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="456" locator="236:6-236:26">
                        <by localId="455" locator="236:14-236:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="454" locator="236:14-236:26" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="453" locator="236:21-236:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="469" locator="238:4-238:107">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="468" locator="238:11-238:107" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="464" locator="238:20-238:85" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <operand localId="462" locator="238:29-238:66" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="461" locator="238:38-238:66" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="460" locator="238:38-238:59" resultTypeName="fhir:Encounter" name="OutpatientSurgeryVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="463" locator="238:69-238:84" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="467" locator="238:88-238:106" resultTypeName="t:DateTime" xsi:type="End">
                     <operand localId="466" locator="238:95-238:106" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="389" locator="220:95-220:105" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="534" locator="243:1-256:87" name="HospitalizationWithObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="534">
               <a:s>/*
Hospitalization with Observation returns the total interval from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define function &quot;HospitalizationWithObservation&quot;(TheEncounter </a:s>
               <a:s r="472">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="533">
                  <a:s r="533">
                     <a:s>
                        <a:s r="474">
                           <a:s r="473">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="495">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="494">
                              <a:s>Last(</a:s>
                              <a:s r="493">
                                 <a:s>
                                    <a:s r="476">
                                       <a:s r="475">
                                          <a:s r="475">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="488">
                                    <a:s>where </a:s>
                                    <a:s r="488">
                                       <a:s r="480">
                                          <a:s r="478">
                                             <a:s r="477">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="478">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="479">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="487">
                                          <a:s r="482">
                                             <a:s r="481">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="482">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="487">
                                             <a:s>ends </a:s>
                                             <a:s r="486">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="485">
                                             <a:s>start of </a:s>
                                             <a:s r="484">
                                                <a:s r="483">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="484">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="492">
                                    <a:s>sort by </a:s>
                                    <a:s r="491">
                                       <a:s r="490">
                                          <a:s>end of </a:s>
                                          <a:s r="489">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
         </a:s>
                        <a:s r="503">
                           <a:s>VisitStart: </a:s>
                           <a:s r="502">
                              <a:s>Coalesce(</a:s>
                              <a:s r="498">
                                 <a:s>start of </a:s>
                                 <a:s r="497">
                                    <a:s r="496">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="497">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="501">
                                 <a:s>start of </a:s>
                                 <a:s r="500">
                                    <a:s r="499">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="500">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
         </a:s>
                        <a:s r="522">
                           <a:s>EDVisit: </a:s>
                           <a:s r="521">
                              <a:s>Last(</a:s>
                              <a:s r="520">
                                 <a:s>
                                    <a:s r="505">
                                       <a:s r="504">
                                          <a:s r="504">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="515">
                                    <a:s>where </a:s>
                                    <a:s r="515">
                                       <a:s r="509">
                                          <a:s r="507">
                                             <a:s r="506">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="507">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="508">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="514">
                                          <a:s r="511">
                                             <a:s r="510">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="511">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="514">
                                             <a:s>ends </a:s>
                                             <a:s r="513">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="512">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="519">
                                    <a:s>sort by </a:s>
                                    <a:s r="518">
                                       <a:s r="517">
                                          <a:s>end of </a:s>
                                          <a:s r="516">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="532">
                        <a:s>return </a:s>
                        <a:s r="531">
                           <a:s>Interval[</a:s>
                           <a:s r="527">
                              <a:s>Coalesce(</a:s>
                              <a:s r="525">
                                 <a:s>start of </a:s>
                                 <a:s r="524">
                                    <a:s r="523">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="524">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="526">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="530">
                              <a:s>end of </a:s>
                              <a:s r="529">
                                 <a:s r="528">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="529">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="533" locator="244:3-256:87" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="474" locator="244:3-244:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="473" locator="244:3-244:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="495" locator="245:9-249:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="494" locator="245:19-249:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="493" locator="245:24-248:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="476" locator="245:24-245:66" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="475" locator="245:24-245:58" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="245:36-245:57" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="488" locator="246:7-247:85" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="480" locator="246:13-246:39" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="478" locator="246:13-246:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="479" locator="246:30-246:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="487" locator="247:17-247:85" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="247:37-247:50" xsi:type="In">
                              <operand locator="247:32-247:35" xsi:type="End">
                                 <operand localId="482" locator="247:17-247:30" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="247:37-247:50" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="247:65-247:85" xsi:type="Subtract">
                                    <operand localId="485" locator="247:65-247:85" resultTypeName="t:DateTime" xsi:type="Start">
                                       <operand localId="484" locator="247:74-247:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="486" locator="247:37-247:42" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="485" locator="247:65-247:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="484" locator="247:74-247:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="247:37-247:50" xsi:type="Not">
                              <operand locator="247:37-247:50" xsi:type="IsNull">
                                 <operand localId="485" locator="247:65-247:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="484" locator="247:74-247:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="492" locator="248:7-248:27">
                        <by localId="491" locator="248:15-248:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="490" locator="248:15-248:27" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="489" locator="248:22-248:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="503" locator="250:6-250:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="502" locator="250:18-250:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <operand localId="498" locator="250:27-250:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="497" locator="250:36-250:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="496" locator="250:36-250:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="501" locator="250:53-250:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="500" locator="250:62-250:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="522" locator="251:6-255:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="521" locator="251:15-255:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="520" locator="251:20-254:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="505" locator="251:20-251:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="504" locator="251:20-251:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="251:32-251:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="515" locator="252:7-253:73" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="509" locator="252:13-252:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="507" locator="252:13-252:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="508" locator="252:29-252:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="514" locator="253:17-253:73" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="253:36-253:49" xsi:type="In">
                              <operand locator="253:31-253:34" xsi:type="End">
                                 <operand localId="511" locator="253:17-253:29" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="253:36-253:49" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="253:64-253:73" xsi:type="Subtract">
                                    <operand localId="512" locator="253:64-253:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="513" locator="253:36-253:41" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="512" locator="253:64-253:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="253:36-253:49" xsi:type="Not">
                              <operand locator="253:36-253:49" xsi:type="IsNull">
                                 <operand localId="512" locator="253:64-253:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="519" locator="254:7-254:27">
                        <by localId="518" locator="254:15-254:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="517" locator="254:15-254:27" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="516" locator="254:22-254:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="532" locator="256:5-256:87">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="531" locator="256:12-256:87" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="527" locator="256:21-256:65" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <operand localId="525" locator="256:30-256:52" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="524" locator="256:39-256:52" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="523" locator="256:39-256:45" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="526" locator="256:55-256:64" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="530" locator="256:68-256:86" resultTypeName="t:DateTime" xsi:type="End">
                     <operand localId="529" locator="256:75-256:86" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="472" locator="243:63-243:71" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="597" locator="261:1-274:87" name="hospitalizationWithObservation" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="597">
               <a:s>/*
Hospitalization with Observation returns the total interval from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define fluent function hospitalizationWithObservation(TheEncounter </a:s>
               <a:s r="535">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="596">
                  <a:s r="596">
                     <a:s>
                        <a:s r="537">
                           <a:s r="536">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="558">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="557">
                              <a:s>Last(</a:s>
                              <a:s r="556">
                                 <a:s>
                                    <a:s r="539">
                                       <a:s r="538">
                                          <a:s r="538">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="551">
                                    <a:s>where </a:s>
                                    <a:s r="551">
                                       <a:s r="543">
                                          <a:s r="541">
                                             <a:s r="540">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="541">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="542">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="550">
                                          <a:s r="545">
                                             <a:s r="544">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="545">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="550">
                                             <a:s>ends </a:s>
                                             <a:s r="549">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="548">
                                             <a:s>start of </a:s>
                                             <a:s r="547">
                                                <a:s r="546">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="547">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="555">
                                    <a:s>sort by </a:s>
                                    <a:s r="554">
                                       <a:s r="553">
                                          <a:s>end of </a:s>
                                          <a:s r="552">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
         </a:s>
                        <a:s r="566">
                           <a:s>VisitStart: </a:s>
                           <a:s r="565">
                              <a:s>Coalesce(</a:s>
                              <a:s r="561">
                                 <a:s>start of </a:s>
                                 <a:s r="560">
                                    <a:s r="559">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="560">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="564">
                                 <a:s>start of </a:s>
                                 <a:s r="563">
                                    <a:s r="562">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="563">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
         </a:s>
                        <a:s r="585">
                           <a:s>EDVisit: </a:s>
                           <a:s r="584">
                              <a:s>Last(</a:s>
                              <a:s r="583">
                                 <a:s>
                                    <a:s r="568">
                                       <a:s r="567">
                                          <a:s r="567">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="578">
                                    <a:s>where </a:s>
                                    <a:s r="578">
                                       <a:s r="572">
                                          <a:s r="570">
                                             <a:s r="569">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="570">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="571">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="577">
                                          <a:s r="574">
                                             <a:s r="573">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="574">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="577">
                                             <a:s>ends </a:s>
                                             <a:s r="576">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="575">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="582">
                                    <a:s>sort by </a:s>
                                    <a:s r="581">
                                       <a:s r="580">
                                          <a:s>end of </a:s>
                                          <a:s r="579">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
         )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="595">
                        <a:s>return </a:s>
                        <a:s r="594">
                           <a:s>Interval[</a:s>
                           <a:s r="590">
                              <a:s>Coalesce(</a:s>
                              <a:s r="588">
                                 <a:s>start of </a:s>
                                 <a:s r="587">
                                    <a:s r="586">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="587">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="589">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="593">
                              <a:s>end of </a:s>
                              <a:s r="592">
                                 <a:s r="591">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="592">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="596" locator="262:3-274:87" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="537" locator="262:3-262:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="536" locator="262:3-262:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="558" locator="263:9-267:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="557" locator="263:19-267:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="556" locator="263:24-266:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="539" locator="263:24-263:66" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="538" locator="263:24-263:58" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="263:36-263:57" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="551" locator="264:7-265:85" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="543" locator="264:13-264:39" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="541" locator="264:13-264:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="542" locator="264:30-264:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="550" locator="265:17-265:85" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="265:37-265:50" xsi:type="In">
                              <operand locator="265:32-265:35" xsi:type="End">
                                 <operand localId="545" locator="265:17-265:30" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="265:37-265:50" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="265:65-265:85" xsi:type="Subtract">
                                    <operand localId="548" locator="265:65-265:85" resultTypeName="t:DateTime" xsi:type="Start">
                                       <operand localId="547" locator="265:74-265:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="549" locator="265:37-265:42" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="548" locator="265:65-265:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="547" locator="265:74-265:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="265:37-265:50" xsi:type="Not">
                              <operand locator="265:37-265:50" xsi:type="IsNull">
                                 <operand localId="548" locator="265:65-265:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <operand localId="547" locator="265:74-265:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="555" locator="266:7-266:27">
                        <by localId="554" locator="266:15-266:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="553" locator="266:15-266:27" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="552" locator="266:22-266:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="566" locator="268:6-268:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="565" locator="268:18-268:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <operand localId="561" locator="268:27-268:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="560" locator="268:36-268:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="559" locator="268:36-268:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="564" locator="268:53-268:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <operand localId="563" locator="268:62-268:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="585" locator="269:6-273:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="584" locator="269:15-273:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <source localId="583" locator="269:20-272:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="568" locator="269:20-269:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="567" locator="269:20-269:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="269:32-269:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="578" locator="270:7-271:73" resultTypeName="t:Boolean" xsi:type="And">
                        <operand localId="572" locator="270:13-270:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="570" locator="270:13-270:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="571" locator="270:29-270:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="577" locator="271:17-271:73" resultTypeName="t:Boolean" xsi:type="And">
                           <operand locator="271:36-271:49" xsi:type="In">
                              <operand locator="271:31-271:34" xsi:type="End">
                                 <operand localId="574" locator="271:17-271:29" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="271:36-271:49" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="271:64-271:73" xsi:type="Subtract">
                                    <operand localId="575" locator="271:64-271:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="576" locator="271:36-271:41" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="575" locator="271:64-271:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="271:36-271:49" xsi:type="Not">
                              <operand locator="271:36-271:49" xsi:type="IsNull">
                                 <operand localId="575" locator="271:64-271:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="582" locator="272:7-272:27">
                        <by localId="581" locator="272:15-272:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="580" locator="272:15-272:27" resultTypeName="t:DateTime" xsi:type="End">
                              <operand localId="579" locator="272:22-272:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="595" locator="274:5-274:87">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="594" locator="274:12-274:87" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="590" locator="274:21-274:65" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <operand localId="588" locator="274:30-274:52" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="587" locator="274:39-274:52" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="586" locator="274:39-274:45" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="589" locator="274:55-274:64" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="593" locator="274:68-274:86" resultTypeName="t:DateTime" xsi:type="End">
                     <operand localId="592" locator="274:75-274:86" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="535" locator="261:68-261:76" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="602" locator="279:1-280:64" resultTypeName="t:Integer" name="HospitalizationWithObservationLengthofStay" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="602">
               <a:s>/*
Hospitalization with Observation Length of Stay returns the length in days from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define function &quot;HospitalizationWithObservationLengthofStay&quot;(TheEncounter </a:s>
               <a:s r="598">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="601">
                  <a:s r="601">
                     <a:s>&quot;LengthInDays&quot;(</a:s>
                     <a:s r="600">
                        <a:s>&quot;HospitalizationWithObservation&quot;(</a:s>
                        <a:s r="599">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="601" locator="280:3-280:64" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <operand localId="600" locator="280:18-280:63" name="HospitalizationWithObservation" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand localId="599" locator="280:51-280:62" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="598" locator="279:75-279:85" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="607" locator="285:1-286:64" resultTypeName="t:Integer" name="hospitalizationWithObservationLengthofStay" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="607">
               <a:s>/*
Hospitalization with Observation Length of Stay returns the length in days from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define fluent function hospitalizationWithObservationLengthofStay(TheEncounter </a:s>
               <a:s r="603">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="606">
                  <a:s r="606">
                     <a:s>&quot;LengthInDays&quot;(</a:s>
                     <a:s r="605">
                        <a:s>&quot;HospitalizationWithObservation&quot;(</a:s>
                        <a:s r="604">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="606" locator="286:3-286:64" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <operand localId="605" locator="286:18-286:63" name="HospitalizationWithObservation" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand localId="604" locator="286:51-286:62" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="603" locator="285:80-285:90" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="630" locator="291:1-296:4" resultTypeName="fhir:Encounter.Location" name="FirstInpatientIntensiveCareUnit" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="630">
               <a:s>/*
First Inpatient Intensive Care Unit returns the first intensive care unit for the given encounter, without considering any immediately prior emergency department visit.
*/
define function &quot;FirstInpatientIntensiveCareUnit&quot;(Encounter </a:s>
               <a:s r="608">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="629">
                  <a:s r="629">
                     <a:s>First(</a:s>
                     <a:s r="628">
                        <a:s>
                           <a:s r="611">
                              <a:s r="610">
                                 <a:s>(</a:s>
                                 <a:s r="610">
                                    <a:s r="609">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="610">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>HospitalLocation</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
         </a:s>
                        <a:s r="623">
                           <a:s>where </a:s>
                           <a:s r="623">
                              <a:s r="617">
                                 <a:s r="615">
                                    <a:s r="614">
                                       <a:s>GetLocation(</a:s>
                                       <a:s r="613">
                                          <a:s r="612">
                                             <a:s>HospitalLocation</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="613">
                                             <a:s>location</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="615">
                                       <a:s>type</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> in </a:s>
                                 <a:s r="616">
                                    <a:s>&quot;Intensive Care Unit&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
            and </a:s>
                              <a:s r="622">
                                 <a:s r="619">
                                    <a:s r="618">
                                       <a:s>HospitalLocation</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="619">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="622"> during </a:s>
                                 <a:s r="621">
                                    <a:s r="620">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="621">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
         </a:s>
                        <a:s r="627">
                           <a:s>sort by </a:s>
                           <a:s r="626">
                              <a:s r="625">
                                 <a:s>start of </a:s>
                                 <a:s r="624">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
   )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="629" locator="292:3-296:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
            <source localId="628" locator="292:9-295:28" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="611" locator="292:9-292:44" alias="HospitalLocation">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="610" locator="292:9-292:28" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="609" locator="292:10-292:18" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                  </expression>
               </source>
               <where localId="623" locator="293:6-294:57" resultTypeName="t:Boolean" xsi:type="And">
                  <operand localId="617" locator="293:12-293:79" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                     <codes localId="615" locator="293:12-293:54" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source alias="$this">
                           <expression path="type" xsi:type="Property">
                              <source localId="614" locator="293:12-293:49" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                 <operand localId="613" locator="293:24-293:48" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                              </source>
                           </expression>
                        </source>
                        <return distinct="false">
                           <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <operand name="$this" xsi:type="AliasRef"/>
                           </expression>
                        </return>
                     </codes>
                     <valueset localId="616" locator="293:59-293:79" resultTypeName="t:ValueSet" name="Intensive Care Unit" preserve="true"/>
                  </operand>
                  <operand localId="622" locator="294:11-294:57" resultTypeName="t:Boolean" xsi:type="IncludedIn">
                     <operand localId="619" locator="294:11-294:33" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="HospitalLocation" xsi:type="Property"/>
                     </operand>
                     <operand localId="621" locator="294:42-294:57" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="620" locator="294:42-294:50" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="627" locator="295:6-295:28">
                  <by localId="626" locator="295:14-295:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="625" locator="295:14-295:28" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="624" locator="295:23-295:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="608" locator="291:61-291:69" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="653" locator="301:1-306:4" resultTypeName="fhir:Encounter.Location" name="firstInpatientIntensiveCareUnit" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="653">
               <a:s>/*
First Inpatient Intensive Care Unit returns the first intensive care unit for the given encounter, without considering any immediately prior emergency department visit.
*/
define fluent function firstInpatientIntensiveCareUnit(Encounter </a:s>
               <a:s r="631">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="652">
                  <a:s r="652">
                     <a:s>First(</a:s>
                     <a:s r="651">
                        <a:s>
                           <a:s r="634">
                              <a:s r="633">
                                 <a:s>(</a:s>
                                 <a:s r="633">
                                    <a:s r="632">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="633">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>HospitalLocation</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
         </a:s>
                        <a:s r="646">
                           <a:s>where </a:s>
                           <a:s r="646">
                              <a:s r="640">
                                 <a:s r="638">
                                    <a:s r="637">
                                       <a:s>GetLocation(</a:s>
                                       <a:s r="636">
                                          <a:s r="635">
                                             <a:s>HospitalLocation</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="636">
                                             <a:s>location</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="638">
                                       <a:s>type</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> in </a:s>
                                 <a:s r="639">
                                    <a:s>&quot;Intensive Care Unit&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
            and </a:s>
                              <a:s r="645">
                                 <a:s r="642">
                                    <a:s r="641">
                                       <a:s>HospitalLocation</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="642">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="645"> during </a:s>
                                 <a:s r="644">
                                    <a:s r="643">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="644">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
         </a:s>
                        <a:s r="650">
                           <a:s>sort by </a:s>
                           <a:s r="649">
                              <a:s r="648">
                                 <a:s>start of </a:s>
                                 <a:s r="647">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
   )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="652" locator="302:3-306:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
            <source localId="651" locator="302:9-305:28" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="634" locator="302:9-302:44" alias="HospitalLocation">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="633" locator="302:9-302:28" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="632" locator="302:10-302:18" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                  </expression>
               </source>
               <where localId="646" locator="303:6-304:57" resultTypeName="t:Boolean" xsi:type="And">
                  <operand localId="640" locator="303:12-303:79" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                     <codes localId="638" locator="303:12-303:54" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source alias="$this">
                           <expression path="type" xsi:type="Property">
                              <source localId="637" locator="303:12-303:49" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                 <operand localId="636" locator="303:24-303:48" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                              </source>
                           </expression>
                        </source>
                        <return distinct="false">
                           <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <operand name="$this" xsi:type="AliasRef"/>
                           </expression>
                        </return>
                     </codes>
                     <valueset localId="639" locator="303:59-303:79" resultTypeName="t:ValueSet" name="Intensive Care Unit" preserve="true"/>
                  </operand>
                  <operand localId="645" locator="304:11-304:57" resultTypeName="t:Boolean" xsi:type="IncludedIn">
                     <operand localId="642" locator="304:11-304:33" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="HospitalLocation" xsi:type="Property"/>
                     </operand>
                     <operand localId="644" locator="304:42-304:57" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="643" locator="304:42-304:50" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="650" locator="305:6-305:28">
                  <by localId="649" locator="305:14-305:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="648" locator="305:14-305:28" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand localId="647" locator="305:23-305:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="631" locator="301:66-301:74" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="670" locator="311:1-313:81" name="EncounterDiagnosis" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="670">
               <a:s>/*
Returns the Condition resources referenced by the diagnosis element of the Encounter
*/
define function &quot;EncounterDiagnosis&quot;(Encounter </a:s>
               <a:s r="654">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="669">
                  <a:s r="669">
                     <a:s>
                        <a:s r="656">
                           <a:s r="655">
                              <a:s>
                                 <a:s>Encounter.diagnosis</a:s>
                              </a:s>
                           </a:s>
                           <a:s> D</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
   </a:s>
                     <a:s r="668">
                        <a:s>return </a:s>
                        <a:s r="667">
                           <a:s>singleton from </a:s>
                           <a:s r="666">
                              <a:s>(</a:s>
                              <a:s r="666">
                                 <a:s>
                                    <a:s r="658">
                                       <a:s r="657">
                                          <a:s r="657">
                                             <a:s>[Condition]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> C</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="665">
                                    <a:s>where </a:s>
                                    <a:s r="665">
                                       <a:s r="660">
                                          <a:s r="659">
                                             <a:s>C</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="660">
                                             <a:s>id</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="664">
                                          <a:s r="663">
                                             <a:s r="662">
                                                <a:s r="661">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="662">
                                                   <a:s>condition</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="663">
                                                <a:s>reference</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="664">
                                             <a:s>getId()</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="669" locator="312:3-313:81" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="656" locator="312:3-312:23" alias="D">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="655" locator="312:3-312:21" path="diagnosis" xsi:type="Property">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <source name="Encounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="668" locator="313:2-313:81">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="667" locator="313:9-313:81" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                  <operand localId="666" locator="313:24-313:81" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="658" locator="313:25-313:37" alias="C">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="657" locator="313:25-313:35" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </expression>
                     </source>
                     <where localId="665" locator="313:39-313:80" resultTypeName="t:Boolean" xsi:type="Equal">
                        <operand localId="660" locator="313:45-313:48" resultTypeName="t:String" path="value" xsi:type="Property">
                           <source path="id" scope="C" xsi:type="Property"/>
                        </operand>
                        <operand localId="664" locator="313:52-313:80" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                           <operand localId="663" locator="313:52-313:72" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="reference" xsi:type="Property">
                                 <source localId="662" locator="313:52-313:62" resultTypeName="fhir:Reference" path="condition" scope="D" xsi:type="Property"/>
                              </source>
                           </operand>
                        </operand>
                     </where>
                  </operand>
               </expression>
            </return>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="654" locator="311:48-311:56" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="687" locator="318:1-320:84" name="encounterDiagnosis" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="687">
               <a:s>/*
Returns the Condition resources referenced by the diagnosis element of the Encounter
*/
define fluent function encounterDiagnosis(Encounter </a:s>
               <a:s r="671">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="686">
                  <a:s r="686">
                     <a:s>
                        <a:s r="673">
                           <a:s r="672">
                              <a:s>
                                 <a:s>Encounter.diagnosis</a:s>
                              </a:s>
                           </a:s>
                           <a:s> D</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="685">
                        <a:s>return </a:s>
                        <a:s r="684">
                           <a:s>singleton from </a:s>
                           <a:s r="683">
                              <a:s>(</a:s>
                              <a:s r="683">
                                 <a:s>
                                    <a:s r="675">
                                       <a:s r="674">
                                          <a:s r="674">
                                             <a:s>[Condition]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> C</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="682">
                                    <a:s>where </a:s>
                                    <a:s r="682">
                                       <a:s r="677">
                                          <a:s r="676">
                                             <a:s>C</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="677">
                                             <a:s>id</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="681">
                                          <a:s r="680">
                                             <a:s r="679">
                                                <a:s r="678">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="679">
                                                   <a:s>condition</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="680">
                                                <a:s>reference</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="681">
                                             <a:s>getId()</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="686" locator="319:3-320:84" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="673" locator="319:3-319:23" alias="D">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="672" locator="319:3-319:21" path="diagnosis" xsi:type="Property">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <source name="Encounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="685" locator="320:5-320:84">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="684" locator="320:12-320:84" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                  <operand localId="683" locator="320:27-320:84" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="675" locator="320:28-320:40" alias="C">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="674" locator="320:28-320:38" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </expression>
                     </source>
                     <where localId="682" locator="320:42-320:83" resultTypeName="t:Boolean" xsi:type="Equal">
                        <operand localId="677" locator="320:48-320:51" resultTypeName="t:String" path="value" xsi:type="Property">
                           <source path="id" scope="C" xsi:type="Property"/>
                        </operand>
                        <operand localId="681" locator="320:55-320:83" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                           <operand localId="680" locator="320:55-320:75" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="reference" xsi:type="Property">
                                 <source localId="679" locator="320:55-320:65" resultTypeName="fhir:Reference" path="condition" scope="D" xsi:type="Property"/>
                              </source>
                           </operand>
                        </operand>
                     </where>
                  </operand>
               </expression>
            </return>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="671" locator="318:53-318:61" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="699" locator="326:1-327:73" resultTypeName="fhir:Condition" name="GetCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="699">
               <a:s>/*
Returns the Condition resource for the given reference
@deprecated
*/
define function &quot;GetCondition&quot;(reference </a:s>
               <a:s r="688">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="698">
                  <a:s r="698">
                     <a:s>singleton from </a:s>
                     <a:s r="697">
                        <a:s>(</a:s>
                        <a:s r="697">
                           <a:s>
                              <a:s r="690">
                                 <a:s r="689">
                                    <a:s r="689">
                                       <a:s>[Condition]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> C</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="696">
                              <a:s>where </a:s>
                              <a:s r="696">
                                 <a:s r="692">
                                    <a:s r="691">
                                       <a:s>C</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="692">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="695">
                                    <a:s r="694">
                                       <a:s r="693">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="694">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="695">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="698" locator="327:3-327:73" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <operand localId="697" locator="327:18-327:73" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="690" locator="327:19-327:31" alias="C">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="689" locator="327:19-327:29" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="696" locator="327:33-327:72" resultTypeName="t:Boolean" xsi:type="Equal">
                  <operand localId="692" locator="327:39-327:42" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand localId="695" locator="327:46-327:72" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <operand localId="694" locator="327:46-327:64" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="693" locator="327:46-327:54" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="688" locator="326:42-326:50" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="711" locator="332:1-333:73" resultTypeName="fhir:Condition" name="getCondition" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="711">
               <a:s>/*
Returns the Condition resource for the given reference
*/
define fluent function getCondition(reference </a:s>
               <a:s r="700">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="710">
                  <a:s r="710">
                     <a:s>singleton from </a:s>
                     <a:s r="709">
                        <a:s>(</a:s>
                        <a:s r="709">
                           <a:s>
                              <a:s r="702">
                                 <a:s r="701">
                                    <a:s r="701">
                                       <a:s>[Condition]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> C</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="708">
                              <a:s>where </a:s>
                              <a:s r="708">
                                 <a:s r="704">
                                    <a:s r="703">
                                       <a:s>C</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="704">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="707">
                                    <a:s r="706">
                                       <a:s r="705">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="706">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="707">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="710" locator="333:3-333:73" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <operand localId="709" locator="333:18-333:73" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="702" locator="333:19-333:31" alias="C">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="701" locator="333:19-333:29" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="708" locator="333:33-333:72" resultTypeName="t:Boolean" xsi:type="Equal">
                  <operand localId="704" locator="333:39-333:42" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand localId="707" locator="333:46-333:72" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <operand localId="706" locator="333:46-333:64" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="705" locator="333:46-333:54" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="700" locator="332:47-332:55" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="735" locator="338:1-341:2" resultTypeName="fhir:Condition" name="PrincipalDiagnosis" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="735">
               <a:s>/*
Returns the condition that is specified as the principal diagnosis for the encounter
*/
define function &quot;PrincipalDiagnosis&quot;(Encounter </a:s>
               <a:s r="712">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
   </a:s>
               <a:s r="734">
                  <a:s r="734">
                     <a:s>singleton from </a:s>
                     <a:s r="733">
                        <a:s>(</a:s>
                        <a:s r="733">
                           <a:s>
                              <a:s r="720">
                                 <a:s r="719">
                                    <a:s>(</a:s>
                                    <a:s r="719">
                                       <a:s>
                                          <a:s r="714">
                                             <a:s r="713">
                                                <a:s>
                                                   <a:s>Encounter.diagnosis</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> D</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="718">
                                          <a:s>where </a:s>
                                          <a:s r="718">
                                             <a:s r="716">
                                                <a:s r="715">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="716">
                                                   <a:s>rank</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s r="717"> = 1</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> PD</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      </a:s>
                           <a:s r="732">
                              <a:s>return </a:s>
                              <a:s r="731">
                                 <a:s>singleton from </a:s>
                                 <a:s r="730">
                                    <a:s>(</a:s>
                                    <a:s r="730">
                                       <a:s>
                                          <a:s r="722">
                                             <a:s r="721">
                                                <a:s r="721">
                                                   <a:s>[Condition]</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> C</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="729">
                                          <a:s>where </a:s>
                                          <a:s r="729">
                                             <a:s r="724">
                                                <a:s r="723">
                                                   <a:s>C</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="724">
                                                   <a:s>id</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> = </a:s>
                                             <a:s r="728">
                                                <a:s r="727">
                                                   <a:s r="726">
                                                      <a:s r="725">
                                                         <a:s>PD</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="726">
                                                         <a:s>condition</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="727">
                                                      <a:s>reference</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="728">
                                                   <a:s>getId()</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
   )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="734" locator="339:2-341:2" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <operand localId="733" locator="339:17-341:2" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="720" locator="339:18-339:60" alias="PD">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="719" locator="339:18-339:57" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="714" locator="339:19-339:39" alias="D">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="713" locator="339:19-339:37" path="diagnosis" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source name="Encounter" xsi:type="OperandRef"/>
                        </expression>
                     </source>
                     <where localId="718" locator="339:41-339:56" resultTypeName="t:Boolean" xsi:type="Equal">
                        <operand localId="716" locator="339:47-339:52" resultTypeName="t:Integer" path="value" xsi:type="Property">
                           <source path="rank" scope="D" xsi:type="Property"/>
                        </operand>
                        <operand localId="717" locator="339:56" resultTypeName="t:Integer" valueType="t:Integer" value="1" xsi:type="Literal"/>
                     </where>
                  </expression>
               </source>
               <return localId="732" locator="340:7-340:87">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="731" locator="340:14-340:87" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                     <operand localId="730" locator="340:29-340:87" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="722" locator="340:30-340:42" alias="C">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="721" locator="340:30-340:40" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="729" locator="340:44-340:86" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="724" locator="340:50-340:53" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="C" xsi:type="Property"/>
                           </operand>
                           <operand localId="728" locator="340:57-340:86" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <operand localId="727" locator="340:57-340:78" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="726" locator="340:57-340:68" resultTypeName="fhir:Reference" path="condition" scope="PD" xsi:type="Property"/>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </expression>
               </return>
            </operand>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="712" locator="338:48-338:56" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="759" locator="346:1-349:2" resultTypeName="fhir:Condition" name="principalDiagnosis" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="759">
               <a:s>/*
Returns the condition that is specified as the principal diagnosis for the encounter
*/
define fluent function principalDiagnosis(Encounter </a:s>
               <a:s r="736">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
   </a:s>
               <a:s r="758">
                  <a:s r="758">
                     <a:s>singleton from </a:s>
                     <a:s r="757">
                        <a:s>(</a:s>
                        <a:s r="757">
                           <a:s>
                              <a:s r="744">
                                 <a:s r="743">
                                    <a:s>(</a:s>
                                    <a:s r="743">
                                       <a:s>
                                          <a:s r="738">
                                             <a:s r="737">
                                                <a:s>
                                                   <a:s>Encounter.diagnosis</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> D</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="742">
                                          <a:s>where </a:s>
                                          <a:s r="742">
                                             <a:s r="740">
                                                <a:s r="739">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="740">
                                                   <a:s>rank</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s r="741"> = 1</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> PD</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      </a:s>
                           <a:s r="756">
                              <a:s>return </a:s>
                              <a:s r="755">
                                 <a:s>singleton from </a:s>
                                 <a:s r="754">
                                    <a:s>(</a:s>
                                    <a:s r="754">
                                       <a:s>
                                          <a:s r="746">
                                             <a:s r="745">
                                                <a:s r="745">
                                                   <a:s>[Condition]</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> C</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="753">
                                          <a:s>where </a:s>
                                          <a:s r="753">
                                             <a:s r="748">
                                                <a:s r="747">
                                                   <a:s>C</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="748">
                                                   <a:s>id</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> = </a:s>
                                             <a:s r="752">
                                                <a:s r="751">
                                                   <a:s r="750">
                                                      <a:s r="749">
                                                         <a:s>PD</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="750">
                                                         <a:s>condition</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="751">
                                                      <a:s>reference</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="752">
                                                   <a:s>getId()</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
   )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="758" locator="347:2-349:2" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <operand localId="757" locator="347:17-349:2" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="744" locator="347:18-347:60" alias="PD">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="743" locator="347:18-347:57" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="738" locator="347:19-347:39" alias="D">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="737" locator="347:19-347:37" path="diagnosis" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source name="Encounter" xsi:type="OperandRef"/>
                        </expression>
                     </source>
                     <where localId="742" locator="347:41-347:56" resultTypeName="t:Boolean" xsi:type="Equal">
                        <operand localId="740" locator="347:47-347:52" resultTypeName="t:Integer" path="value" xsi:type="Property">
                           <source path="rank" scope="D" xsi:type="Property"/>
                        </operand>
                        <operand localId="741" locator="347:56" resultTypeName="t:Integer" valueType="t:Integer" value="1" xsi:type="Literal"/>
                     </where>
                  </expression>
               </source>
               <return localId="756" locator="348:7-348:87">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="755" locator="348:14-348:87" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                     <operand localId="754" locator="348:29-348:87" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="746" locator="348:30-348:42" alias="C">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="745" locator="348:30-348:40" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="753" locator="348:44-348:86" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="748" locator="348:50-348:53" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="C" xsi:type="Property"/>
                           </operand>
                           <operand localId="752" locator="348:57-348:86" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <operand localId="751" locator="348:57-348:78" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="750" locator="348:57-348:68" resultTypeName="fhir:Reference" path="condition" scope="PD" xsi:type="Property"/>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </expression>
               </return>
            </operand>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="736" locator="346:53-346:61" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="773" locator="362:1-365:3" resultTypeName="fhir:Location" name="getLocation" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="773">
               <a:s>/*
Returns the Location resource specified by the given reference
*/
define fluent function getLocation(reference </a:s>
               <a:s r="762">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="772">
                  <a:s r="772">
                     <a:s>singleton from </a:s>
                     <a:s r="771">
                        <a:s>(
    </a:s>
                        <a:s r="771">
                           <a:s>
                              <a:s r="764">
                                 <a:s r="763">
                                    <a:s r="763">
                                       <a:s>[Location]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> L</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="770">
                              <a:s>where </a:s>
                              <a:s r="770">
                                 <a:s r="766">
                                    <a:s r="765">
                                       <a:s>L</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="766">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="769">
                                    <a:s r="768">
                                       <a:s r="767">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="768">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="769">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="772" locator="363:3-365:3" resultTypeName="fhir:Location" xsi:type="SingletonFrom">
            <operand localId="771" locator="363:18-365:3" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="764" locator="364:5-364:16" alias="L">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="763" locator="364:5-364:14" dataType="fhir:Location" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-location" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="770" locator="364:18-364:57" resultTypeName="t:Boolean" xsi:type="Equal">
                  <operand localId="766" locator="364:24-364:27" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="L" xsi:type="Property"/>
                  </operand>
                  <operand localId="769" locator="364:31-364:57" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <operand localId="768" locator="364:31-364:49" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="767" locator="364:31-364:39" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="762" locator="362:46-362:54" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="798" locator="370:1-374:108" resultTypeName="t:Concept" name="GetMedicationCode" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="798">
               <a:s>/*
Returns the medication code for the given MedicationRequest
*/
define function &quot;GetMedicationCode&quot;(request </a:s>
               <a:s r="774">
                  <a:s>MedicationRequest</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="797">
                  <a:s r="797">
                     <a:s>if </a:s>
                     <a:s r="778">
                        <a:s r="776">
                           <a:s r="775">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="776">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is </a:s>
                        <a:s r="777">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s> then
     </a:s>
                     <a:s r="782">
                        <a:s r="780">
                           <a:s r="779">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="780">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> as </a:s>
                        <a:s r="781">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
   else
     </a:s>
                     <a:s r="796">
                        <a:s r="795">
                           <a:s>(</a:s>
                           <a:s r="795">
                              <a:s>singleton from </a:s>
                              <a:s r="794">
                                 <a:s>(</a:s>
                                 <a:s r="794">
                                    <a:s>
                                       <a:s r="784">
                                          <a:s r="783">
                                             <a:s r="783">
                                                <a:s>[Medication]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> M</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> </a:s>
                                    <a:s r="793">
                                       <a:s>where </a:s>
                                       <a:s r="793">
                                          <a:s r="786">
                                             <a:s r="785">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="786">
                                                <a:s>id</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="792">
                                             <a:s r="791">
                                                <a:s r="790">
                                                   <a:s>(</a:s>
                                                   <a:s r="790">
                                                      <a:s r="788">
                                                         <a:s r="787">
                                                            <a:s>request</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="788">
                                                            <a:s>medication</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> as </a:s>
                                                      <a:s r="789">
                                                         <a:s>Reference</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="791">
                                                   <a:s>reference</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="792">
                                                <a:s>getId()</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="796">
                           <a:s>code</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="797" locator="371:3-374:108" resultTypeName="t:Concept" xsi:type="If">
            <condition localId="778" locator="371:6-371:34" resultTypeName="t:Boolean" xsi:type="Is">
               <operand localId="776" locator="371:6-371:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="775" locator="371:6-371:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <isTypeSpecifier localId="777" locator="371:28-371:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </condition>
            <then localId="782" locator="372:6-372:34" resultTypeName="t:Concept" strict="false" xsi:type="As">
               <operand localId="780" locator="372:6-372:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="779" locator="372:6-372:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <asTypeSpecifier localId="781" locator="372:28-372:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </then>
            <else localId="796" locator="374:6-374:108" resultTypeName="t:Concept" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <operand path="code" xsi:type="Property">
                  <source localId="795" locator="374:6-374:103" resultTypeName="fhir:Medication" xsi:type="SingletonFrom">
                     <operand localId="794" locator="374:22-374:102" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="784" locator="374:23-374:36" alias="M">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="783" locator="374:23-374:34" dataType="fhir:Medication" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-medication" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="793" locator="374:38-374:101" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="786" locator="374:44-374:47" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="M" xsi:type="Property"/>
                           </operand>
                           <operand localId="792" locator="374:51-374:101" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <operand localId="791" locator="374:51-374:93" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="790" locator="374:51-374:83" resultTypeName="fhir:Reference" strict="false" xsi:type="As">
                                       <operand localId="788" locator="374:52-374:69" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                                             <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                                             <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="medication" xsi:type="Property">
                                             <source localId="787" locator="374:52-374:58" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                                          </operand>
                                       </operand>
                                       <asTypeSpecifier localId="789" locator="374:74-374:82" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                    </source>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </source>
               </operand>
            </else>
         </expression>
         <operand name="request">
            <operandTypeSpecifier localId="774" locator="370:45-370:61" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="823" locator="379:1-383:108" resultTypeName="t:Concept" name="getMedicationCode" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="823">
               <a:s>/*
Returns the medication code for the given MedicationRequest
*/
define fluent function getMedicationCode(request </a:s>
               <a:s r="799">
                  <a:s>MedicationRequest</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="822">
                  <a:s r="822">
                     <a:s>if </a:s>
                     <a:s r="803">
                        <a:s r="801">
                           <a:s r="800">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="801">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is </a:s>
                        <a:s r="802">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s> then
     </a:s>
                     <a:s r="807">
                        <a:s r="805">
                           <a:s r="804">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="805">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> as </a:s>
                        <a:s r="806">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
   else
     </a:s>
                     <a:s r="821">
                        <a:s r="820">
                           <a:s>(</a:s>
                           <a:s r="820">
                              <a:s>singleton from </a:s>
                              <a:s r="819">
                                 <a:s>(</a:s>
                                 <a:s r="819">
                                    <a:s>
                                       <a:s r="809">
                                          <a:s r="808">
                                             <a:s r="808">
                                                <a:s>[Medication]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> M</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> </a:s>
                                    <a:s r="818">
                                       <a:s>where </a:s>
                                       <a:s r="818">
                                          <a:s r="811">
                                             <a:s r="810">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="811">
                                                <a:s>id</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="817">
                                             <a:s r="816">
                                                <a:s r="815">
                                                   <a:s>(</a:s>
                                                   <a:s r="815">
                                                      <a:s r="813">
                                                         <a:s r="812">
                                                            <a:s>request</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="813">
                                                            <a:s>medication</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> as </a:s>
                                                      <a:s r="814">
                                                         <a:s>Reference</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="816">
                                                   <a:s>reference</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="817">
                                                <a:s>getId()</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="821">
                           <a:s>code</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="822" locator="380:3-383:108" resultTypeName="t:Concept" xsi:type="If">
            <condition localId="803" locator="380:6-380:34" resultTypeName="t:Boolean" xsi:type="Is">
               <operand localId="801" locator="380:6-380:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="800" locator="380:6-380:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <isTypeSpecifier localId="802" locator="380:28-380:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </condition>
            <then localId="807" locator="381:6-381:34" resultTypeName="t:Concept" strict="false" xsi:type="As">
               <operand localId="805" locator="381:6-381:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="804" locator="381:6-381:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <asTypeSpecifier localId="806" locator="381:28-381:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </then>
            <else localId="821" locator="383:6-383:108" resultTypeName="t:Concept" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <operand path="code" xsi:type="Property">
                  <source localId="820" locator="383:6-383:103" resultTypeName="fhir:Medication" xsi:type="SingletonFrom">
                     <operand localId="819" locator="383:22-383:102" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="809" locator="383:23-383:36" alias="M">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="808" locator="383:23-383:34" dataType="fhir:Medication" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-medication" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="818" locator="383:38-383:101" resultTypeName="t:Boolean" xsi:type="Equal">
                           <operand localId="811" locator="383:44-383:47" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="M" xsi:type="Property"/>
                           </operand>
                           <operand localId="817" locator="383:51-383:101" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <operand localId="816" locator="383:51-383:93" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="815" locator="383:51-383:83" resultTypeName="fhir:Reference" strict="false" xsi:type="As">
                                       <operand localId="813" locator="383:52-383:69" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                                             <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                                             <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="medication" xsi:type="Property">
                                             <source localId="812" locator="383:52-383:58" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                                          </operand>
                                       </operand>
                                       <asTypeSpecifier localId="814" locator="383:74-383:82" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                    </source>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </source>
               </operand>
            </else>
         </expression>
         <operand name="request">
            <operandTypeSpecifier localId="799" locator="379:50-379:66" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
   </statements>
</library>