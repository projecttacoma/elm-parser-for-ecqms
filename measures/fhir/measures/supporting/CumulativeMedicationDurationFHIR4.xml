<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,EnableResultTypes,DisableListDemotion,DisableListPromotion" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="653">
         <a:s>library CumulativeMedicationDurationFHIR4 version '1.0.000'</a:s>
      </a:s>
   </annotation>
   <identifier id="CumulativeMedicationDurationFHIR4" version="1.0.000"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="3:1-3:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="5:1-5:56" localIdentifier="FHIRHelpers" path="FHIRHelpers" version="4.0.001">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.001' called FHIRHelpers</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="59" locator="37:1-37:47" resultTypeName="t:String" name="ErrorLevel" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="59">
               <a:s>parameter &quot;ErrorLevel&quot; </a:s>
               <a:s r="58">
                  <a:s>String</a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="57">
                  <a:s>'Warning'</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="57" locator="37:39-37:47" resultTypeName="t:String" valueType="t:String" value="Warning" xsi:type="Literal"/>
         <parameterTypeSpecifier localId="58" locator="37:24-37:29" resultTypeName="t:String" name="t:String" xsi:type="NamedTypeSpecifier"/>
      </def>
   </parameters>
   <codeSystems>
      <def localId="3" locator="7:1-7:82" resultTypeName="t:CodeSystem" name="V3TimingEvent" id="http://terminology.hl7.org/CodeSystem/v3-TimingEvent" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>codesystem &quot;V3TimingEvent&quot;: 'http://terminology.hl7.org/CodeSystem/v3-TimingEvent'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="4" locator="8:1-8:60" resultTypeName="t:CodeSystem" name="EventTiming" id="http://hl7.org/fhir/event-timing" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>codesystem &quot;EventTiming&quot;: 'http://hl7.org/fhir/event-timing'</a:s>
            </a:s>
         </annotation>
      </def>
   </codeSystems>
   <codes>
      <def localId="6" locator="10:1-10:49" resultTypeName="t:Code" name="AC" id="AC" display="AC" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="6">
               <a:s>code &quot;AC&quot;: 'AC' from </a:s>
               <a:s r="5">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'AC'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="5" locator="10:22-10:36" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="8" locator="11:1-11:52" resultTypeName="t:Code" name="ACD" id="ACD" display="ACD" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="8">
               <a:s>code &quot;ACD&quot;: 'ACD' from </a:s>
               <a:s r="7">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'ACD'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="7" locator="11:24-11:38" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="10" locator="12:1-12:52" resultTypeName="t:Code" name="ACM" id="ACM" display="ACM" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="10">
               <a:s>code &quot;ACM&quot;: 'ACM' from </a:s>
               <a:s r="9">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'ACM'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="9" locator="12:24-12:38" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="12" locator="13:1-13:52" resultTypeName="t:Code" name="ACV" id="ACV" display="ACV" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="12">
               <a:s>code &quot;ACV&quot;: 'ACV' from </a:s>
               <a:s r="11">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'ACV'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="11" locator="13:24-13:38" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="14" locator="14:1-14:50" resultTypeName="t:Code" name="AFT" id="AFT" display="AFT" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="14">
               <a:s>code &quot;AFT&quot;: 'AFT' from </a:s>
               <a:s r="13">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'AFT'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="13" locator="14:24-14:36" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="16" locator="15:1-15:68" resultTypeName="t:Code" name="AFT.early" id="AFT.early" display="AFT.early" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="16">
               <a:s>code &quot;AFT.early&quot;: 'AFT.early' from </a:s>
               <a:s r="15">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'AFT.early'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="15" locator="15:36-15:48" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="18" locator="16:1-16:65" resultTypeName="t:Code" name="AFT.late" id="AFT.late" display="AFT.late" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="18">
               <a:s>code &quot;AFT.late&quot;: 'AFT.late' from </a:s>
               <a:s r="17">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'AFT.late'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="17" locator="16:34-16:46" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="20" locator="17:1-17:46" resultTypeName="t:Code" name="C" id="C" display="C" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="20">
               <a:s>code &quot;C&quot;: 'C' from </a:s>
               <a:s r="19">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'C'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="19" locator="17:20-17:34" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="22" locator="18:1-18:49" resultTypeName="t:Code" name="CD" id="CD" display="CD" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="22">
               <a:s>code &quot;CD&quot;: 'CD' from </a:s>
               <a:s r="21">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'CD'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="21" locator="18:22-18:36" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="24" locator="19:1-19:49" resultTypeName="t:Code" name="CM" id="CM" display="CM" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="24">
               <a:s>code &quot;CM&quot;: 'CM' from </a:s>
               <a:s r="23">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'CM'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="23" locator="19:22-19:36" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="26" locator="20:1-20:49" resultTypeName="t:Code" name="CV" id="CV" display="CV" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="26">
               <a:s>code &quot;CV&quot;: 'CV' from </a:s>
               <a:s r="25">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'CV'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="25" locator="20:22-20:36" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="28" locator="21:1-21:50" resultTypeName="t:Code" name="EVE" id="EVE" display="EVE" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="28">
               <a:s>code &quot;EVE&quot;: 'EVE' from </a:s>
               <a:s r="27">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'EVE'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="27" locator="21:24-21:36" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="30" locator="22:1-22:68" resultTypeName="t:Code" name="EVE.early" id="EVE.early" display="EVE.early" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="30">
               <a:s>code &quot;EVE.early&quot;: 'EVE.early' from </a:s>
               <a:s r="29">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'EVE.early'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="29" locator="22:36-22:48" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="32" locator="23:1-23:65" resultTypeName="t:Code" name="EVE.late" id="EVE.late" display="EVE.late" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="32">
               <a:s>code &quot;EVE.late&quot;: 'EVE.late' from </a:s>
               <a:s r="31">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'EVE.late'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="31" locator="23:34-23:46" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="34" locator="24:1-24:49" resultTypeName="t:Code" name="HS" id="HS" display="HS" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="34">
               <a:s>code &quot;HS&quot;: 'HS' from </a:s>
               <a:s r="33">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'HS'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="33" locator="24:22-24:36" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="36" locator="25:1-25:53" resultTypeName="t:Code" name="MORN" id="MORN" display="MORN" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="36">
               <a:s>code &quot;MORN&quot;: 'MORN' from </a:s>
               <a:s r="35">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'MORN'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="35" locator="25:26-25:38" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="38" locator="26:1-26:71" resultTypeName="t:Code" name="MORN.early" id="MORN.early" display="MORN.early" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="38">
               <a:s>code &quot;MORN.early&quot;: 'MORN.early' from </a:s>
               <a:s r="37">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'MORN.early'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="37" locator="26:38-26:50" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="40" locator="27:1-27:68" resultTypeName="t:Code" name="MORN.late" id="MORN.late" display="MORN.late" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="40">
               <a:s>code &quot;MORN.late&quot;: 'MORN.late' from </a:s>
               <a:s r="39">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'MORN.late'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="39" locator="27:36-27:48" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="42" locator="28:1-28:56" resultTypeName="t:Code" name="NIGHT" id="NIGHT" display="NIGHT" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="42">
               <a:s>code &quot;NIGHT&quot;: 'NIGHT' from </a:s>
               <a:s r="41">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'NIGHT'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="41" locator="28:28-28:40" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="44" locator="29:1-29:53" resultTypeName="t:Code" name="NOON" id="NOON" display="NOON" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="44">
               <a:s>code &quot;NOON&quot;: 'NOON' from </a:s>
               <a:s r="43">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'NOON'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="43" locator="29:26-29:38" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="46" locator="30:1-30:49" resultTypeName="t:Code" name="PC" id="PC" display="PC" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="46">
               <a:s>code &quot;PC&quot;: 'PC' from </a:s>
               <a:s r="45">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'PC'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="45" locator="30:22-30:36" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="48" locator="31:1-31:52" resultTypeName="t:Code" name="PCD" id="PCD" display="PCD" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="48">
               <a:s>code &quot;PCD&quot;: 'PCD' from </a:s>
               <a:s r="47">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'PCD'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="47" locator="31:24-31:38" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="50" locator="32:1-32:52" resultTypeName="t:Code" name="PCM" id="PCM" display="PCM" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="50">
               <a:s>code &quot;PCM&quot;: 'PCM' from </a:s>
               <a:s r="49">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'PCM'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="49" locator="32:24-32:38" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="52" locator="33:1-33:52" resultTypeName="t:Code" name="PCV" id="PCV" display="PCV" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="52">
               <a:s>code &quot;PCV&quot;: 'PCV' from </a:s>
               <a:s r="51">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'PCV'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="51" locator="33:24-33:38" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
      <def localId="54" locator="34:1-34:50" resultTypeName="t:Code" name="PHS" id="PHS" display="PHS" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="54">
               <a:s>code &quot;PHS&quot;: 'PHS' from </a:s>
               <a:s r="53">
                  <a:s>&quot;EventTiming&quot;</a:s>
               </a:s>
               <a:s> display 'PHS'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="53" locator="34:24-34:36" resultTypeName="t:CodeSystem" name="EventTiming"/>
      </def>
      <def localId="56" locator="35:1-35:55" resultTypeName="t:Code" name="WAKE" id="WAKE" display="WAKE" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="56">
               <a:s>code &quot;WAKE&quot;: 'WAKE' from </a:s>
               <a:s r="55">
                  <a:s>&quot;V3TimingEvent&quot;</a:s>
               </a:s>
               <a:s> display 'WAKE'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="55" locator="35:26-35:40" resultTypeName="t:CodeSystem" name="V3TimingEvent"/>
      </def>
   </codes>
   <contexts>
      <def locator="39:1-39:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="39:1-39:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="39:1-39:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="302" locator="42:1-66:5" resultTypeName="t:Decimal" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="302">
               <a:s>/*Calculates daily frequency given frequency within a period*/
define function &quot;ToDaily&quot;(frequency </a:s>
               <a:s r="60">
                  <a:s>System.Integer</a:s>
               </a:s>
               <a:s>, period </a:s>
               <a:s r="61">
                  <a:s>System.Quantity</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="301">
                  <a:s r="301">
                     <a:s>case </a:s>
                     <a:s r="63">
                        <a:s r="62">
                           <a:s>period</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="63">
                           <a:s>unit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="71">
                        <a:s>when </a:s>
                        <a:s r="64">
                           <a:s>'h'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="70">
                           <a:s r="65">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="69">
                              <a:s>(</a:s>
                              <a:s r="69">
                                 <a:s r="66">24.0 / </a:s>
                                 <a:s r="68">
                                    <a:s r="67">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="68">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="81">
                        <a:s>when </a:s>
                        <a:s r="72">
                           <a:s>'min'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="80">
                           <a:s r="78">
                              <a:s r="73">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="77">
                                 <a:s>(</a:s>
                                 <a:s r="77">
                                    <a:s r="74">24.0 / </a:s>
                                    <a:s r="76">
                                       <a:s r="75">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="76">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="79"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="93">
                        <a:s>when </a:s>
                        <a:s r="82">
                           <a:s>'s'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="92">
                           <a:s r="90">
                              <a:s r="88">
                                 <a:s r="83">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="87">
                                    <a:s>(</a:s>
                                    <a:s r="87">
                                       <a:s r="84">24.0 / </a:s>
                                       <a:s r="86">
                                          <a:s r="85">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="86">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="89"> * 60</a:s>
                           </a:s>
                           <a:s r="91"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="103">
                        <a:s>when </a:s>
                        <a:s r="94">
                           <a:s>'d'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="102">
                           <a:s r="100">
                              <a:s r="95">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="99">
                                 <a:s>(</a:s>
                                 <a:s r="99">
                                    <a:s r="96">24.0 / </a:s>
                                    <a:s r="98">
                                       <a:s r="97">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="98">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="101"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="115">
                        <a:s>when </a:s>
                        <a:s r="104">
                           <a:s>'wk'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="114">
                           <a:s r="110">
                              <a:s r="105">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="109">
                                 <a:s>(</a:s>
                                 <a:s r="109">
                                    <a:s r="106">24.0 / </a:s>
                                    <a:s r="108">
                                       <a:s r="107">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="108">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="113">
                              <a:s>(</a:s>
                              <a:s r="113">
                                 <a:s r="111">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="127">
                        <a:s>when </a:s>
                        <a:s r="116">
                           <a:s>'mo'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="126">
                           <a:s r="122">
                              <a:s r="117">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="121">
                                 <a:s>(</a:s>
                                 <a:s r="121">
                                    <a:s r="118">24.0 / </a:s>
                                    <a:s r="120">
                                       <a:s r="119">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="120">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="125">
                              <a:s>(</a:s>
                              <a:s r="125">
                                 <a:s r="123">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="139">
                        <a:s>when </a:s>
                        <a:s r="128">
                           <a:s>'a'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="138">
                           <a:s r="134">
                              <a:s r="129">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="133">
                                 <a:s>(</a:s>
                                 <a:s r="133">
                                    <a:s r="130">24.0 / </a:s>
                                    <a:s r="132">
                                       <a:s r="131">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="132">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="137">
                              <a:s>(</a:s>
                              <a:s r="137">
                                 <a:s r="135">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    </a:s>
                     <a:s r="147">
                        <a:s>when </a:s>
                        <a:s r="140">
                           <a:s>'hour'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="146">
                           <a:s r="141">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="145">
                              <a:s>(</a:s>
                              <a:s r="145">
                                 <a:s r="142">24.0 / </a:s>
                                 <a:s r="144">
                                    <a:s r="143">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="144">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="157">
                        <a:s>when </a:s>
                        <a:s r="148">
                           <a:s>'minute'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="156">
                           <a:s r="154">
                              <a:s r="149">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="153">
                                 <a:s>(</a:s>
                                 <a:s r="153">
                                    <a:s r="150">24.0 / </a:s>
                                    <a:s r="152">
                                       <a:s r="151">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="152">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="155"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="169">
                        <a:s>when </a:s>
                        <a:s r="158">
                           <a:s>'second'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="168">
                           <a:s r="166">
                              <a:s r="164">
                                 <a:s r="159">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="163">
                                    <a:s>(</a:s>
                                    <a:s r="163">
                                       <a:s r="160">24.0 / </a:s>
                                       <a:s r="162">
                                          <a:s r="161">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="162">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="165"> * 60</a:s>
                           </a:s>
                           <a:s r="167"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="179">
                        <a:s>when </a:s>
                        <a:s r="170">
                           <a:s>'day'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="178">
                           <a:s r="176">
                              <a:s r="171">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="175">
                                 <a:s>(</a:s>
                                 <a:s r="175">
                                    <a:s r="172">24.0 / </a:s>
                                    <a:s r="174">
                                       <a:s r="173">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="174">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="177"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="191">
                        <a:s>when </a:s>
                        <a:s r="180">
                           <a:s>'week'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="190">
                           <a:s r="186">
                              <a:s r="181">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="185">
                                 <a:s>(</a:s>
                                 <a:s r="185">
                                    <a:s r="182">24.0 / </a:s>
                                    <a:s r="184">
                                       <a:s r="183">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="184">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="189">
                              <a:s>(</a:s>
                              <a:s r="189">
                                 <a:s r="187">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="203">
                        <a:s>when </a:s>
                        <a:s r="192">
                           <a:s>'month'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="202">
                           <a:s r="198">
                              <a:s r="193">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="197">
                                 <a:s>(</a:s>
                                 <a:s r="197">
                                    <a:s r="194">24.0 / </a:s>
                                    <a:s r="196">
                                       <a:s r="195">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="196">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="201">
                              <a:s>(</a:s>
                              <a:s r="201">
                                 <a:s r="199">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="215">
                        <a:s>when </a:s>
                        <a:s r="204">
                           <a:s>'year'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="214">
                           <a:s r="210">
                              <a:s r="205">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="209">
                                 <a:s>(</a:s>
                                 <a:s r="209">
                                    <a:s r="206">24.0 / </a:s>
                                    <a:s r="208">
                                       <a:s r="207">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="208">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="213">
                              <a:s>(</a:s>
                              <a:s r="213">
                                 <a:s r="211">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    </a:s>
                     <a:s r="223">
                        <a:s>when </a:s>
                        <a:s r="216">
                           <a:s>'hours'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="222">
                           <a:s r="217">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="221">
                              <a:s>(</a:s>
                              <a:s r="221">
                                 <a:s r="218">24.0 / </a:s>
                                 <a:s r="220">
                                    <a:s r="219">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="220">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="233">
                        <a:s>when </a:s>
                        <a:s r="224">
                           <a:s>'minutes'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="232">
                           <a:s r="230">
                              <a:s r="225">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="229">
                                 <a:s>(</a:s>
                                 <a:s r="229">
                                    <a:s r="226">24.0 / </a:s>
                                    <a:s r="228">
                                       <a:s r="227">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="228">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="231"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="245">
                        <a:s>when </a:s>
                        <a:s r="234">
                           <a:s>'seconds'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="244">
                           <a:s r="242">
                              <a:s r="240">
                                 <a:s r="235">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="239">
                                    <a:s>(</a:s>
                                    <a:s r="239">
                                       <a:s r="236">24.0 / </a:s>
                                       <a:s r="238">
                                          <a:s r="237">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="238">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="241"> * 60</a:s>
                           </a:s>
                           <a:s r="243"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="255">
                        <a:s>when </a:s>
                        <a:s r="246">
                           <a:s>'days'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="254">
                           <a:s r="252">
                              <a:s r="247">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="251">
                                 <a:s>(</a:s>
                                 <a:s r="251">
                                    <a:s r="248">24.0 / </a:s>
                                    <a:s r="250">
                                       <a:s r="249">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="250">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="253"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="267">
                        <a:s>when </a:s>
                        <a:s r="256">
                           <a:s>'weeks'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="266">
                           <a:s r="262">
                              <a:s r="257">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="261">
                                 <a:s>(</a:s>
                                 <a:s r="261">
                                    <a:s r="258">24.0 / </a:s>
                                    <a:s r="260">
                                       <a:s r="259">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="260">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="265">
                              <a:s>(</a:s>
                              <a:s r="265">
                                 <a:s r="263">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="279">
                        <a:s>when </a:s>
                        <a:s r="268">
                           <a:s>'months'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="278">
                           <a:s r="274">
                              <a:s r="269">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="273">
                                 <a:s>(</a:s>
                                 <a:s r="273">
                                    <a:s r="270">24.0 / </a:s>
                                    <a:s r="272">
                                       <a:s r="271">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="272">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="277">
                              <a:s>(</a:s>
                              <a:s r="277">
                                 <a:s r="275">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="291">
                        <a:s>when </a:s>
                        <a:s r="280">
                           <a:s>'years'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="290">
                           <a:s r="286">
                              <a:s r="281">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="285">
                                 <a:s>(</a:s>
                                 <a:s r="285">
                                    <a:s r="282">24.0 / </a:s>
                                    <a:s r="284">
                                       <a:s r="283">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="284">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="289">
                              <a:s>(</a:s>
                              <a:s r="289">
                                 <a:s r="287">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    else </a:s>
                     <a:s r="300">
                        <a:s r="292">Message(null, true, </a:s>
                        <a:s r="294">
                           <a:s>'CMDLogic.ToDaily.UnknownUnit'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="295">
                           <a:s>ErrorLevel</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="299">
                           <a:s r="296">
                              <a:s>'Unknown unit '</a:s>
                           </a:s>
                           <a:s> &amp; </a:s>
                           <a:s r="298">
                              <a:s r="297">
                                 <a:s>period</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="298">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="301" locator="43:3-66:5" resultTypeName="t:Decimal" xsi:type="Case">
            <comparand localId="63" locator="43:8-43:18" resultTypeName="t:String" path="unit" xsi:type="Property">
               <source localId="62" locator="43:8-43:13" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
            </comparand>
            <caseItem localId="71" locator="44:5-44:51">
               <when localId="64" locator="44:10-44:12" resultTypeName="t:String" valueType="t:String" value="h" xsi:type="Literal"/>
               <then localId="70" locator="44:19-44:51" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="65" locator="44:19-44:27" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="69" locator="44:31-44:51" resultTypeName="t:Decimal" xsi:type="Divide">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="66" locator="44:32-44:35" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="68" locator="44:39-44:50" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                        <source localId="67" locator="44:39-44:44" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="81" locator="45:5-45:58">
               <when localId="72" locator="45:10-45:14" resultTypeName="t:String" valueType="t:String" value="min" xsi:type="Literal"/>
               <then localId="80" locator="45:21-45:58" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="78" locator="45:21-45:53" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="73" locator="45:21-45:29" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="77" locator="45:33-45:53" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="74" locator="45:34-45:37" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="76" locator="45:41-45:52" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="75" locator="45:41-45:46" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="79" locator="45:57-45:58" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="93" locator="46:5-46:61">
               <when localId="82" locator="46:10-46:12" resultTypeName="t:String" valueType="t:String" value="s" xsi:type="Literal"/>
               <then localId="92" locator="46:19-46:61" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="90" locator="46:19-46:56" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="88" locator="46:19-46:51" resultTypeName="t:Decimal" xsi:type="Multiply">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand xsi:type="ToDecimal">
                           <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="83" locator="46:19-46:27" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="87" locator="46:31-46:51" resultTypeName="t:Decimal" xsi:type="Divide">
                           <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="84" locator="46:32-46:35" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="86" locator="46:39-46:50" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                              <source localId="85" locator="46:39-46:44" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="89" locator="46:55-46:56" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="91" locator="46:60-46:61" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="103" locator="47:5-47:56">
               <when localId="94" locator="47:10-47:12" resultTypeName="t:String" valueType="t:String" value="d" xsi:type="Literal"/>
               <then localId="102" locator="47:19-47:56" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="100" locator="47:19-47:51" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="95" locator="47:19-47:27" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="99" locator="47:31-47:51" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="96" locator="47:32-47:35" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="98" locator="47:39-47:50" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="97" locator="47:39-47:44" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="101" locator="47:55-47:56" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="115" locator="48:5-48:63">
               <when localId="104" locator="48:10-48:13" resultTypeName="t:String" valueType="t:String" value="wk" xsi:type="Literal"/>
               <then localId="114" locator="48:20-48:63" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="110" locator="48:20-48:52" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="105" locator="48:20-48:28" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="109" locator="48:32-48:52" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="106" locator="48:33-48:36" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="108" locator="48:40-48:51" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="107" locator="48:40-48:45" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="113" locator="48:56-48:63" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="111" locator="48:57-48:58" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="112" locator="48:62" resultTypeName="t:Integer" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="127" locator="49:5-49:64">
               <when localId="116" locator="49:10-49:13" resultTypeName="t:String" valueType="t:String" value="mo" xsi:type="Literal"/>
               <then localId="126" locator="49:20-49:64" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="122" locator="49:20-49:52" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="117" locator="49:20-49:28" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="121" locator="49:32-49:52" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="118" locator="49:33-49:36" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="120" locator="49:40-49:51" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="119" locator="49:40-49:45" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="125" locator="49:56-49:64" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="123" locator="49:57-49:58" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="124" locator="49:62-49:63" resultTypeName="t:Integer" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="139" locator="50:5-50:64">
               <when localId="128" locator="50:10-50:12" resultTypeName="t:String" valueType="t:String" value="a" xsi:type="Literal"/>
               <then localId="138" locator="50:19-50:64" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="134" locator="50:19-50:51" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="129" locator="50:19-50:27" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="133" locator="50:31-50:51" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="130" locator="50:32-50:35" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="132" locator="50:39-50:50" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="131" locator="50:39-50:44" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="137" locator="50:55-50:64" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="135" locator="50:56-50:57" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="136" locator="50:61-50:63" resultTypeName="t:Integer" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="147" locator="51:5-51:54">
               <when localId="140" locator="51:10-51:15" resultTypeName="t:String" valueType="t:String" value="hour" xsi:type="Literal"/>
               <then localId="146" locator="51:22-51:54" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="141" locator="51:22-51:30" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="145" locator="51:34-51:54" resultTypeName="t:Decimal" xsi:type="Divide">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="142" locator="51:35-51:38" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="144" locator="51:42-51:53" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                        <source localId="143" locator="51:42-51:47" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="157" locator="52:5-52:61">
               <when localId="148" locator="52:10-52:17" resultTypeName="t:String" valueType="t:String" value="minute" xsi:type="Literal"/>
               <then localId="156" locator="52:24-52:61" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="154" locator="52:24-52:56" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="149" locator="52:24-52:32" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="153" locator="52:36-52:56" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="150" locator="52:37-52:40" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="152" locator="52:44-52:55" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="151" locator="52:44-52:49" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="155" locator="52:60-52:61" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="169" locator="53:5-53:66">
               <when localId="158" locator="53:10-53:17" resultTypeName="t:String" valueType="t:String" value="second" xsi:type="Literal"/>
               <then localId="168" locator="53:24-53:66" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="166" locator="53:24-53:61" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="164" locator="53:24-53:56" resultTypeName="t:Decimal" xsi:type="Multiply">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand xsi:type="ToDecimal">
                           <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="159" locator="53:24-53:32" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="163" locator="53:36-53:56" resultTypeName="t:Decimal" xsi:type="Divide">
                           <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="160" locator="53:37-53:40" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="162" locator="53:44-53:55" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                              <source localId="161" locator="53:44-53:49" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="165" locator="53:60-53:61" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="167" locator="53:65-53:66" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="179" locator="54:5-54:58">
               <when localId="170" locator="54:10-54:14" resultTypeName="t:String" valueType="t:String" value="day" xsi:type="Literal"/>
               <then localId="178" locator="54:21-54:58" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="176" locator="54:21-54:53" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="171" locator="54:21-54:29" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="175" locator="54:33-54:53" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="172" locator="54:34-54:37" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="174" locator="54:41-54:52" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="173" locator="54:41-54:46" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="177" locator="54:57-54:58" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="191" locator="55:5-55:65">
               <when localId="180" locator="55:10-55:15" resultTypeName="t:String" valueType="t:String" value="week" xsi:type="Literal"/>
               <then localId="190" locator="55:22-55:65" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="186" locator="55:22-55:54" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="181" locator="55:22-55:30" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="185" locator="55:34-55:54" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="182" locator="55:35-55:38" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="184" locator="55:42-55:53" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="183" locator="55:42-55:47" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="189" locator="55:58-55:65" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="187" locator="55:59-55:60" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="188" locator="55:64" resultTypeName="t:Integer" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="203" locator="56:5-56:67">
               <when localId="192" locator="56:10-56:16" resultTypeName="t:String" valueType="t:String" value="month" xsi:type="Literal"/>
               <then localId="202" locator="56:23-56:67" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="198" locator="56:23-56:55" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="193" locator="56:23-56:31" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="197" locator="56:35-56:55" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="194" locator="56:36-56:39" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="196" locator="56:43-56:54" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="195" locator="56:43-56:48" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="201" locator="56:59-56:67" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="199" locator="56:60-56:61" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="200" locator="56:65-56:66" resultTypeName="t:Integer" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="215" locator="57:5-57:67">
               <when localId="204" locator="57:10-57:15" resultTypeName="t:String" valueType="t:String" value="year" xsi:type="Literal"/>
               <then localId="214" locator="57:22-57:67" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="210" locator="57:22-57:54" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="205" locator="57:22-57:30" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="209" locator="57:34-57:54" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="206" locator="57:35-57:38" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="208" locator="57:42-57:53" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="207" locator="57:42-57:47" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="213" locator="57:58-57:67" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="211" locator="57:59-57:60" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="212" locator="57:64-57:66" resultTypeName="t:Integer" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="223" locator="58:5-58:55">
               <when localId="216" locator="58:10-58:16" resultTypeName="t:String" valueType="t:String" value="hours" xsi:type="Literal"/>
               <then localId="222" locator="58:23-58:55" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="217" locator="58:23-58:31" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="221" locator="58:35-58:55" resultTypeName="t:Decimal" xsi:type="Divide">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="218" locator="58:36-58:39" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="220" locator="58:43-58:54" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                        <source localId="219" locator="58:43-58:48" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="233" locator="59:5-59:62">
               <when localId="224" locator="59:10-59:18" resultTypeName="t:String" valueType="t:String" value="minutes" xsi:type="Literal"/>
               <then localId="232" locator="59:25-59:62" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="230" locator="59:25-59:57" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="225" locator="59:25-59:33" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="229" locator="59:37-59:57" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="226" locator="59:38-59:41" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="228" locator="59:45-59:56" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="227" locator="59:45-59:50" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="231" locator="59:61-59:62" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="245" locator="60:5-60:67">
               <when localId="234" locator="60:10-60:18" resultTypeName="t:String" valueType="t:String" value="seconds" xsi:type="Literal"/>
               <then localId="244" locator="60:25-60:67" resultTypeName="t:Decimal" xsi:type="Multiply">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="242" locator="60:25-60:62" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="240" locator="60:25-60:57" resultTypeName="t:Decimal" xsi:type="Multiply">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand xsi:type="ToDecimal">
                           <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="235" locator="60:25-60:33" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="239" locator="60:37-60:57" resultTypeName="t:Decimal" xsi:type="Divide">
                           <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="236" locator="60:38-60:41" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="238" locator="60:45-60:56" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                              <source localId="237" locator="60:45-60:50" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="241" locator="60:61-60:62" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="243" locator="60:66-60:67" resultTypeName="t:Integer" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="255" locator="61:5-61:59">
               <when localId="246" locator="61:10-61:15" resultTypeName="t:String" valueType="t:String" value="days" xsi:type="Literal"/>
               <then localId="254" locator="61:22-61:59" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="252" locator="61:22-61:54" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="247" locator="61:22-61:30" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="251" locator="61:34-61:54" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="248" locator="61:35-61:38" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="250" locator="61:42-61:53" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="249" locator="61:42-61:47" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="253" locator="61:58-61:59" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="267" locator="62:5-62:66">
               <when localId="256" locator="62:10-62:16" resultTypeName="t:String" valueType="t:String" value="weeks" xsi:type="Literal"/>
               <then localId="266" locator="62:23-62:66" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="262" locator="62:23-62:55" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="257" locator="62:23-62:31" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="261" locator="62:35-62:55" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="258" locator="62:36-62:39" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="260" locator="62:43-62:54" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="259" locator="62:43-62:48" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="265" locator="62:59-62:66" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="263" locator="62:60-62:61" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="264" locator="62:65" resultTypeName="t:Integer" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="279" locator="63:5-63:68">
               <when localId="268" locator="63:10-63:17" resultTypeName="t:String" valueType="t:String" value="months" xsi:type="Literal"/>
               <then localId="278" locator="63:24-63:68" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="274" locator="63:24-63:56" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="269" locator="63:24-63:32" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="273" locator="63:36-63:56" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="270" locator="63:37-63:40" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="272" locator="63:44-63:55" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="271" locator="63:44-63:49" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="277" locator="63:60-63:68" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="275" locator="63:61-63:62" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="276" locator="63:66-63:67" resultTypeName="t:Integer" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="291" locator="64:5-64:68">
               <when localId="280" locator="64:10-64:16" resultTypeName="t:String" valueType="t:String" value="years" xsi:type="Literal"/>
               <then localId="290" locator="64:23-64:68" resultTypeName="t:Decimal" xsi:type="Divide">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="286" locator="64:23-64:55" resultTypeName="t:Decimal" xsi:type="Multiply">
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="ToDecimal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="281" locator="64:23-64:31" resultTypeName="t:Integer" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="285" locator="64:35-64:55" resultTypeName="t:Decimal" xsi:type="Divide">
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="282" locator="64:36-64:39" resultTypeName="t:Decimal" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="284" locator="64:43-64:54" resultTypeName="t:Decimal" path="value" xsi:type="Property">
                           <source localId="283" locator="64:43-64:48" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="289" locator="64:59-64:68" resultTypeName="t:Integer" xsi:type="Multiply">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="287" locator="64:60-64:61" resultTypeName="t:Integer" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="288" locator="64:65-64:67" resultTypeName="t:Integer" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <else asType="t:Decimal" xsi:type="As">
               <operand localId="300" locator="65:10-65:103" resultTypeName="t:Any" xsi:type="Message">
                  <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <source localId="292" locator="65:18-65:21" resultTypeName="t:Any" xsi:type="Null"/>
                  <condition localId="293" locator="65:24-65:27" resultTypeName="t:Boolean" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                  <code localId="294" locator="65:30-65:59" resultTypeName="t:String" valueType="t:String" value="CMDLogic.ToDaily.UnknownUnit" xsi:type="Literal"/>
                  <severity localId="295" locator="65:62-65:71" resultTypeName="t:String" name="ErrorLevel" xsi:type="ParameterRef"/>
                  <message localId="299" locator="65:74-65:102" resultTypeName="t:String" xsi:type="Concatenate">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="Coalesce">
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="296" locator="65:74-65:88" resultTypeName="t:String" valueType="t:String" value="Unknown unit " xsi:type="Literal"/>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                     <operand xsi:type="Coalesce">
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="298" locator="65:92-65:102" resultTypeName="t:String" path="unit" xsi:type="Property">
                           <source localId="297" locator="65:92-65:97" resultTypeName="t:Quantity" name="period" xsi:type="OperandRef"/>
                        </operand>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                  </message>
               </operand>
            </else>
         </expression>
         <operand name="frequency">
            <operandTypeSpecifier localId="60" locator="42:37-42:50" resultTypeName="t:Integer" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="period">
            <operandTypeSpecifier localId="61" locator="42:60-42:74" resultTypeName="t:Quantity" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="318" locator="72:1-77:5" resultTypeName="t:Decimal" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="318">
               <a:s>/*Returns a daily frequency for the given code representation of frequency.
  The function expects codes from the [EventTiming](http://hl7.org/fhir/codesystem-event-timing.html) or
  [V3TimingEvent](http://hl7.org/fhir/v3/TimingEvent/cs.html) code systems.
  // TODO: Determine whether or not we should use timing.code at all....*/
define function &quot;ToDaily&quot;(frequency </a:s>
               <a:s r="303">
                  <a:s>Code</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="317">
                  <a:s r="317">
                     <a:s>case </a:s>
                     <a:s r="304">
                        <a:s>frequency</a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="307">
                        <a:s>when </a:s>
                        <a:s r="305">
                           <a:s>&quot;C&quot;</a:s>
                        </a:s>
                        <a:s r="306"> then 3.0</a:s>
                     </a:s>
                     <a:s>
    // etc.
    else </a:s>
                     <a:s r="316">
                        <a:s r="308">Message(null, true, </a:s>
                        <a:s r="310">
                           <a:s>'CMDLogic.ToDaily.UnknownFrequencyCode'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="311">
                           <a:s>ErrorLevel</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="315">
                           <a:s r="312">
                              <a:s>'Unknown frequency code '</a:s>
                           </a:s>
                           <a:s> &amp; </a:s>
                           <a:s r="314">
                              <a:s r="313">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="314">
                                 <a:s>code</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="317" locator="73:3-77:5" resultTypeName="t:Decimal" xsi:type="Case">
            <comparand localId="304" locator="73:8-73:16" resultTypeName="t:Code" name="frequency" xsi:type="OperandRef"/>
            <caseItem localId="307" locator="74:5-74:21">
               <when localId="305" locator="74:10-74:12" resultTypeName="t:Code" name="C" xsi:type="CodeRef"/>
               <then localId="306" locator="74:19-74:21" resultTypeName="t:Decimal" valueType="t:Decimal" value="3.0" xsi:type="Literal"/>
            </caseItem>
            <else asType="t:Decimal" xsi:type="As">
               <operand localId="316" locator="76:10-76:125" resultTypeName="t:Any" xsi:type="Message">
                  <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <source localId="308" locator="76:18-76:21" resultTypeName="t:Any" xsi:type="Null"/>
                  <condition localId="309" locator="76:24-76:27" resultTypeName="t:Boolean" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                  <code localId="310" locator="76:30-76:68" resultTypeName="t:String" valueType="t:String" value="CMDLogic.ToDaily.UnknownFrequencyCode" xsi:type="Literal"/>
                  <severity localId="311" locator="76:71-76:80" resultTypeName="t:String" name="ErrorLevel" xsi:type="ParameterRef"/>
                  <message localId="315" locator="76:83-76:124" resultTypeName="t:String" xsi:type="Concatenate">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand xsi:type="Coalesce">
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="312" locator="76:83-76:107" resultTypeName="t:String" valueType="t:String" value="Unknown frequency code " xsi:type="Literal"/>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                     <operand xsi:type="Coalesce">
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="314" locator="76:111-76:124" resultTypeName="t:String" path="code" xsi:type="Property">
                           <source localId="313" locator="76:111-76:119" resultTypeName="t:Code" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                  </message>
               </operand>
            </else>
         </expression>
         <operand name="frequency">
            <operandTypeSpecifier localId="303" locator="72:37-72:40" resultTypeName="t:Code" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="437" locator="154:1-180:110" name="MedicationRequestPeriod" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="437">
               <a:s>/*
  Now that we have a ToDaily function, we can approach calculation of the
  duration of medication for an order. First, consider the definitions
  for each element:
  
  * 1 and only 1 dosageInstruction
  * 1 and only 1 doseAndRate
  * 1 timing with 1 repeat
  * frequency, frequencyMax, defaulting to 1
  * period, periodUnit, defaulting to 1 'd'
  * doseQuantity or doseRange
  * timeOfDay
  
  * authoredOn: The date the prescription was written
  * dispenseRequest.validityPeriod: Time period supply is authorized for
  * dispenseRequest.quantity: amount of medication supplied per dispense
  * dispenseRequest.numberOfRepeatsAllowed: number of refills authorized
  * dispenseRequest.expectedSupplyDuration: number of days supply per dispense
  * dosageInstruction.timing.repeat.boundsDuration: total duration of the repeat
  * dosageInstruction.timing.repeat.boundsRange: range of durations of the repeat
  * dosageInstruction.timing.repeat.boundsPeriod: period bounds of the repeat
  * dosageInstruction.timing.repeat.count: number of times to repeat
  * dosageInstruction.timing.repeat.countMax: maximum number of times to repeat
  * dosageInstruction.timing.repeat.frequency: event occurs frequency times per period
  * dosageInstruction.timing.repeat.frequencyMax: event occurs up to frequencyMax times per period
  * dosageInstruction.timing.repeat.period: event occurs frequency times per period
  * dosageInstruction.timing.repeat.periodMax: upper limit of period
  * dosageInstruction.timing.repeat.periodUnit: period duration (s | min | h | d | wk | mo | a)
  * dosageInstruction.timing.repeat.timeOfDay: time of day for the event (0..*)
  * dosageInstruction.timing.repeat.when: event timing (HS | WAKE | C | CM | CD | CV | AC | ACM...)
  * dosageInstruction.timing.code: BID | TID | QID | AM | PM | QD | QOD...
  * dosageInstruction.asNeeded
  * dosageInstruction.doseAndRate.doseQuantity
  * dosageInstruction.doseAndRate.doseRange
  
  If the boundsPeriod is present (and completely specified), we can use that directly
  
    dosage.timing.repeat.boundsPeriod
  
  If expectedSupplyDuration is present, then the duration is
  
    expectedSupplyDuration * (1 + numberOfRepeatsAllowed)
  
  If expectedSupplyDuration is not present, then it must be calculated based on the quantity, dosage, and frequency:
  
    (quantity / (dosage * frequency)) * (1 + numberOfRepeatsAllowed)
  
    dosage: Coalesce(end of doseAndRate.doseRange, doseAndRate.doseQuantity)
    frequency: Coalesce(frequencyMax, frequency)
    period: Quantity(period, periodUnit)
  
  This calculation results in a number of days, which can then be turned into a period by anchoring that to the
  start of the validityPeriod or the authoredOn:
  
    Interval[earliestDispensable, earliestDispensable + expectedSupplyDuration]
  
    earliestDispensable: Coalesce(start of validityPeriod, authoredOn)
  
  The following function illustrates this completely:
  */

/*Calculates the Medication Period for a single MedicationRequest.
MedicationRequest instances provided to this function are expected
to conform to the [MMEMedicationRequest](http://build.fhir.org/ig/cqframework/opioid-mme-r4/StructureDefinition-mmemedicationrequest.html)
profile, which expects:
* 1 and only 1 dosageInstruction, multiple dosageInstruction elements will result in an error
* 1 and only 1 doseAndRate, multiple doseAndRate elements will result in an error
* 1 timing with 1 repeat, missing timing or repeat elements will result in a null
* frequency, frequencyMax, defaulting to 1
* period, periodUnit, defaulting to 1 'd'
* timeOfDay
* doseQuantity or doseRange, missing doseQuantity and doseRange will result in a null
Note that MedicationRequest status is not considered by this calculation, as the
list of MedicationRequest instances provided to this function should already have
considered appropriate statuses, depending on the use case, typically `completed`.*/
define function &quot;MedicationRequestPeriod&quot;(Request </a:s>
               <a:s r="319">
                  <a:s>&quot;MedicationRequest&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="436">
                  <a:s r="436">
                     <a:s>
                        <a:s r="321">
                           <a:s r="320">
                              <a:s>
                                 <a:s>Request</a:s>
                              </a:s>
                           </a:s>
                           <a:s> R</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s>
                        <a:s>let
      </a:s>
                        <a:s r="325">
                           <a:s>dosage: </a:s>
                           <a:s r="324">
                              <a:s>singleton from </a:s>
                              <a:s r="323">
                                 <a:s r="322">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="323">
                                    <a:s>dosageInstruction</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="329">
                           <a:s>doseAndRate: </a:s>
                           <a:s r="328">
                              <a:s>singleton from </a:s>
                              <a:s r="327">
                                 <a:s r="326">
                                    <a:s>dosage</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="327">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="334">
                           <a:s>doseRange: </a:s>
                           <a:s r="333">
                              <a:s r="331">
                                 <a:s r="330">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="331">
                                    <a:s>dose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="332">
                                 <a:s>Range</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="339">
                           <a:s>doseQuantity: </a:s>
                           <a:s r="338">
                              <a:s r="336">
                                 <a:s r="335">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="336">
                                    <a:s>dose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="337">
                                 <a:s>SimpleQuantity</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="344">
                           <a:s>dose: </a:s>
                           <a:s r="343">
                              <a:s>Coalesce(</a:s>
                              <a:s r="341">
                                 <a:s>end of </a:s>
                                 <a:s r="340">
                                    <a:s>doseRange</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="342">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="347">
                           <a:s>timing: </a:s>
                           <a:s r="346">
                              <a:s r="345">
                                 <a:s>dosage</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="346">
                                 <a:s>timing</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="355">
                           <a:s>frequency: </a:s>
                           <a:s r="354">
                              <a:s>Coalesce(</a:s>
                              <a:s r="350">
                                 <a:s r="349">
                                    <a:s r="348">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="349">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="350">
                                    <a:s>frequencyMax</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="353">
                                 <a:s r="352">
                                    <a:s r="351">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="352">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="353">
                                    <a:s>frequency</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="364">
                           <a:s>period: </a:s>
                           <a:s r="363">
                              <a:s>System.Quantity { </a:s>
                              <a:s>
                                 <a:s>value: </a:s>
                                 <a:s r="358">
                                    <a:s r="357">
                                       <a:s r="356">
                                          <a:s>timing</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="357">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="358">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="362">
                                    <a:s r="361">
                                       <a:s r="360">
                                          <a:s r="359">
                                             <a:s>timing</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="360">
                                             <a:s>repeat</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="361">
                                          <a:s>periodUnit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="362">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="374">
                           <a:s>dosesPerDay: </a:s>
                           <a:s r="373">
                              <a:s>Coalesce(</a:s>
                              <a:s r="367">
                                 <a:s>ToDaily(</a:s>
                                 <a:s r="365">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="366">
                                    <a:s>period</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="371">
                                 <a:s>Count(</a:s>
                                 <a:s r="370">
                                    <a:s r="369">
                                       <a:s r="368">
                                          <a:s>timing</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="369">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="370">
                                       <a:s>timeOfDay</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s r="372">, 1.0)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="380">
                           <a:s>boundsPeriod: </a:s>
                           <a:s r="379">
                              <a:s r="377">
                                 <a:s r="376">
                                    <a:s r="375">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="376">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="377">
                                    <a:s>bounds</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="378">
                                 <a:s>Period</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="384">
                           <a:s>daysSupply: </a:s>
                           <a:s r="383">
                              <a:s r="382">
                                 <a:s r="381">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="382">
                                    <a:s>dispenseRequest</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="383">
                                 <a:s>expectedSupplyDuration</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="388">
                           <a:s>quantity: </a:s>
                           <a:s r="387">
                              <a:s r="386">
                                 <a:s r="385">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="386">
                                    <a:s>dispenseRequest</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="387">
                                 <a:s>quantity</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="394">
                           <a:s>refills: </a:s>
                           <a:s r="393">
                              <a:s>Coalesce(</a:s>
                              <a:s r="391">
                                 <a:s r="390">
                                    <a:s r="389">
                                       <a:s>R</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="390">
                                       <a:s>dispenseRequest</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="391">
                                    <a:s>numberOfRepeatsAllowed</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="392">, 0)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="404">
                           <a:s>startDate:
        </a:s>
                           <a:s r="403">
                              <a:s>Coalesce(
          </a:s>
                              <a:s r="396">
                                 <a:s>start of </a:s>
                                 <a:s r="395">
                                    <a:s>boundsPeriod</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
          </a:s>
                              <a:s r="400">
                                 <a:s>start of </a:s>
                                 <a:s r="399">
                                    <a:s r="398">
                                       <a:s r="397">
                                          <a:s>R</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="398">
                                          <a:s>dispenseRequest</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="399">
                                       <a:s>validityPeriod</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
          </a:s>
                              <a:s r="402">
                                 <a:s r="401">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="402">
                                    <a:s>authoredOn</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="435">
                        <a:s>return
      </a:s>
                        <a:s r="434">
                           <a:s>if </a:s>
                           <a:s r="414">
                              <a:s>not </a:s>
                              <a:s r="413">
                                 <a:s>(</a:s>
                                 <a:s r="413">
                                    <a:s r="407">
                                       <a:s r="406">
                                          <a:s>end of </a:s>
                                          <a:s r="405">
                                             <a:s>boundsPeriod</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> is null</a:s>
                                    </a:s>
                                    <a:s> or </a:s>
                                    <a:s r="412">
                                       <a:s r="409">
                                          <a:s>end of </a:s>
                                          <a:s r="408">
                                             <a:s>boundsPeriod</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="411">
                                          <a:s>maximum </a:s>
                                          <a:s r="410">
                                             <a:s>DateTime</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> then
        </a:s>
                           <a:s r="418">
                              <a:s>Interval[</a:s>
                              <a:s r="415">
                                 <a:s>startDate</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="417">
                                 <a:s>end of </a:s>
                                 <a:s r="416">
                                    <a:s>boundsPeriod</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                           <a:s>
      else
        </a:s>
                           <a:s r="433">
                              <a:s>Interval[</a:s>
                              <a:s r="419">
                                 <a:s>startDate</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="432">
                                 <a:s r="420">
                                    <a:s>startDate</a:s>
                                 </a:s>
                                 <a:s> + </a:s>
                                 <a:s r="431">
                                    <a:s r="427">
                                       <a:s>Coalesce(</a:s>
                                       <a:s r="421">
                                          <a:s>daysSupply</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="426">
                                          <a:s r="422">
                                             <a:s>quantity</a:s>
                                          </a:s>
                                          <a:s> / </a:s>
                                          <a:s r="425">
                                             <a:s>(</a:s>
                                             <a:s r="425">
                                                <a:s r="423">
                                                   <a:s>dose</a:s>
                                                </a:s>
                                                <a:s> * </a:s>
                                                <a:s r="424">
                                                   <a:s>dosesPerDay</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s> * </a:s>
                                    <a:s r="430">
                                       <a:s>(</a:s>
                                       <a:s r="430">
                                          <a:s r="428">1 + </a:s>
                                          <a:s r="429">
                                             <a:s>refills</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="436" locator="155:3-180:110" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="321" locator="155:3-155:11" resultTypeName="fhir:MedicationRequest" alias="R">
               <expression localId="320" locator="155:3-155:9" resultTypeName="fhir:MedicationRequest" name="Request" xsi:type="OperandRef"/>
            </source>
            <let localId="325" locator="157:7-157:48" resultTypeName="fhir:Dosage" identifier="dosage">
               <expression localId="324" locator="157:15-157:48" resultTypeName="fhir:Dosage" xsi:type="SingletonFrom">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Dosage" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="323" locator="157:30-157:48" path="dosageInstruction" scope="R" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Dosage" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </expression>
            </let>
            <let localId="329" locator="158:7-158:52" resultTypeName="fhir:Dosage.DoseAndRate" identifier="doseAndRate">
               <expression localId="328" locator="158:20-158:52" resultTypeName="fhir:Dosage.DoseAndRate" xsi:type="SingletonFrom">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Dosage.DoseAndRate" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="327" locator="158:35-158:52" path="doseAndRate" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Dosage.DoseAndRate" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="326" locator="158:35-158:40" resultTypeName="fhir:Dosage" name="dosage" xsi:type="QueryLetRef"/>
                  </operand>
               </expression>
            </let>
            <let localId="334" locator="159:7-159:42" resultTypeName="fhir:Range" identifier="doseRange">
               <expression localId="333" locator="159:18-159:42" resultTypeName="fhir:Range" strict="false" xsi:type="As">
                  <operand localId="331" locator="159:18-159:33" path="dose" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:SimpleQuantity" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="330" locator="159:18-159:28" resultTypeName="fhir:Dosage.DoseAndRate" name="doseAndRate" xsi:type="QueryLetRef"/>
                  </operand>
                  <asTypeSpecifier localId="332" locator="159:38-159:42" resultTypeName="fhir:Range" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="339" locator="160:7-160:54" resultTypeName="fhir:SimpleQuantity" identifier="doseQuantity">
               <expression localId="338" locator="160:21-160:54" resultTypeName="fhir:SimpleQuantity" strict="false" xsi:type="As">
                  <operand localId="336" locator="160:21-160:36" path="dose" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:SimpleQuantity" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="335" locator="160:21-160:31" resultTypeName="fhir:Dosage.DoseAndRate" name="doseAndRate" xsi:type="QueryLetRef"/>
                  </operand>
                  <asTypeSpecifier localId="337" locator="160:41-160:54" resultTypeName="fhir:SimpleQuantity" name="fhir:SimpleQuantity" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="344" locator="161:7-161:52" resultTypeName="t:Quantity" identifier="dose">
               <expression localId="343" locator="161:13-161:52" resultTypeName="t:Quantity" xsi:type="Coalesce">
                  <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="341" locator="161:22-161:37" resultTypeName="t:Quantity" xsi:type="End">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="340" locator="161:29-161:37" resultTypeName="fhir:Range" name="doseRange" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="342" locator="161:40-161:51" resultTypeName="fhir:SimpleQuantity" name="doseQuantity" xsi:type="QueryLetRef"/>
                  </operand>
               </expression>
            </let>
            <let localId="347" locator="162:7-162:27" resultTypeName="fhir:Timing" identifier="timing">
               <expression localId="346" locator="162:15-162:27" resultTypeName="fhir:Timing" path="timing" xsi:type="Property">
                  <source localId="345" locator="162:15-162:20" resultTypeName="fhir:Dosage" name="dosage" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="355" locator="163:7-163:78" resultTypeName="fhir:positiveInt" identifier="frequency">
               <expression localId="354" locator="163:18-163:78" resultTypeName="fhir:positiveInt" xsi:type="Coalesce">
                  <signature name="fhir:positiveInt" xsi:type="NamedTypeSpecifier"/>
                  <signature name="fhir:positiveInt" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="350" locator="163:27-163:52" resultTypeName="fhir:positiveInt" path="frequencyMax" xsi:type="Property">
                     <source localId="349" locator="163:27-163:39" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                        <source localId="348" locator="163:27-163:32" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
                  <operand localId="353" locator="163:55-163:77" resultTypeName="fhir:positiveInt" path="frequency" xsi:type="Property">
                     <source localId="352" locator="163:55-163:67" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                        <source localId="351" locator="163:55-163:60" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
               </expression>
            </let>
            <let localId="364" locator="164:7-164:99" resultTypeName="t:Quantity" identifier="period">
               <expression localId="363" locator="164:15-164:99" resultTypeName="t:Quantity" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value name="ToDecimal" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="358" locator="164:40-164:59" resultTypeName="fhir:decimal" path="period" xsi:type="Property">
                           <source localId="357" locator="164:40-164:52" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                              <source localId="356" locator="164:40-164:45" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="362" locator="164:68-164:97" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source localId="361" locator="164:68-164:91" resultTypeName="fhir:UnitsOfTime" path="periodUnit" xsi:type="Property">
                           <source localId="360" locator="164:68-164:80" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                              <source localId="359" locator="164:68-164:73" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </source>
                     </value>
                  </element>
               </expression>
            </let>
            <let localId="374" locator="165:7-165:92" resultTypeName="t:Decimal" identifier="dosesPerDay">
               <expression localId="373" locator="165:20-165:92" resultTypeName="t:Decimal" xsi:type="Coalesce">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="367" locator="165:29-165:54" resultTypeName="t:Decimal" name="ToDaily" xsi:type="FunctionRef">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand name="ToInteger" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="365" locator="165:37-165:45" resultTypeName="fhir:positiveInt" name="frequency" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand localId="366" locator="165:48-165:53" resultTypeName="t:Quantity" name="period" xsi:type="QueryLetRef"/>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="371" locator="165:57-165:86" resultTypeName="t:Integer" xsi:type="Count">
                        <signature xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:time" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <source localId="370" locator="165:63-165:85" path="timeOfDay" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:time" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="369" locator="165:63-165:75" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                              <source localId="368" locator="165:63-165:68" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </source>
                     </operand>
                  </operand>
                  <operand localId="372" locator="165:89-165:91" resultTypeName="t:Decimal" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="380" locator="166:7-166:50" resultTypeName="fhir:Period" identifier="boundsPeriod">
               <expression localId="379" locator="166:21-166:50" resultTypeName="fhir:Period" strict="false" xsi:type="As">
                  <operand localId="377" locator="166:21-166:40" path="bounds" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:Duration" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="376" locator="166:21-166:33" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                        <source localId="375" locator="166:21-166:26" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
                  <asTypeSpecifier localId="378" locator="166:45-166:50" resultTypeName="fhir:Period" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="384" locator="167:7-167:58" resultTypeName="fhir:Duration" identifier="daysSupply">
               <expression localId="383" locator="167:19-167:58" resultTypeName="fhir:Duration" path="expectedSupplyDuration" xsi:type="Property">
                  <source localId="382" locator="167:19-167:35" resultTypeName="fhir:MedicationRequest.DispenseRequest" path="dispenseRequest" scope="R" xsi:type="Property"/>
               </expression>
            </let>
            <let localId="388" locator="168:7-168:42" resultTypeName="fhir:SimpleQuantity" identifier="quantity">
               <expression localId="387" locator="168:17-168:42" resultTypeName="fhir:SimpleQuantity" path="quantity" xsi:type="Property">
                  <source localId="386" locator="168:17-168:33" resultTypeName="fhir:MedicationRequest.DispenseRequest" path="dispenseRequest" scope="R" xsi:type="Property"/>
               </expression>
            </let>
            <let localId="394" locator="169:7-169:68" resultTypeName="t:Integer" identifier="refills">
               <expression localId="393" locator="169:16-169:68" resultTypeName="t:Integer" xsi:type="Coalesce">
                  <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand name="ToInteger" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature name="fhir:integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="391" locator="169:25-169:64" resultTypeName="fhir:unsignedInt" path="numberOfRepeatsAllowed" xsi:type="Property">
                        <source localId="390" locator="169:25-169:41" resultTypeName="fhir:MedicationRequest.DispenseRequest" path="dispenseRequest" scope="R" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="392" locator="169:67" resultTypeName="t:Integer" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="404" locator="170:7-175:9" resultTypeName="t:DateTime" identifier="startDate">
               <expression localId="403" locator="171:9-175:9" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="396" locator="172:11-172:31" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="395" locator="172:20-172:31" resultTypeName="fhir:Period" name="boundsPeriod" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand localId="400" locator="173:11-173:51" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="399" locator="173:20-173:51" resultTypeName="fhir:Period" path="validityPeriod" xsi:type="Property">
                           <source localId="398" locator="173:20-173:36" resultTypeName="fhir:MedicationRequest.DispenseRequest" path="dispenseRequest" scope="R" xsi:type="Property"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="402" locator="174:11-174:22" resultTypeName="fhir:dateTime" path="authoredOn" scope="R" xsi:type="Property"/>
                  </operand>
               </expression>
            </let>
            <return localId="435" locator="176:5-180:110">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="434" locator="177:7-180:110" xsi:type="If">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="414" locator="177:10-177:84" resultTypeName="t:Boolean" xsi:type="Not">
                     <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="413" locator="177:14-177:84" resultTypeName="t:Boolean" xsi:type="Or">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="407" locator="177:15-177:41" resultTypeName="t:Boolean" xsi:type="IsNull">
                           <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="406" locator="177:15-177:33" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <signature name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="405" locator="177:22-177:33" resultTypeName="fhir:Period" name="boundsPeriod" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                        <operand localId="412" locator="177:46-177:83" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="409" locator="177:46-177:64" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <signature name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="408" locator="177:53-177:64" resultTypeName="fhir:Period" name="boundsPeriod" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand localId="411" locator="177:68-177:83" resultTypeName="t:DateTime" valueType="t:DateTime" xsi:type="MaxValue"/>
                        </operand>
                     </operand>
                  </condition>
                  <then localId="418" locator="178:9-178:48" lowClosed="true" highClosed="true" xsi:type="Interval">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <low localId="415" locator="178:18-178:26" resultTypeName="t:DateTime" name="startDate" xsi:type="QueryLetRef"/>
                     <high localId="417" locator="178:29-178:47" resultTypeName="t:DateTime" xsi:type="End">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <signature name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="416" locator="178:36-178:47" resultTypeName="fhir:Period" name="boundsPeriod" xsi:type="QueryLetRef"/>
                        </operand>
                     </high>
                  </then>
                  <else localId="433" locator="180:9-180:110" lowClosed="true" highClosed="true" xsi:type="Interval">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <low localId="419" locator="180:18-180:26" resultTypeName="t:DateTime" name="startDate" xsi:type="QueryLetRef"/>
                     <high localId="432" locator="180:29-180:109" resultTypeName="t:DateTime" xsi:type="Add">
                        <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="420" locator="180:29-180:37" resultTypeName="t:DateTime" name="startDate" xsi:type="QueryLetRef"/>
                        <operand localId="431" locator="180:41-180:109" resultTypeName="t:Quantity" xsi:type="Multiply">
                           <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="427" locator="180:41-180:93" resultTypeName="t:Quantity" xsi:type="Coalesce">
                              <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <signature name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="421" locator="180:50-180:59" resultTypeName="fhir:Duration" name="daysSupply" xsi:type="QueryLetRef"/>
                              </operand>
                              <operand localId="426" locator="180:62-180:92" resultTypeName="t:Quantity" xsi:type="Divide">
                                 <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                 <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                 <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <signature name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="422" locator="180:62-180:69" resultTypeName="fhir:SimpleQuantity" name="quantity" xsi:type="QueryLetRef"/>
                                 </operand>
                                 <operand localId="425" locator="180:73-180:92" resultTypeName="t:Quantity" xsi:type="Multiply">
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="423" locator="180:74-180:77" resultTypeName="t:Quantity" name="dose" xsi:type="QueryLetRef"/>
                                    <operand xsi:type="ToQuantity">
                                       <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                       <operand localId="424" locator="180:81-180:91" resultTypeName="t:Decimal" name="dosesPerDay" xsi:type="QueryLetRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                           <operand xsi:type="ToQuantity">
                              <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="430" locator="180:97-180:109" resultTypeName="t:Integer" xsi:type="Add">
                                 <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="428" locator="180:98" resultTypeName="t:Integer" valueType="t:Integer" value="1" xsi:type="Literal"/>
                                 <operand localId="429" locator="180:102-180:108" resultTypeName="t:Integer" name="refills" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </high>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="Request">
            <operandTypeSpecifier localId="319" locator="154:51-154:69" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="515" locator="262:1-280:98" name="MedicationDispensePeriod" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="515">
               <a:s>/*
  Next, consider the MedicationDispense case:
  
  * whenPrepared: When product was prepared
  * whenHandedOver: When product was given out
  * quantity: Amount dispensed
  * daysSupply: Amount of medication expressed as a timing amount
  * dosageInstruction.timing.repeat.boundsDuration: total duration of the repeat
  * dosageInstruction.timing.repeat.boundsRange: range of durations of the repeat
  * dosageInstruction.timing.repeat.boundsPeriod: period bounds of the repeat
  * dosageInstruction.timing.repeat.count: number of times to repeat
  * dosageInstruction.timing.repeat.countMax: maximum number of times to repeat
  * dosageInstruction.timing.repeat.frequency: event occurs frequency times per period
  * dosageInstruction.timing.repeat.frequencyMax: event occurs up to frequencyMax times per period
  * dosageInstruction.timing.repeat.period: event occurs frequency times per period
  * dosageInstruction.timing.repeat.periodMax: upper limit of period
  * dosageInstruction.timing.repeat.periodUnit: period duration (s | min | h | d | wk | mo | a)
  * dosageInstruction.timing.repeat.timeOfDay: time of day for the event (0..*)
  * dosageInstruction.timing.repeat.when: event timing (HS | WAKE | C | CM | CD | CV | AC | ACM...)
  * dosageInstruction.timing.code: BID | TID | QID | AM | PM | QD | QOD...
  * dosageInstruction.asNeeded
  * dosageInstruction.doseAndRate.doseQuantity
  * dosageInstruction.doseAndRate.doseRange
  
  We have effectively the same elements, with the same meanings, with the exception that the
  event is documenting a single dispense, and does not contain refill information. In addition,
  multiple dispense events would typically be present, and those would all have to be considered
  as part of an overall calculation. That will be considered when we combine results, but for
  this function, we'll focus on calculating the duration of a single dispense.
  
  With a MedicationDispense, dosage information is expected to be the same as the related
  MedicationRequest, so boundsPeriod would still cover the entire prescription (including refills)
  and so cannot be used to calculate the interval covered by the dispense.
  
  If the daysSupply element is present, then the duration in days is simply
  
    daysSupply
  
  Note specifically that we are not considering refills, as those would be covered
  by subsequent dispense records.
  
  If daysSupplied is not present, then daysSupplied must be calculated based on
  the quantity, dosage, and frequency:
  
    (quantity / (dosage * frequency))
  
  This calculation results in a number of days, which can then be turned into a
  period by anchoring that to the startDate, as determined by the first available
  value of the start of the boundsPeriod, whenHandedOver, and whenPrepared.
  
   Interval[startDate, startDate + durationInDays]
  */

/*Calculates Medication Period for a given MedicationDispense
MedicationDispense instances provided to this function are expected
to conform to the [TODO: MMEMedicationDispense](http://build.fhir.org/ig/cqframework/opioid-mme-r4/StructureDefinition-mmemedicationdispense.html)
profile, which expects:
* 1 and only 1 dosageInstruction, multiple dosageInstruction elements will result in an error
* 1 and only 1 doseAndRate, multiple doseAndRate elements will result in an error
* 1 timing with 1 repeat, missing timing or repeat elements will result in a null
* frequency, frequencyMax, defaulting to 1
* period, periodUnit, defaulting to 1 'd'
* timeOfDay
* doseQuantity or doseRange, missing doseQuantity and doseRange will result in a null
* whenHandedOver or whenPrepared, if missing both whenHandedOver and whenPrepared will result in a null

Note that MedicationDispense status is not considered by this calculation, as the
list of MedicationDispense instances provided to this function should already have
considered appropriate statuses, depending on the use case, typically `completed`,
especially since whenHandedOver would be expected to be present for a completed
MedicationDispense.

Note also that the dosage information recorded in a dispense is expected to be a copy of the
dispense information from the related medication request. As such, the boundsPeriod would be expected
to cover the entire range, and should _not_ be used for timing of the event.

There is also active discussion in the Pharmacy WG about what date should be used if whenPrepared/whenHandedOver is not present.
This may take the form of an &quot;original creation date&quot;, but may also be a &quot;status change date&quot; for dispense events that are updating
status of an existing dispense. That discussion is ongoing, so until that is resolved, this logic will return
null if whenPrepared/whenHandedOver are not available.*/
define function &quot;MedicationDispensePeriod&quot;(Dispense </a:s>
               <a:s r="438">
                  <a:s>&quot;MedicationDispense&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="514">
                  <a:s r="514">
                     <a:s>
                        <a:s r="440">
                           <a:s r="439">
                              <a:s>
                                 <a:s>Dispense</a:s>
                              </a:s>
                           </a:s>
                           <a:s> D</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s>
                        <a:s>let
      </a:s>
                        <a:s r="444">
                           <a:s>dosage: </a:s>
                           <a:s r="443">
                              <a:s>singleton from </a:s>
                              <a:s r="442">
                                 <a:s r="441">
                                    <a:s>D</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="442">
                                    <a:s>dosageInstruction</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="448">
                           <a:s>doseAndRate: </a:s>
                           <a:s r="447">
                              <a:s>singleton from </a:s>
                              <a:s r="446">
                                 <a:s r="445">
                                    <a:s>dosage</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="446">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="453">
                           <a:s>doseRange: </a:s>
                           <a:s r="452">
                              <a:s r="450">
                                 <a:s r="449">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="450">
                                    <a:s>dose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="451">
                                 <a:s>Range</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="458">
                           <a:s>doseQuantity: </a:s>
                           <a:s r="457">
                              <a:s r="455">
                                 <a:s r="454">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="455">
                                    <a:s>dose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="456">
                                 <a:s>SimpleQuantity</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="463">
                           <a:s>dose: </a:s>
                           <a:s r="462">
                              <a:s>Coalesce(</a:s>
                              <a:s r="460">
                                 <a:s>end of </a:s>
                                 <a:s r="459">
                                    <a:s>doseRange</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="461">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="466">
                           <a:s>timing: </a:s>
                           <a:s r="465">
                              <a:s r="464">
                                 <a:s>dosage</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="465">
                                 <a:s>timing</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="474">
                           <a:s>frequency: </a:s>
                           <a:s r="473">
                              <a:s>Coalesce(</a:s>
                              <a:s r="469">
                                 <a:s r="468">
                                    <a:s r="467">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="468">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="469">
                                    <a:s>frequencyMax</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="472">
                                 <a:s r="471">
                                    <a:s r="470">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="471">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="472">
                                    <a:s>frequency</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="483">
                           <a:s>period: </a:s>
                           <a:s r="482">
                              <a:s>System.Quantity { </a:s>
                              <a:s>
                                 <a:s>value: </a:s>
                                 <a:s r="477">
                                    <a:s r="476">
                                       <a:s r="475">
                                          <a:s>timing</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="476">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="477">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="481">
                                    <a:s r="480">
                                       <a:s r="479">
                                          <a:s r="478">
                                             <a:s>timing</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="479">
                                             <a:s>repeat</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="480">
                                          <a:s>periodUnit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="481">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="493">
                           <a:s>dosesPerDay: </a:s>
                           <a:s r="492">
                              <a:s>Coalesce(</a:s>
                              <a:s r="486">
                                 <a:s>ToDaily(</a:s>
                                 <a:s r="484">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="485">
                                    <a:s>period</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="490">
                                 <a:s>Count(</a:s>
                                 <a:s r="489">
                                    <a:s r="488">
                                       <a:s r="487">
                                          <a:s>timing</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="488">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="489">
                                       <a:s>timeOfDay</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s r="491">, 1.0)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="499">
                           <a:s>startDate:
        </a:s>
                           <a:s r="498">
                              <a:s>Coalesce(
          </a:s>
                              <a:s r="495">
                                 <a:s r="494">
                                    <a:s>D</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="495">
                                    <a:s>whenHandedOver</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
          </a:s>
                              <a:s r="497">
                                 <a:s r="496">
                                    <a:s>D</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="497">
                                    <a:s>whenPrepared</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="513">
                        <a:s>return
        </a:s>
                        <a:s r="512">
                           <a:s>Interval[</a:s>
                           <a:s r="500">
                              <a:s>startDate</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="511">
                              <a:s r="501">
                                 <a:s>startDate</a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="510">
                                 <a:s>Coalesce(</a:s>
                                 <a:s r="503">
                                    <a:s r="502">
                                       <a:s>D</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="503">
                                       <a:s>daysSupply</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="509">
                                    <a:s r="505">
                                       <a:s r="504">
                                          <a:s>D</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="505">
                                          <a:s>quantity</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> / </a:s>
                                    <a:s r="508">
                                       <a:s>(</a:s>
                                       <a:s r="508">
                                          <a:s r="506">
                                             <a:s>dose</a:s>
                                          </a:s>
                                          <a:s> * </a:s>
                                          <a:s r="507">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="514" locator="263:3-280:98" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="440" locator="263:3-263:12" resultTypeName="fhir:MedicationDispense" alias="D">
               <expression localId="439" locator="263:3-263:10" resultTypeName="fhir:MedicationDispense" name="Dispense" xsi:type="OperandRef"/>
            </source>
            <let localId="444" locator="265:7-265:48" resultTypeName="fhir:Dosage" identifier="dosage">
               <expression localId="443" locator="265:15-265:48" resultTypeName="fhir:Dosage" xsi:type="SingletonFrom">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Dosage" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="442" locator="265:30-265:48" path="dosageInstruction" scope="D" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Dosage" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </expression>
            </let>
            <let localId="448" locator="266:7-266:52" resultTypeName="fhir:Dosage.DoseAndRate" identifier="doseAndRate">
               <expression localId="447" locator="266:20-266:52" resultTypeName="fhir:Dosage.DoseAndRate" xsi:type="SingletonFrom">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Dosage.DoseAndRate" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="446" locator="266:35-266:52" path="doseAndRate" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Dosage.DoseAndRate" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="445" locator="266:35-266:40" resultTypeName="fhir:Dosage" name="dosage" xsi:type="QueryLetRef"/>
                  </operand>
               </expression>
            </let>
            <let localId="453" locator="267:7-267:42" resultTypeName="fhir:Range" identifier="doseRange">
               <expression localId="452" locator="267:18-267:42" resultTypeName="fhir:Range" strict="false" xsi:type="As">
                  <operand localId="450" locator="267:18-267:33" path="dose" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:SimpleQuantity" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="449" locator="267:18-267:28" resultTypeName="fhir:Dosage.DoseAndRate" name="doseAndRate" xsi:type="QueryLetRef"/>
                  </operand>
                  <asTypeSpecifier localId="451" locator="267:38-267:42" resultTypeName="fhir:Range" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="458" locator="268:7-268:54" resultTypeName="fhir:SimpleQuantity" identifier="doseQuantity">
               <expression localId="457" locator="268:21-268:54" resultTypeName="fhir:SimpleQuantity" strict="false" xsi:type="As">
                  <operand localId="455" locator="268:21-268:36" path="dose" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:SimpleQuantity" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="454" locator="268:21-268:31" resultTypeName="fhir:Dosage.DoseAndRate" name="doseAndRate" xsi:type="QueryLetRef"/>
                  </operand>
                  <asTypeSpecifier localId="456" locator="268:41-268:54" resultTypeName="fhir:SimpleQuantity" name="fhir:SimpleQuantity" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="463" locator="269:7-269:52" resultTypeName="t:Quantity" identifier="dose">
               <expression localId="462" locator="269:13-269:52" resultTypeName="t:Quantity" xsi:type="Coalesce">
                  <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="460" locator="269:22-269:37" resultTypeName="t:Quantity" xsi:type="End">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="459" locator="269:29-269:37" resultTypeName="fhir:Range" name="doseRange" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="461" locator="269:40-269:51" resultTypeName="fhir:SimpleQuantity" name="doseQuantity" xsi:type="QueryLetRef"/>
                  </operand>
               </expression>
            </let>
            <let localId="466" locator="270:7-270:27" resultTypeName="fhir:Timing" identifier="timing">
               <expression localId="465" locator="270:15-270:27" resultTypeName="fhir:Timing" path="timing" xsi:type="Property">
                  <source localId="464" locator="270:15-270:20" resultTypeName="fhir:Dosage" name="dosage" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="474" locator="271:7-271:78" resultTypeName="fhir:positiveInt" identifier="frequency">
               <expression localId="473" locator="271:18-271:78" resultTypeName="fhir:positiveInt" xsi:type="Coalesce">
                  <signature name="fhir:positiveInt" xsi:type="NamedTypeSpecifier"/>
                  <signature name="fhir:positiveInt" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="469" locator="271:27-271:52" resultTypeName="fhir:positiveInt" path="frequencyMax" xsi:type="Property">
                     <source localId="468" locator="271:27-271:39" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                        <source localId="467" locator="271:27-271:32" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
                  <operand localId="472" locator="271:55-271:77" resultTypeName="fhir:positiveInt" path="frequency" xsi:type="Property">
                     <source localId="471" locator="271:55-271:67" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                        <source localId="470" locator="271:55-271:60" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
               </expression>
            </let>
            <let localId="483" locator="272:7-272:99" resultTypeName="t:Quantity" identifier="period">
               <expression localId="482" locator="272:15-272:99" resultTypeName="t:Quantity" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value name="ToDecimal" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="477" locator="272:40-272:59" resultTypeName="fhir:decimal" path="period" xsi:type="Property">
                           <source localId="476" locator="272:40-272:52" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                              <source localId="475" locator="272:40-272:45" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="481" locator="272:68-272:97" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source localId="480" locator="272:68-272:91" resultTypeName="fhir:UnitsOfTime" path="periodUnit" xsi:type="Property">
                           <source localId="479" locator="272:68-272:80" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                              <source localId="478" locator="272:68-272:73" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </source>
                     </value>
                  </element>
               </expression>
            </let>
            <let localId="493" locator="273:7-273:92" resultTypeName="t:Decimal" identifier="dosesPerDay">
               <expression localId="492" locator="273:20-273:92" resultTypeName="t:Decimal" xsi:type="Coalesce">
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="486" locator="273:29-273:54" resultTypeName="t:Decimal" name="ToDaily" xsi:type="FunctionRef">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand name="ToInteger" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="484" locator="273:37-273:45" resultTypeName="fhir:positiveInt" name="frequency" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand localId="485" locator="273:48-273:53" resultTypeName="t:Quantity" name="period" xsi:type="QueryLetRef"/>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="490" locator="273:57-273:86" resultTypeName="t:Integer" xsi:type="Count">
                        <signature xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:time" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <source localId="489" locator="273:63-273:85" path="timeOfDay" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:time" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="488" locator="273:63-273:75" resultTypeName="fhir:Timing.Repeat" path="repeat" xsi:type="Property">
                              <source localId="487" locator="273:63-273:68" resultTypeName="fhir:Timing" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </source>
                     </operand>
                  </operand>
                  <operand localId="491" locator="273:89-273:91" resultTypeName="t:Decimal" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="499" locator="274:7-278:9" resultTypeName="fhir:dateTime" identifier="startDate">
               <expression localId="498" locator="275:9-278:9" resultTypeName="fhir:dateTime" xsi:type="Coalesce">
                  <signature name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="495" locator="276:11-276:26" resultTypeName="fhir:dateTime" path="whenHandedOver" scope="D" xsi:type="Property"/>
                  <operand localId="497" locator="277:11-277:24" resultTypeName="fhir:dateTime" path="whenPrepared" scope="D" xsi:type="Property"/>
               </expression>
            </let>
            <return localId="513" locator="279:5-280:98">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="512" locator="280:9-280:98" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="500" locator="280:18-280:26" resultTypeName="fhir:dateTime" name="startDate" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="511" locator="280:29-280:97" resultTypeName="t:DateTime" xsi:type="Add">
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="501" locator="280:29-280:37" resultTypeName="fhir:dateTime" name="startDate" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand localId="510" locator="280:41-280:97" resultTypeName="t:Quantity" xsi:type="Coalesce">
                        <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                        <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <signature name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="503" locator="280:50-280:61" resultTypeName="fhir:SimpleQuantity" path="daysSupply" scope="D" xsi:type="Property"/>
                        </operand>
                        <operand localId="509" locator="280:64-280:96" resultTypeName="t:Quantity" xsi:type="Divide">
                           <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                           <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <signature name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="505" locator="280:64-280:73" resultTypeName="fhir:SimpleQuantity" path="quantity" scope="D" xsi:type="Property"/>
                           </operand>
                           <operand localId="508" locator="280:77-280:96" resultTypeName="t:Quantity" xsi:type="Multiply">
                              <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="506" locator="280:78-280:81" resultTypeName="t:Quantity" name="dose" xsi:type="QueryLetRef"/>
                              <operand xsi:type="ToQuantity">
                                 <signature name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="507" locator="280:85-280:95" resultTypeName="t:Decimal" name="dosesPerDay" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="Dispense">
            <operandTypeSpecifier localId="438" locator="262:53-262:72" resultTypeName="fhir:MedicationDispense" name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="518" locator="286:1-287:9" resultTypeName="t:Quantity" name="TherapeuticDuration" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="518">
               <a:s>/*Returns the established therapeutic duration for a given medication.
This is likely measure specific, though could potentially be established for
any drug and distributed as a CodeSystem supplement.
Defaulting to 14 days here for illustration.*/
define function &quot;TherapeuticDuration&quot;(medication </a:s>
               <a:s r="516">
                  <a:s>Concept</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="517">
                  <a:s r="517">
                     <a:s>14 days</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="517" locator="287:3-287:9" resultTypeName="t:Quantity" value="14" unit="days" xsi:type="Quantity"/>
         <operand name="medication">
            <operandTypeSpecifier localId="516" locator="286:50-286:56" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="544" locator="306:1-315:12" name="MedicationAdministrationPeriod" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="544">
               <a:s>/*Next we consider MedicationAdministration. This data type is typically used to
capture specific administration, with the relevantPeriod capturing start and stop
time of the administration event:

* effective[x]: Start and end time of administration

However, when calculating cumulative medication duration, it is typically the
therapeutic period of the medication that should be considered. Currently neither
the Medication nor MedicationKnowledge resources provide this information, so
we model it here as a function that can potentially be implemented in a variety
of ways, including measure-specific values, as well as distribution as an RxNorm
code system supplement.

However it is obtained, if therapeutic duration can be obtained, and the effective
period has a start, the result will be

    Interval[startDate, startDate + therapeuticDuration]*/
define function &quot;MedicationAdministrationPeriod&quot;(Administration </a:s>
               <a:s r="519">
                  <a:s>&quot;MedicationAdministration&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="543">
                  <a:s r="543">
                     <a:s>
                        <a:s r="521">
                           <a:s r="520">
                              <a:s>
                                 <a:s>Administration</a:s>
                              </a:s>
                           </a:s>
                           <a:s> M</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s>
                        <a:s>let
      </a:s>
                        <a:s r="525">
                           <a:s>therapeuticDuration: </a:s>
                           <a:s r="524">
                              <a:s>TherapeuticDuration(</a:s>
                              <a:s r="523">
                                 <a:s r="522">
                                    <a:s>Administration</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="523">
                                    <a:s>medication</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="529">
                           <a:s>startDate: </a:s>
                           <a:s r="528">
                              <a:s>start of </a:s>
                              <a:s r="527">
                                 <a:s r="526">
                                    <a:s>Administration</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="527">
                                    <a:s>effective</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="542">
                        <a:s>return
      </a:s>
                        <a:s r="541">
                           <a:s>if </a:s>
                           <a:s r="534">
                              <a:s r="531">
                                 <a:s r="530">
                                    <a:s>startDate</a:s>
                                 </a:s>
                                 <a:s> is not null</a:s>
                              </a:s>
                              <a:s> and </a:s>
                              <a:s r="533">
                                 <a:s r="532">
                                    <a:s>therapeuticDuration</a:s>
                                 </a:s>
                                 <a:s> is not null</a:s>
                              </a:s>
                           </a:s>
                           <a:s> then
        </a:s>
                           <a:s r="539">
                              <a:s>Interval[</a:s>
                              <a:s r="535">
                                 <a:s>startDate</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="538">
                                 <a:s r="536">
                                    <a:s>startDate</a:s>
                                 </a:s>
                                 <a:s> + </a:s>
                                 <a:s r="537">
                                    <a:s>therapeuticDuration</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                           <a:s r="540">
      else
        null</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="543" locator="307:3-315:12" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="521" locator="307:3-307:18" resultTypeName="fhir:MedicationAdministration" alias="M">
               <expression localId="520" locator="307:3-307:16" resultTypeName="fhir:MedicationAdministration" name="Administration" xsi:type="OperandRef"/>
            </source>
            <let localId="525" locator="309:7-309:73" resultTypeName="t:Quantity" identifier="therapeuticDuration">
               <expression localId="524" locator="309:28-309:73" resultTypeName="t:Quantity" name="TherapeuticDuration" xsi:type="FunctionRef">
                  <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                     <operand asType="fhir:CodeableConcept" xsi:type="As">
                        <operand localId="523" locator="309:48-309:72" path="medication" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="522" locator="309:48-309:61" resultTypeName="fhir:MedicationAdministration" name="Administration" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="529" locator="310:7-310:50" resultTypeName="t:DateTime" identifier="startDate">
               <expression localId="528" locator="310:18-310:50" resultTypeName="t:DateTime" xsi:type="Start">
                  <signature xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                     <operand asType="fhir:Period" xsi:type="As">
                        <operand localId="527" locator="310:27-310:50" path="effective" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="526" locator="310:27-310:40" resultTypeName="fhir:MedicationAdministration" name="Administration" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
               </expression>
            </let>
            <return localId="542" locator="311:5-315:12">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="541" locator="312:7-315:12" xsi:type="If">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="534" locator="312:10-312:66" resultTypeName="t:Boolean" xsi:type="And">
                     <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="531" locator="312:10-312:30" resultTypeName="t:Boolean" xsi:type="Not">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand locator="312:10-312:30" resultTypeName="t:Boolean" xsi:type="IsNull">
                           <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="530" locator="312:10-312:18" resultTypeName="t:DateTime" name="startDate" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                     <operand localId="533" locator="312:36-312:66" resultTypeName="t:Boolean" xsi:type="Not">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand locator="312:36-312:66" resultTypeName="t:Boolean" xsi:type="IsNull">
                           <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="532" locator="312:36-312:54" resultTypeName="t:Quantity" name="therapeuticDuration" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </condition>
                  <then localId="539" locator="313:9-313:60" lowClosed="true" highClosed="true" xsi:type="Interval">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <low localId="535" locator="313:18-313:26" resultTypeName="t:DateTime" name="startDate" xsi:type="QueryLetRef"/>
                     <high localId="538" locator="313:29-313:59" resultTypeName="t:DateTime" xsi:type="Add">
                        <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="536" locator="313:29-313:37" resultTypeName="t:DateTime" name="startDate" xsi:type="QueryLetRef"/>
                        <operand localId="537" locator="313:41-313:59" resultTypeName="t:Quantity" name="therapeuticDuration" xsi:type="QueryLetRef"/>
                     </high>
                  </then>
                  <else xsi:type="As">
                     <operand localId="540" locator="315:9-315:12" resultTypeName="t:Any" xsi:type="Null"/>
                     <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </asTypeSpecifier>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="Administration">
            <operandTypeSpecifier localId="519" locator="306:65-306:90" resultTypeName="fhir:MedicationAdministration" name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="559" locator="327:1-328:99" resultTypeName="t:Integer" name="CumulativeDuration" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="559">
               <a:s>/*Now that we have functions for determining the medication period for individual
prescriptions, administrations, and dispenses, we can combine those using
an overall cumulative medication duration calculation.

There are two broad approaches to calculating cumulative duration, one that _collapses_
overlapping intervals so that calculations are not duplicated, and one that _rolls out_
overlapping intervals so that the durations are laid end-to-end.

First, we define a function that simply calculates CumulativeDuration of a set of
intervals:*/
define function &quot;CumulativeDuration&quot;(Intervals </a:s>
               <a:s r="547">
                  <a:s>List&lt;</a:s>
                  <a:s r="546">
                     <a:s>Interval&lt;</a:s>
                     <a:s r="545">
                        <a:s>DateTime</a:s>
                     </a:s>
                     <a:s>></a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="558">
                  <a:s r="558">
                     <a:s>Sum(</a:s>
                     <a:s r="557">
                        <a:s>
                           <a:s r="550">
                              <a:s r="549">
                                 <a:s>(</a:s>
                                 <a:s r="549">
                                    <a:s>collapse </a:s>
                                    <a:s r="548">
                                       <a:s>Intervals</a:s>
                                    </a:s>
                                    <a:s> per day</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> X</a:s>
                           </a:s>
                        </a:s>
                        <a:s> </a:s>
                        <a:s r="556">
                           <a:s>return all </a:s>
                           <a:s r="555">
                              <a:s>difference in days between </a:s>
                              <a:s r="552">
                                 <a:s>start of </a:s>
                                 <a:s r="551">
                                    <a:s>X</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> and </a:s>
                              <a:s r="554">
                                 <a:s>end of </a:s>
                                 <a:s r="553">
                                    <a:s>X</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="558" locator="328:3-328:99" resultTypeName="t:Integer" xsi:type="Sum">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="t:Integer" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <source localId="557" locator="328:7-328:98" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="t:Integer" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="550" locator="328:7-328:36" alias="X">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </resultTypeSpecifier>
                  <expression localId="549" locator="328:7-328:34" xsi:type="Collapse">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </resultTypeSpecifier>
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </signature>
                     <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="548" locator="328:17-328:25" name="Intervals" xsi:type="OperandRef">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                     </operand>
                     <operand value="1.0" unit="day" xsi:type="Quantity"/>
                  </expression>
               </source>
               <return localId="556" locator="328:38-328:98" distinct="false">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="555" locator="328:49-328:98" resultTypeName="t:Integer" precision="Day" xsi:type="DifferenceBetween">
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="552" locator="328:76-328:85" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="551" locator="328:85" name="X" xsi:type="AliasRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </operand>
                     </operand>
                     <operand localId="554" locator="328:91-328:98" resultTypeName="t:DateTime" xsi:type="End">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="553" locator="328:98" name="X" xsi:type="AliasRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </operand>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="Intervals">
            <operandTypeSpecifier localId="547" locator="327:48-327:71" xsi:type="ListTypeSpecifier">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </resultTypeSpecifier>
               <elementType localId="546" locator="327:53-327:70" xsi:type="IntervalTypeSpecifier">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <pointType localId="545" locator="327:62-327:69" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="597" locator="331:1-340:8" name="RolloutIntervals" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="597">
               <a:s>/*Next, we define a function that rolls out intervals:*/
define function &quot;RolloutIntervals&quot;(intervals </a:s>
               <a:s r="562">
                  <a:s>List&lt;</a:s>
                  <a:s r="561">
                     <a:s>Interval&lt;</a:s>
                     <a:s r="560">
                        <a:s>DateTime</a:s>
                     </a:s>
                     <a:s>></a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="596">
                  <a:s r="596">
                     <a:s>
                        <a:s r="564">
                           <a:s r="563">
                              <a:s>
                                 <a:s>intervals</a:s>
                              </a:s>
                           </a:s>
                           <a:s> I</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="595">
                        <a:s>aggregate R </a:s>
                        <a:s r="569">
                           <a:s>starting (</a:s>
                           <a:s r="569">
                              <a:s r="565">null as </a:s>
                              <a:s r="568">
                                 <a:s>List&lt;</a:s>
                                 <a:s r="567">
                                    <a:s>Interval&lt;</a:s>
                                    <a:s r="566">
                                       <a:s>DateTime</a:s>
                                    </a:s>
                                    <a:s>></a:s>
                                 </a:s>
                                 <a:s>></a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s>:
      </a:s>
                        <a:s r="594">
                           <a:s r="570">
                              <a:s>R</a:s>
                           </a:s>
                           <a:s> union </a:s>
                           <a:s r="593">
                              <a:s>(</a:s>
                              <a:s r="593">
                                 <a:s>{
        </a:s>
                                 <a:s r="592">
                                    <a:s>
                                       <a:s r="572">
                                          <a:s r="571">
                                             <a:s>
                                                <a:s>I</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> X</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
          </a:s>
                                    <a:s>
                                       <a:s>let
            </a:s>
                                       <a:s r="582">
                                          <a:s>S: </a:s>
                                          <a:s r="581">
                                             <a:s>Max(</a:s>
                                             <a:s r="580">
                                                <a:s>{ </a:s>
                                                <a:s r="577">
                                                   <a:s r="575">
                                                      <a:s>end of </a:s>
                                                      <a:s r="574">
                                                         <a:s>Last(</a:s>
                                                         <a:s r="573">
                                                            <a:s>R</a:s>
                                                         </a:s>
                                                         <a:s>)</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> + </a:s>
                                                   <a:s r="576">
                                                      <a:s>1 day</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="579">
                                                   <a:s>start of </a:s>
                                                   <a:s r="578">
                                                      <a:s>X</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> }</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>,
            </a:s>
                                       <a:s r="587">
                                          <a:s>E: </a:s>
                                          <a:s r="586">
                                             <a:s r="583">
                                                <a:s>S</a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="585">
                                                <a:s>duration in days of </a:s>
                                                <a:s r="584">
                                                   <a:s>X</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
          </a:s>
                                    <a:s r="591">
                                       <a:s>return </a:s>
                                       <a:s r="590">
                                          <a:s>Interval[</a:s>
                                          <a:s r="588">
                                             <a:s>S</a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="589">
                                             <a:s>E</a:s>
                                          </a:s>
                                          <a:s>]</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
      }</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </elementType>
         </resultTypeSpecifier>
         <expression localId="596" locator="332:3-340:8" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </elementType>
            </resultTypeSpecifier>
            <source localId="564" locator="332:3-332:13" alias="I">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </resultTypeSpecifier>
               <expression localId="563" locator="332:3-332:11" name="intervals" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </resultTypeSpecifier>
               </expression>
            </source>
            <aggregate localId="595" locator="333:5-340:8" identifier="R">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </resultTypeSpecifier>
               <expression localId="594" locator="334:7-340:8" xsi:type="Union">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </resultTypeSpecifier>
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </signature>
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </signature>
                  <operand localId="570" locator="334:7" name="R" xsi:type="QueryLetRef">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </resultTypeSpecifier>
                  </operand>
                  <operand localId="593" locator="334:15-340:8" xsi:type="List">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </resultTypeSpecifier>
                     <element localId="592" locator="335:9-339:31" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="572" locator="335:9-335:11" alias="X">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="571" locator="335:9" name="I" xsi:type="AliasRef">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <let localId="582" locator="337:13-337:58" resultTypeName="t:DateTime" identifier="S">
                           <expression localId="581" locator="337:16-337:58" resultTypeName="t:DateTime" xsi:type="Max">
                              <signature xsi:type="ListTypeSpecifier">
                                 <elementType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <source localId="580" locator="337:20-337:57" xsi:type="List">
                                 <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                    <elementType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <element localId="577" locator="337:22-337:43" resultTypeName="t:DateTime" xsi:type="Add">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="575" locator="337:22-337:35" resultTypeName="t:DateTime" xsi:type="End">
                                       <signature xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <operand localId="574" locator="337:29-337:35" xsi:type="Last">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <signature xsi:type="ListTypeSpecifier">
                                             <elementType xsi:type="IntervalTypeSpecifier">
                                                <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                             </elementType>
                                          </signature>
                                          <source localId="573" locator="337:34" name="R" xsi:type="QueryLetRef">
                                             <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                                <elementType xsi:type="IntervalTypeSpecifier">
                                                   <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                                </elementType>
                                             </resultTypeSpecifier>
                                          </source>
                                       </operand>
                                    </operand>
                                    <operand localId="576" locator="337:39-337:43" resultTypeName="t:Quantity" value="1" unit="day" xsi:type="Quantity"/>
                                 </element>
                                 <element localId="579" locator="337:46-337:55" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="578" locator="337:55" name="X" xsi:type="AliasRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                    </operand>
                                 </element>
                              </source>
                           </expression>
                        </let>
                        <let localId="587" locator="338:13-338:40" resultTypeName="t:DateTime" identifier="E">
                           <expression localId="586" locator="338:16-338:40" resultTypeName="t:DateTime" xsi:type="Add">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="583" locator="338:16" resultTypeName="t:DateTime" name="S" xsi:type="QueryLetRef"/>
                              <operand xsi:type="ToQuantity">
                                 <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="585" locator="338:20-338:40" resultTypeName="t:Integer" precision="Day" xsi:type="DurationBetween">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <operand xsi:type="Start">
                                       <signature xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <operand localId="584" locator="338:40" name="X" xsi:type="AliasRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                       </operand>
                                    </operand>
                                    <operand xsi:type="End">
                                       <signature xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <operand localId="584" locator="338:40" name="X" xsi:type="AliasRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                       </operand>
                                    </operand>
                                 </operand>
                              </operand>
                           </expression>
                        </let>
                        <return localId="591" locator="339:11-339:31">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="590" locator="339:18-339:31" lowClosed="true" highClosed="true" xsi:type="Interval">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <low localId="588" locator="339:27" resultTypeName="t:DateTime" name="S" xsi:type="QueryLetRef"/>
                              <high localId="589" locator="339:30" resultTypeName="t:DateTime" name="E" xsi:type="QueryLetRef"/>
                           </expression>
                        </return>
                     </element>
                  </operand>
               </expression>
               <starting localId="569" locator="333:17-333:59" strict="false" xsi:type="As">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </resultTypeSpecifier>
                  <operand localId="565" locator="333:27-333:30" resultTypeName="t:Any" xsi:type="Null"/>
                  <asTypeSpecifier localId="568" locator="333:35-333:58" xsi:type="ListTypeSpecifier">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </resultTypeSpecifier>
                     <elementType localId="567" locator="333:40-333:57" xsi:type="IntervalTypeSpecifier">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <pointType localId="566" locator="333:49-333:56" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </asTypeSpecifier>
               </starting>
            </aggregate>
         </expression>
         <operand name="intervals">
            <operandTypeSpecifier localId="562" locator="331:46-331:69" xsi:type="ListTypeSpecifier">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </resultTypeSpecifier>
               <elementType localId="561" locator="331:51-331:68" xsi:type="IntervalTypeSpecifier">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <pointType localId="560" locator="331:60-331:67" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="622" locator="344:1-353:5" name="MedicationPeriod" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="622">
               <a:s>/*Then, we define a function that allows us to calculate based on the various medication
types:*/
define function &quot;MedicationPeriod&quot;(medication </a:s>
               <a:s r="601">
                  <a:s>Choice&lt;</a:s>
                  <a:s r="598">
                     <a:s>&quot;MedicationRequest&quot;</a:s>
                  </a:s>
                  <a:s>,
    </a:s>
                  <a:s r="599">
                     <a:s>&quot;MedicationDispense&quot;</a:s>
                  </a:s>
                  <a:s>,
    </a:s>
                  <a:s r="600">
                     <a:s>&quot;MedicationAdministration&quot;</a:s>
                  </a:s>
                  <a:s>
  ></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="621">
                  <a:s r="621">
                     <a:s>case
    </a:s>
                     <a:s r="607">
                        <a:s>when </a:s>
                        <a:s r="604">
                           <a:s r="602">
                              <a:s>medication</a:s>
                           </a:s>
                           <a:s> is </a:s>
                           <a:s r="603">
                              <a:s>MedicationRequest</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="606">
                           <a:s>MedicationRequestPeriod(</a:s>
                           <a:s r="605">
                              <a:s>medication</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="613">
                        <a:s>when </a:s>
                        <a:s r="610">
                           <a:s r="608">
                              <a:s>medication</a:s>
                           </a:s>
                           <a:s> is </a:s>
                           <a:s r="609">
                              <a:s>MedicationDispense</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="612">
                           <a:s>MedicationDispensePeriod(</a:s>
                           <a:s r="611">
                              <a:s>medication</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="619">
                        <a:s>when </a:s>
                        <a:s r="616">
                           <a:s r="614">
                              <a:s>medication</a:s>
                           </a:s>
                           <a:s> is </a:s>
                           <a:s r="615">
                              <a:s>MedicationAdministration</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="618">
                           <a:s>MedicationAdministrationPeriod(</a:s>
                           <a:s r="617">
                              <a:s>medication</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s r="620">
    else null
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="621" locator="348:3-353:5" xsi:type="Case">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <caseItem localId="607" locator="349:5-349:81">
               <when localId="604" locator="349:10-349:40" resultTypeName="t:Boolean" xsi:type="Is">
                  <operand localId="602" locator="349:10-349:19" name="medication" xsi:type="OperandRef">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
                  <isTypeSpecifier localId="603" locator="349:24-349:40" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
               </when>
               <then localId="606" locator="349:47-349:81" name="MedicationRequestPeriod" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <signature name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                  <operand asType="fhir:MedicationRequest" xsi:type="As">
                     <operand localId="605" locator="349:71-349:80" name="medication" xsi:type="OperandRef">
                        <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="613" locator="350:5-350:83">
               <when localId="610" locator="350:10-350:41" resultTypeName="t:Boolean" xsi:type="Is">
                  <operand localId="608" locator="350:10-350:19" name="medication" xsi:type="OperandRef">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
                  <isTypeSpecifier localId="609" locator="350:24-350:41" resultTypeName="fhir:MedicationDispense" name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
               </when>
               <then localId="612" locator="350:48-350:83" name="MedicationDispensePeriod" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <signature name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                  <operand asType="fhir:MedicationDispense" xsi:type="As">
                     <operand localId="611" locator="350:73-350:82" name="medication" xsi:type="OperandRef">
                        <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="619" locator="351:5-351:95">
               <when localId="616" locator="351:10-351:47" resultTypeName="t:Boolean" xsi:type="Is">
                  <operand localId="614" locator="351:10-351:19" name="medication" xsi:type="OperandRef">
                     <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                        <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                        <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
                  <isTypeSpecifier localId="615" locator="351:24-351:47" resultTypeName="fhir:MedicationAdministration" name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
               </when>
               <then localId="618" locator="351:54-351:95" name="MedicationAdministrationPeriod" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <signature name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                  <operand asType="fhir:MedicationAdministration" xsi:type="As">
                     <operand localId="617" locator="351:85-351:94" name="medication" xsi:type="OperandRef">
                        <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <else xsi:type="As">
               <operand localId="620" locator="352:10-352:13" resultTypeName="t:Any" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </else>
         </expression>
         <operand name="medication">
            <operandTypeSpecifier localId="601" locator="344:47-347:3" xsi:type="ChoiceTypeSpecifier">
               <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                  <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                  <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                  <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <choice localId="598" locator="344:54-344:72" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
               <choice localId="599" locator="345:5-345:24" resultTypeName="fhir:MedicationDispense" name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
               <choice localId="600" locator="346:5-346:30" resultTypeName="fhir:MedicationAdministration" name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="653" locator="366:1-382:3" resultTypeName="t:Integer" name="CumulativeMedicationDuration" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="653">
               <a:s>/*We can then use this function, combined with the MedicationDuration functions above
to calculate Cumulative Medication Duration:

Generally speaking, we want to _roll out_ intervals from dispense and administration
events, and then collapse across that result and intervals from prescriptions.

Note also that the separation of medications by type should already be done
by this stage as well.

Calculations that combine dosages from different types of medications (such as Morphine Milligram Equivalent (MME)
or Average MME) require further consideration.*/
define function &quot;CumulativeMedicationDuration&quot;(Medications </a:s>
               <a:s r="627">
                  <a:s>List&lt;</a:s>
                  <a:s r="626">
                     <a:s>Choice&lt;</a:s>
                     <a:s r="623">
                        <a:s>&quot;MedicationRequest&quot;</a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="624">
                        <a:s>&quot;MedicationDispense&quot;</a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="625">
                        <a:s>&quot;MedicationAdministration&quot;</a:s>
                     </a:s>
                     <a:s>
  ></a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="652">
                  <a:s r="652">
                     <a:s>CumulativeDuration(</a:s>
                     <a:s r="651">
                        <a:s r="636">
                           <a:s>(
      </a:s>
                           <a:s r="636">
                              <a:s>
                                 <a:s r="629">
                                    <a:s r="628">
                                       <a:s>
                                          <a:s>Medications</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> M</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="632">
                                 <a:s>where </a:s>
                                 <a:s r="632">
                                    <a:s r="630">
                                       <a:s>M</a:s>
                                    </a:s>
                                    <a:s> is </a:s>
                                    <a:s r="631">
                                       <a:s>MedicationRequest</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="635">
                                 <a:s>return </a:s>
                                 <a:s r="634">
                                    <a:s>MedicationPeriod(</a:s>
                                    <a:s r="633">
                                       <a:s>M</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    )</a:s>
                        </a:s>
                        <a:s>
      union </a:s>
                        <a:s r="650">
                           <a:s>(
        </a:s>
                           <a:s r="650">
                              <a:s>RolloutIntervals(
          </a:s>
                              <a:s r="649">
                                 <a:s>
                                    <a:s r="638">
                                       <a:s r="637">
                                          <a:s>
                                             <a:s>Medications</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> M</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="645">
                                    <a:s>where </a:s>
                                    <a:s r="645">
                                       <a:s r="641">
                                          <a:s r="639">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s> is </a:s>
                                          <a:s r="640">
                                             <a:s>MedicationDispense</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> or </a:s>
                                       <a:s r="644">
                                          <a:s r="642">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s> is </a:s>
                                          <a:s r="643">
                                             <a:s>MedicationAdministration</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
            </a:s>
                                 <a:s r="648">
                                    <a:s>return </a:s>
                                    <a:s r="647">
                                       <a:s>MedicationPeriod(</a:s>
                                       <a:s r="646">
                                          <a:s>M</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        )</a:s>
                           </a:s>
                           <a:s>
      )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="652" locator="370:3-382:3" resultTypeName="t:Integer" name="CumulativeDuration" xsi:type="FunctionRef">
            <signature xsi:type="ListTypeSpecifier">
               <elementType xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </elementType>
            </signature>
            <operand localId="651" locator="370:22-381:7" xsi:type="Union">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </resultTypeSpecifier>
               <signature xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </signature>
               <signature xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </signature>
               <operand localId="636" locator="370:22-374:5" xsi:type="Query">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </resultTypeSpecifier>
                  <source localId="629" locator="371:7-371:19" alias="M">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </resultTypeSpecifier>
                     <expression localId="628" locator="371:7-371:17" name="Medications" xsi:type="OperandRef">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                     </expression>
                  </source>
                  <where localId="632" locator="372:9-372:36" resultTypeName="t:Boolean" xsi:type="Is">
                     <operand localId="630" locator="372:15" name="M" xsi:type="AliasRef">
                        <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                     </operand>
                     <isTypeSpecifier localId="631" locator="372:20-372:36" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                  </where>
                  <return localId="635" locator="373:9-373:34">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </resultTypeSpecifier>
                     <expression localId="634" locator="373:16-373:34" name="MedicationPeriod" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <signature xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="633" locator="373:33" name="M" xsi:type="AliasRef">
                           <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </operand>
                     </expression>
                  </return>
               </operand>
               <operand localId="650" locator="375:13-381:7" name="RolloutIntervals" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </resultTypeSpecifier>
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </elementType>
                  </signature>
                  <operand localId="649" locator="377:11-379:38" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </resultTypeSpecifier>
                     <source localId="638" locator="377:11-377:23" alias="M">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                        <expression localId="637" locator="377:11-377:21" name="Medications" xsi:type="OperandRef">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType xsi:type="ChoiceTypeSpecifier">
                                 <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                              </elementType>
                           </resultTypeSpecifier>
                        </expression>
                     </source>
                     <where localId="645" locator="378:13-378:74" resultTypeName="t:Boolean" xsi:type="Or">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="641" locator="378:19-378:41" resultTypeName="t:Boolean" xsi:type="Is">
                           <operand localId="639" locator="378:19" name="M" xsi:type="AliasRef">
                              <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                                 <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </operand>
                           <isTypeSpecifier localId="640" locator="378:24-378:41" resultTypeName="fhir:MedicationDispense" name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                        <operand localId="644" locator="378:46-378:74" resultTypeName="t:Boolean" xsi:type="Is">
                           <operand localId="642" locator="378:46" name="M" xsi:type="AliasRef">
                              <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                                 <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </operand>
                           <isTypeSpecifier localId="643" locator="378:51-378:74" resultTypeName="fhir:MedicationAdministration" name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </where>
                     <return localId="648" locator="379:13-379:38">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                        <expression localId="647" locator="379:20-379:38" name="MedicationPeriod" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <signature xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                           </signature>
                           <operand localId="646" locator="379:37" name="M" xsi:type="AliasRef">
                              <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                                 <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </operand>
                        </expression>
                     </return>
                  </operand>
               </operand>
            </operand>
         </expression>
         <operand name="Medications">
            <operandTypeSpecifier localId="627" locator="366:60-369:4" xsi:type="ListTypeSpecifier">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType xsi:type="ChoiceTypeSpecifier">
                     <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                  </elementType>
               </resultTypeSpecifier>
               <elementType localId="626" locator="366:65-369:3" xsi:type="ChoiceTypeSpecifier">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <choice localId="623" locator="366:72-366:90" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                  <choice localId="624" locator="367:5-367:24" resultTypeName="fhir:MedicationDispense" name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                  <choice localId="625" locator="368:5-368:30" resultTypeName="fhir:MedicationAdministration" name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
   </statements>
</library>
